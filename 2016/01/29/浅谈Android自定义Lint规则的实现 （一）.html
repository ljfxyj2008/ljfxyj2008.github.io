<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <title>浅谈Android自定义Lint规则的实现 （一） | ljfxyj2008风巢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最近在做一个基于Android Lint的自定义静态代码检查功能库，这里做一个简单的总结。前半部分介绍SDK自带Android Lint的功能与配置使用方法，后半部分介绍扩展自定义Lint规则库的开发流程。
什么是Android LintAndroid Lint是一个静态代码分析工具，它能够对你的Android项目中潜在的bug、可优化的代码、安全性、性能、可用性、可访问性、国际化等进行检查。">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈Android自定义Lint规则的实现 （一）">
<meta property="og:url" content="http://www.carrotsight.com/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html">
<meta property="og:site_name" content="ljfxyj2008风巢">
<meta property="og:description" content="最近在做一个基于Android Lint的自定义静态代码检查功能库，这里做一个简单的总结。前半部分介绍SDK自带Android Lint的功能与配置使用方法，后半部分介绍扩展自定义Lint规则库的开发流程。
什么是Android LintAndroid Lint是一个静态代码分析工具，它能够对你的Android项目中潜在的bug、可优化的代码、安全性、性能、可用性、可访问性、国际化等进行检查。">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/23031672.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/32957935.jpg">
<meta property="og:image" content="http://developer.android.com/images/tools/lint.png">
<meta property="og:image" content="http://developer.android.com/images/tools/studio-inspections-config.png">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/69265121.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/59960096.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/55021440.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/63801235.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/31784308.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/81593485.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/1707982.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/5157796.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/94526179.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/98524820.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/27544737.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/27617933.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/98524820.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/8544219.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/11713429.jpg">
<meta property="og:image" content="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/9825338.jpg">
<meta property="og:updated_time" content="2016-04-01T09:08:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浅谈Android自定义Lint规则的实现 （一）">
<meta name="twitter:description" content="最近在做一个基于Android Lint的自定义静态代码检查功能库，这里做一个简单的总结。前半部分介绍SDK自带Android Lint的功能与配置使用方法，后半部分介绍扩展自定义Lint规则库的开发流程。
什么是Android LintAndroid Lint是一个静态代码分析工具，它能够对你的Android项目中潜在的bug、可优化的代码、安全性、性能、可用性、可访问性、国际化等进行检查。">
  
    <link rel="alternative" href="/atom.xml" title="ljfxyj2008风巢" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
      <link href="//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css" rel="stylesheet">
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: false,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false,
      }
  </script>

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
      <script>
          var _hmt = _hmt || [];
          (function() {
              var hm = document.createElement("script");
              hm.src = "//hm.baidu.com/hm.js?449259d6f926d9e469b862f243275e59";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
          })();
      </script>
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/uploads/icon_leehom.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">ljfxyj2008</a></h1>
        </hgroup>

        
        <p class="header-subtitle">记录点滴</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/memo/">备忘</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:ljfxyj2008@gmail.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ljfxyj2008" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                                <li id="Facebook"><a class="Facebook" target="_blank" href="https://www.facebook.com/ljfxyj2008" title="Facebook"></a></li>
                            
                                <li id="StackOverflow"><a class="StackOverflow" target="_blank" href="http://stackoverflow.com/users/5788604/ljfxyj2008" title="StackOverflow"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Annotation/" style="font-size: 10px;">Annotation</a> <a href="/tags/EventBus/" style="font-size: 13.33px;">EventBus</a> <a href="/tags/FlatBuffers/" style="font-size: 10px;">FlatBuffers</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/IPC/" style="font-size: 10px;">IPC</a> <a href="/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/tags/Lint/" style="font-size: 16.67px;">Lint</a> <a href="/tags/Otto/" style="font-size: 10px;">Otto</a> <a href="/tags/Proguard/" style="font-size: 10px;">Proguard</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/custom-lint-rules/" style="font-size: 13.33px;">custom lint rules</a> <a href="/tags/facebook/" style="font-size: 10px;">facebook</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/system-server/" style="font-size: 10px;">system_server</a> <a href="/tags/zygote/" style="font-size: 13.33px;">zygote</a> <a href="/tags/反射/" style="font-size: 13.33px;">反射</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/安全/" style="font-size: 10px;">安全</a> <a href="/tags/并发/" style="font-size: 10px;">并发</a> <a href="/tags/库项目/" style="font-size: 10px;">库项目</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间轴/" style="font-size: 10px;">时间轴</a> <a href="/tags/源码分析/" style="font-size: 13.33px;">源码分析</a> <a href="/tags/观察者模式/" style="font-size: 10px;">观察者模式</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于Android应用开发</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">ljfxyj2008</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/uploads/icon_leehom.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">ljfxyj2008</a></h1>
            </hgroup>
            
            <p class="header-subtitle">记录点滴</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/memo/">备忘</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:ljfxyj2008@gmail.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ljfxyj2008" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                                <li id="Facebook"><a class="Facebook" target="_blank" href="https://www.facebook.com/ljfxyj2008" title="Facebook"></a></li>
                            
                                <li id="StackOverflow"><a class="StackOverflow" target="_blank" href="http://stackoverflow.com/users/5788604/ljfxyj2008" title="StackOverflow"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-浅谈Android自定义Lint规则的实现 （一）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html" class="article-date">
      <time datetime="2016-01-29T03:00:50.000Z" itemprop="datePublished">2016-01-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      浅谈Android自定义Lint规则的实现 （一）
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Lint/">Lint</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/custom-lint-rules/">custom lint rules</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>最近在做一个基于Android Lint的自定义静态代码检查功能库，这里做一个简单的总结。前半部分介绍SDK自带Android Lint的功能与配置使用方法，后半部分介绍扩展自定义Lint规则库的开发流程。</p>
<h2 id="什么是Android_Lint">什么是Android Lint</h2><p>Android Lint是一个静态代码分析工具，它能够对你的Android项目中潜在的bug、可优化的代码、安全性、性能、可用性、可访问性、国际化等进行检查。  </p>
<p>在Android SDK Tools 16及更高的版本中，Lint工具会自动安装。通过它对Android工程源代码进行扫描和检查，可发现潜在的问题，以便程序员及早修正这个问题。Android Lint提供了命令行方式执行，还与IDE（如Android Studio）进行了集成，并提供了xml和html形式的输出报告。  </p>
<p>看了上面的介绍可能大家依然很迷惑“这货到底有啥用”，其实我们平时在Android开发过程中一直在享受Lint带来的便利。比如，下面图中的警告和错误提示，相信大家应该很熟悉吧：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/23031672.jpg" alt=""></p>
<a id="more"></a>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/32957935.jpg" alt=""></p>
<p>上面的例子分别是java文件与Manifest文件在接受Lint检查后给出的简要lint报告，是Lint与IDE集成后的一种表现形式。事实上，Android Lint目前能检查的项目已经多达220项，检查的范围涵盖了二进制资源文件、java源代码、class文件、gradle配置文件、xml文件、resource文件夹、其他文件等。除了图中这种与IDE结合的简洁报告形式以外，也提供更详细的html和xml形式的报告，让你对自己代码质量的提升空间有更全面的认识。  </p>
<p>在Android Studio中，每一次编译程序时都会自动运行lint分析工具，也可以在需要lint分析的文件夹、包或文件上点击右键选择【Analyze】-&gt;【Inspect Code】。 生成的报告包含了检查过程中发现的问题，并把这些内容按照类别、优先级、严重程度进行了区分。  </p>
<p>Lint工具的处理流程如下图所示：<br><img src="http://developer.android.com/images/tools/lint.png" alt="Lint工作流">  </p>
<p>图中各部分含义如下：  </p>
<ul>
<li>Application source files： 构成你Android project的源文件，包含Java和XML文件，图标，以及ProGuard配置文件。</li>
<li>lint.xml： 配置文件，用来指定你想禁用哪些lint检查功能，以及自定义问题严重度(problem severity levels）。</li>
<li>lint Tool： 一个可以从命令行或Android Studio中运行的静态打码扫描工具。</li>
<li>lint Output： lint检查的结果，可以在命令行中通过lint查看，也可以在Android Studio的Event Log中查看。</li>
</ul>
<h2 id="Android_Lint检查哪些内容">Android Lint检查哪些内容</h2><p>Android Lint内置了很多lint规则，到现在为止是220项检查，总共可以分为以下几类：  </p>
<ul>
<li>Correctness 正确性</li>
<li>Security 安全性</li>
<li>Performance 性能</li>
<li>Usability 可用性</li>
<li>Accessibility 可访问性</li>
<li>Internationalization 国际化</li>
</ul>
<p>下面列举一些常见的lint会检测的代码问题：</p>
<ul>
<li>缺少翻译（和未使用的翻译）</li>
<li>布局性能问题（老的layoutopt工具会用于查找所有这样的问题，和除此之外更多的问题）</li>
<li>未使用的资源</li>
<li>不一致的数组大小（当在多个配置中定义数组）</li>
<li>可访问性和国际化问题（硬编码字符串，缺少contentDescription等）</li>
<li>图标问题 （如丢失密度、 重复图标、 错误尺寸等）</li>
<li>可用性问题 （如不在文本字段上指定输入的类型）</li>
<li>清单错误</li>
</ul>
<blockquote>
<p>如果要查看lint工具支持的issue的完整列表和它们所对应的issue ID，可以使用<code>lint --list</code>命令。</p>
</blockquote>
<h2 id="配置Android_Lint">配置Android Lint</h2><p>默认情况下，当你运行Lint扫描时，它会对Lint支持的所有issue进行检查。你也可以限制只让lint检查特定的issue，并为某些issue分配严重度（severity level）。<br>比如，你可以禁止lint检查那些与你的项目无关的issue，并为lint配置一个更低的severity level来让它报告那些不是非常严重的issue。  </p>
<p>你可以为lint检查配置不同的level：</p>
<ul>
<li>全局（对整个project）</li>
<li>每个project module</li>
<li>每个production module</li>
<li>每个test module</li>
<li>每个open files</li>
<li>每个class hierarchy</li>
<li>每个Version Control System (VCS) scopes</li>
</ul>
<h3 id="在Android_Studio中配置Lint">在Android Studio中配置Lint</h3><p>Android Studio允许你对lint每项检查单独启用或禁用，还可以对项目全局、特定文件夹、特定文件进行专门的lint配置。方法是在Android Studio中点击<code>File &gt; Settings &gt; Project Settings</code>菜单打开<code>Editor-&gt;Inspections</code>页面，里面有它支持的Profiles和Inspections列表，如图：<br><img src="http://developer.android.com/images/tools/studio-inspections-config.png" alt="Inspection Configuration"></p>
<h3 id="配置Lint文件">配置Lint文件</h3><p>你可以在lint.xml文件中指定你对lint检查的偏好设置。如果你要手动创建这个文件，就把它放在你的Android工程的根目录中。如果你是在Android Studio中配置lint偏好，那么lint.xml文件会自动创建并添加到你的Android工程中。  </p>
<p>lint.xml文件的组成结构是，最外面是一对闭合的<lint>标签，里面包含一个或多个<issue>子元素。每一个<issue>被唯一的id属性来标识，整体结构如下：</issue></issue></lint></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">lint</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- list of issues to configure --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">lint</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过设置<issue>标签中的severity属性值，你可以对某个issue禁用lint检查，或者修改某个issue的严重程度（severity level）。</issue></p>
<p>一个实例lint.xml文件如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">lint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Disable the given check in this project --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">issue</span> <span class="attribute">id</span>=<span class="value">"IconMissingDensityFolder"</span> <span class="attribute">severity</span>=<span class="value">"ignore"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Ignore the ObsoleteLayoutParam issue in the specified files --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">issue</span> <span class="attribute">id</span>=<span class="value">"ObsoleteLayoutParam"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ignore</span> <span class="attribute">path</span>=<span class="value">"res/layout/activation.xml"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ignore</span> <span class="attribute">path</span>=<span class="value">"res/layout-xlarge/activation.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">issue</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Ignore the UselessLeaf issue in the specified file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">issue</span> <span class="attribute">id</span>=<span class="value">"UselessLeaf"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ignore</span> <span class="attribute">path</span>=<span class="value">"res/layout/main.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">issue</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Change the severity of hardcoded strings to "error" --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">issue</span> <span class="attribute">id</span>=<span class="value">"HardcodedText"</span> <span class="attribute">severity</span>=<span class="value">"error"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">lint</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在Java源文件或XML源文件中配置lint检查">在Java源文件或XML源文件中配置lint检查</h3><h4 id="在Java中配置lint检查">在Java中配置lint检查</h4><p>要对Android项目中某个Java类或方法禁用lint检查，只需要对那段代码添加<code>@SuppressLint</code>注解即可。<br>下面的例子显示了如何对onCreate方法关闭NewApi这个issue的lint检查。lint工具仍然会对这个类的其他方法进行NewApi issue的检查。例子如下：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@SuppressLint</span>(<span class="string">"NewApi"</span>)</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.main);</span><br></pre></td></tr></table></figure>
<p>下面的例子显示如何对FeedProvider类关闭ParserError issue的lint检查：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@SuppressLint</span>(<span class="string">"ParserError"</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">FeedProvider</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ContentProvider</span> &#123;</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要在Java文件中禁用所有issue的lint检查，使用<code>all</code>关键字，比如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="function"><span class="title">SuppressLint</span><span class="params">(<span class="string">"all"</span>)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="在XML中配置lint检查">在XML中配置lint检查</h4><p>如果要对XML文件中某一部分禁用lint检查，可以使用<code>tools:ignore</code>属性来标识。为了让这个属性能够被lint工具识别，必须把下面的命名空间加入你的XML中：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">xmlns</span>:<span class="title">tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span><br></pre></td></tr></table></figure>
<p>下面的例子显示了如何对XML布局文件中的<linearlayout>元素禁用<code>UnusedResources</code> issue的lint检查。<code>ignore</code>属性会被该元素下的子元素继承，在这个例子中，子元素<textview>同样被禁用了lint检查。</textview></linearlayout></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> </span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">tools:ignore</span>=<span class="value">"UnusedResources"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"@string/auto_update_prompt"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>要禁用多个issue时，用逗号把它们分隔开，比如：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">tools:</span>ignore=<span class="string">"NewApi,StringFormatInvalid"</span></span><br></pre></td></tr></table></figure>
<p>要在某个XML元素中对所有issue都禁用lint检查，可以使用<code>all</code>关键字，比如：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">tools:</span>ignore=<span class="string">"all"</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义lint">自定义lint</h2><h3 id="为什么需要自定义lint">为什么需要自定义lint</h3><p>由于每个项目自身的需求，Android Lint默认的检查项目可能不能满足我们的需求。<br>比如我们自己写了一个下拉刷新的库项目，可以让用户直接在xml布局文件中去使用它，但是我们希望用户必须在这个xml元素中定义一个<code>pullmode</code>属性，否则组件无法正常运行，我们希望lint能够对此进行检查，并在用户忘记添加此属性时给出明确的错误提示。再比如，我们的项目中使用了自己封装的日志库，能够方便的在release版本中关闭日志输出来防止app的效率下降，该日志库还能够把日志输出到指定的文件中方便事后分析，这时有一位新成员加入了我们的开发，他可能还是习惯性的用android.util.Log来打印日志，我们希望能够检测到本项目中所有使用了android.util.Log的代码，并发出警告。<br>要满足这些自定义需求，我们就需要通过Android Lint的扩展机制自己定制lint规则。  </p>
<h3 id="自定义lint如何使用">自定义lint如何使用</h3><p>自定义lint是一个纯java项目，以jar的形式输出。有了包含lint规则的jar后，有两种使用方案：</p>
<ul>
<li>方案一：把此jar拷贝到 ~/.android/lint/ 目录中（文件名任意）。此时，这些lint规则针对所有项目生效。</li>
<li>方案二：继续创建一个Android library项目，用来输出包含lint.jar的aar；然后，让目标项目依赖此aar即可使自定义lint规则生效。</li>
</ul>
<p>由于方案一是全局生效的策略，无法单独针对目标项目，用处不大。在工程实践中，我们主要使用方案二。</p>
<p>AAR是Android Library的一种新的二进制分发格式，它把资源也一起打包，这样一来图片和布局资源文件也能够被同时分发。AAR格式文件能够包含一个可选的lint.jar文件，如果一个app依赖了一个包含lint.jar的aar文件，那么这个lint.jar中的规则就会在app的lint任务中被用来做lint检查。</p>
<h3 id="自定义lint实现原理">自定义lint实现原理</h3><p>自定义lint规则是以jar形式存在的，主要通过继承两种类来实现扩展lint功能：<br>①继承<code>IssueRegistry</code>：这是自定义Lint规则的主类或者叫注册类，有且仅有一个，用来注册这个自定义Lint项目中有哪些自定义的issue（issue就是需要lint检查出来并报告给用户的各种问题）需要被检测。<br>②继承<code>Detector</code>并选择Detector中合适的<code>XXXScanner</code>接口来实现：在这里根据自身业务需求，实现各种自定义探测器（Detector),并定义各种issue，根据自身需求的不同这样的类可以有一个或多个。</p>
<p>事实上，Android系统默认的lint检查功能是通过BuiltinIssueRegistry类来定义的，在这个类的源码中可以看到定义的各种issue、detector，如图：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/69265121.jpg" alt=""></p>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-29/59960096.jpg" alt="">  </p>
<p>com.android.tools.lint.detector.api.Detector提供了7种XXXScanner接口，根据自身需要选择合适的接口去实现，下面把这7个接口的信息列出：</p>
<p>1、JavaScanner<br>功能：Specialized interface for detectors that scan Java source file parse trees<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/55021440.jpg" alt=""></p>
<p>2、ClassScanner<br>功能：Specialized interface for detectors that scan Java class files<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/63801235.jpg" alt=""></p>
<p>3、BinaryResourceScanner<br>功能：Specialized interface for detectors that scan binary resource files<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/31784308.jpg" alt=""></p>
<p>4、ResourceFolderScanner<br>功能：Specialized interface for detectors that scan resource folders (the folder directory itself, not the individual files within it）<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/81593485.jpg" alt=""></p>
<p>5、XmlScanner<br>功能：Specialized interface for detectors that scan XML files<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/1707982.jpg" alt=""></p>
<p>6、GradleScanner<br>功能：Specialized interface for detectors that scan Gradle files<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/5157796.jpg" alt=""></p>
<p>7、OtherFileScanner<br>功能：Specialized interface for detectors that scan other files<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/94526179.jpg" alt=""></p>
<p><strong>实现自定义Lint规则的过程，实际上就是实现detector的过程，每个detector能够定义1个或多个不同类型的issue。</strong>也就是说，一个detector能够检测多种issue，这些issue在逻辑上是有关联的，但这些issue可以拥有不同的严重程度、描述等，并能够独立地被抑制(suppress，即禁用对该issue的检查）。</p>
<h2 id="自定义lint实战">自定义lint实战</h2><p>下面简单演示一下开发一个自定义Lint规则的完整流程。  </p>
<p>【1】在Android Studio中，打开或新建一个工程，然后点击【File -&gt; New -&gt; New Module】，在弹出窗口中选择新建一个Java Library，如图：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/98524820.jpg" alt=""></p>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/27544737.jpg" alt=""></p>
<p>我们这里把Java Library命名为ljflintrules。</p>
<p>【2】自定义lint规则需要继承一些特定的类，所以需要在ljflintrules的build.gradle中添加依赖:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span> <span class="string">'com.android.tools.lint:lint-api:24.3.1'</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">'com.android.tools.lint:lint-checks:24.3.1'</span></span><br></pre></td></tr></table></figure>
<p>【3】在ljflintrules中新建一个LoggerUsageDetector类，用来检测用户代码中是否使用了<code>android.util.Log</code>类，如果有，就报告一个issue，代码如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LoggerUsageDetector</span> <span class="keyword">extends</span> <span class="title">Detector</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title">Detector</span>.<span class="title">ClassScanner</span> </span>&#123;</span><br><span class="line">    public <span class="literal">static</span> <span class="keyword">final</span> Issue ISSUE = Issue.create(<span class="string">"LogUtilsNotUsed"</span>,</span><br><span class="line">            <span class="string">"You must use our `LogUtils`"</span>,</span><br><span class="line">            <span class="string">"Logging should be avoided in production for security and performance reasons. Therefore, we created a LogUtils that wraps all our calls to Logger and disable them for release flavor."</span>,</span><br><span class="line">            Category.MESSAGES,</span><br><span class="line">            <span class="number">9</span>,</span><br><span class="line">            Severity.ERROR,</span><br><span class="line">            <span class="keyword">new</span> Implementation(LoggerUsageDetector.<span class="keyword">class</span>,</span><br><span class="line">                    Scope.CLASS_FILE_SCOPE));</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; getApplicableCallNames() &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="string">"v"</span>, <span class="string">"d"</span>, <span class="string">"i"</span>, <span class="string">"w"</span>, <span class="string">"e"</span>, <span class="string">"wtf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; getApplicableMethodNames() &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="string">"v"</span>, <span class="string">"d"</span>, <span class="string">"i"</span>, <span class="string">"w"</span>, <span class="string">"e"</span>, <span class="string">"wtf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="keyword">void</span> checkCall(<span class="annotation">@NonNull</span> ClassContext context,</span><br><span class="line">                          <span class="annotation">@NonNull</span> ClassNode classNode,</span><br><span class="line">                          <span class="annotation">@NonNull</span> MethodNode method,</span><br><span class="line">                          <span class="annotation">@NonNull</span> MethodInsnNode call) &#123;</span><br><span class="line">        <span class="built_in">String</span> owner = call.owner;</span><br><span class="line">        <span class="keyword">if</span> (owner.startsWith(<span class="string">"android/util/Log"</span>)) &#123;</span><br><span class="line">            context.report(ISSUE,</span><br><span class="line">                    method,</span><br><span class="line">                    call,</span><br><span class="line">                    context.getLocation(call),</span><br><span class="line">                    <span class="string">"You must use our `LogUtils`"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码中，我们定义了一个ISSUE，定义时传入的6个参数意义如下：</p>
<ul>
<li><code>LogUtilsNotUseds</code>: 我们这条lint规则的id，这个id必须是独一无二的。  </li>
<li><code>You must use our &#39;LogUtils&#39;</code>：对这条lint规则的简短描述。</li>
<li><code>Logging should be avoided in production for security and performance reasons. Therefore, we created a LogUtils that wraps all our calls to Logger and disable them for release flavor.</code>：对这条lint规则更详细的解释。</li>
<li><code>Category.MESSAGES</code>：类别。</li>
<li><code>9</code>：优先级，必须在1到10之间。</li>
<li><code>Severity.ERROR</code>：严重程度。其他可用的严重程度还有FATAL、WARNING、INFORMATIONAL、IGNORE。</li>
<li><code>Implementation</code>：这是连接Detector与Scope的桥梁，其中Detector的功能是寻找issue，而scope定义了在什么范围内查找issue。在我们的例子中，我们需要在字节码级别分析用户有没有使用<code>android.util.Log</code>。</li>
</ul>
<p>这个类中针对字节码中的android/util/Log进行了检查，并在发现时报告LogUtilsNotUsed这个issue。你也可以在这个类中定义多个issue，然后在代码逻辑中（比如checkCall方法中）针对不同的情况，抛出不同的issue。也就是说，一个XXXDetector是可以报告多种issue的。<br>如果需要检测更多问题，你也可以定义更多的XXXDetector类。XXXDetector类可以有多个。</p>
<p>【4】在ljflintrules中新建一个MyIssueRegistry类，它继承自<code>IssueRegistry</code>。这个类用来注册我们自己定义了哪些issue，这样lint在检查代码时才知道要针对哪些issue进行检查。代码如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyIssueRegistry</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">IssueRegistry</span> &#123;</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="type">List</span>&lt;<span class="type">Issue</span>&gt; getIssues() &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"!!!!!!!!!!!!! ljf MyIssueRegistry lint rules works"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Arrays</span>.asList(<span class="type">LoggerUsageDetector</span>.<span class="type">ISSUE</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个类中只有一个方法，就是返回一个List，其中包含了我们自定义的所有issue。<br>这里我们为了能够在控制台中清楚的看到我们自定义的lint规则是否被调用了，所以打印了一行提示信息。    </p>
<p>【5】对于自定义lint生成的jar，我们必须在它的清单文件中指明它的主类。这里我们通过配置ljflintrules的build.gradle文件来完成这项工作：</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="name">jar</span> &#123;</span><br><span class="line">    <span class="literal">manifest</span> &#123;</span><br><span class="line">        attributes(<span class="string">'Lint-Registry'</span>: <span class="string">'com.ljf.lintrules.MyIssueRegistry'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，你可以在控制台中通过命令<code>./gradlew ljflintrules:assemble</code>来执行编译任务，就可以输出我们需要的jar文件了。你可以在ljflintrules工程目录的<code>build/libs/</code>下找到ljflintrules.jar。  </p>
<p>如果你想验证这个jar文件是不是真的有效，可以把它拷贝到<code>~/.android/lint/</code>目录下，然后在终端中输入<code>lint --show LogUtilsNotUsed</code>看看有没有输出我们定义的issue信息，有则表明自定义lint成功，如图：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/27617933.jpg" alt=""></p>
<p>测试完后记得把它从<code>~/.android/lint/</code>中删除。</p>
<p>【6】由于我们要把上一步生成的jar文件包含到一个aar中便于用户使用，所以我们还要在ljflintrules的build.gradle文件中添加以下信息：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">configurations</span> &#123;</span><br><span class="line">    <span class="title">lintJarOutput</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="title">lintJarOutput</span> files(jar)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defaultTasks <span class="string">'assemble'</span></span><br></pre></td></tr></table></figure>
<p>经过以上所有步骤，现在ljflintrules的build.gradle文件看起来是这样的：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'java'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.tools.lint:lint-api:24.3.1'</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.tools.lint:lint-checks:24.3.1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes(<span class="string">'Lint-Registry'</span>: <span class="string">'com.ljf.lintrules.MyIssueRegistry'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">configurations</span> &#123;</span><br><span class="line">    lintJarOutput</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    lintJarOutput files(jar)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defaultTasks <span class="string">'assemble'</span></span><br></pre></td></tr></table></figure>
<p>【7】新建一个Android Library项目，命名为ljflintrule_aar，用来输出aar，步骤如下：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-7/98524820.jpg" alt=""></p>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/8544219.jpg" alt=""></p>
<p>在ljflintrule_aar的build.gradle的根节点加入以下内容：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * rules for including "lint.jar" in aar</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">configurations</span> &#123;</span><br><span class="line">    lintJarImport</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    lintJarImport <span class="keyword">project</span>(path: <span class="string">":ljflintrules"</span>, configuration: <span class="string">"lintJarOutput"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> copyLintJar(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">    <span class="keyword">from</span> (<span class="keyword">configurations</span>.lintJarImport) &#123;</span><br><span class="line">        rename &#123;</span><br><span class="line">            String fileName -&gt;</span><br><span class="line">                <span class="string">'lint.jar'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">into</span> <span class="string">'build/intermediates/lint/'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>.afterEvaluate &#123;</span><br><span class="line">    <span class="keyword">def</span> compileLintTask = <span class="keyword">project</span>.tasks.<span class="keyword">find</span> &#123; it.name == <span class="string">'compileLint'</span> &#125;</span><br><span class="line">    compileLintTask.dependsOn(copyLintJar)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果这时再编译项目，就会在ljflintrule_aar的输出目录中得到一个包含lint.jar的aar文件，这里的lint.jar就是我们在第5步中生成的ljflintrules.jar，只是换了个名字。</p>
<p>【8】在用户app中使用我们的自定义lint。<br>在用户自己的应用程序module中（我们这里就使用app module），打开app的build.gradle文件，在dependencies中加入以下依赖：  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="function"><span class="title">project</span><span class="params">(<span class="string">':ljflintrule_aar'</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>这里我们在app的MainActivity中使用了android自带的Log功能：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">AppCompatActivity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="type">Log</span>.d(<span class="string">"tag"</span>, <span class="string">"dasfadsf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端中，我们执行<code>./gradlew lint</code>来执行lint任务，可以在终端中看到以下输出：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/11713429.jpg" alt=""></p>
<p>输出中指出发现了1个error和2个warning，并给出了详细报告的地址。</p>
<p>我们在浏览器中打开html格式的详细报告，如下图所示：<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/16-1-8/9825338.jpg" alt=""></p>
<p>以上8个步骤完整演示了如何自定义lint并使用它。</p>
<h2 id="小结">小结</h2><p>本文对于自定义Lint规则的介绍主要是集中在总体开发流程，给出了一个简单的实例。在实际开发过程中，我们比较常见的需求是针对xml布局文件、java源代码等内容进行某些检查，受Lint开发API的限制需要用到AST的相关知识，以及lombok.ast开源库。由于lombok.ast开源库几乎无文档可用，所以还是需要花一定时间来阅读这个库的源码，并熟悉SDK自带的Lint源码如何使用这个库。如果你对自定义Lint感兴趣，可以关注下一篇文章的相关介绍。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html">浅谈Android自定义Lint规则的实现 （一）</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">ljfxyj2008</a></p>
        <p><span>发布时间:</span>2016-01-29, 11:00:50</p>
        <p><span>最后更新:</span>2016-04-01, 17:08:49</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html" title="浅谈Android自定义Lint规则的实现 （一）">http://www.carrotsight.com/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html</a>
            <span class="copy-path" data-clipboard-text="原文: http://www.carrotsight.com/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html　　作者: ljfxyj2008" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/02/01/浅谈Android自定义Lint规则的实现 （二）.html">
                    浅谈Android自定义Lint规则的实现 （二）
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/01/13/2016-1-13-Java中的Pluggable-Annotation-Processing-API.html">
                    Java中的Pluggable Annotation Processing API
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Android_Lint"><span class="toc-number">1.</span> <span class="toc-text">什么是Android Lint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android_Lint检查哪些内容"><span class="toc-number">2.</span> <span class="toc-text">Android Lint检查哪些内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置Android_Lint"><span class="toc-number">3.</span> <span class="toc-text">配置Android Lint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在Android_Studio中配置Lint"><span class="toc-number">3.1.</span> <span class="toc-text">在Android Studio中配置Lint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置Lint文件"><span class="toc-number">3.2.</span> <span class="toc-text">配置Lint文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在Java源文件或XML源文件中配置lint检查"><span class="toc-number">3.3.</span> <span class="toc-text">在Java源文件或XML源文件中配置lint检查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#在Java中配置lint检查"><span class="toc-number">3.3.1.</span> <span class="toc-text">在Java中配置lint检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在XML中配置lint检查"><span class="toc-number">3.3.2.</span> <span class="toc-text">在XML中配置lint检查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义lint"><span class="toc-number">4.</span> <span class="toc-text">自定义lint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么需要自定义lint"><span class="toc-number">4.1.</span> <span class="toc-text">为什么需要自定义lint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义lint如何使用"><span class="toc-number">4.2.</span> <span class="toc-text">自定义lint如何使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义lint实现原理"><span class="toc-number">4.3.</span> <span class="toc-text">自定义lint实现原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义lint实战"><span class="toc-number">5.</span> <span class="toc-text">自定义lint实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




    <div class="share">
    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
    <a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
    <a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
    </div>
    <script>
        window._bd_share_config={
            "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>



    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html" data-title="浅谈Android自定义Lint规则的实现 （一）" data-url="http://www.carrotsight.com/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"carrotsight"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/02/01/浅谈Android自定义Lint规则的实现 （二）.html" title="上一篇: 浅谈Android自定义Lint规则的实现 （二）">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/01/13/2016-1-13-Java中的Pluggable-Annotation-Processing-API.html" title="下一篇: Java中的Pluggable Annotation Processing API">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/21/Android Lint工作原理剖析.html">Android Lint工作原理剖析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/25/system_server启动过程.html">System_server启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/24/Zygote启动过程.html">Zygote启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/学习笔记：Android中的View.html">学习笔记：Android中的View</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/29/学习笔记：Android的IPC机制.html">学习笔记：Android中的IPC机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/浅谈Android自定义Lint规则的实现 （二）.html">浅谈Android自定义Lint规则的实现 （二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/29/浅谈Android自定义Lint规则的实现 （一）.html">浅谈Android自定义Lint规则的实现 （一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/13/2016-1-13-Java中的Pluggable-Annotation-Processing-API.html">Java中的Pluggable Annotation Processing API</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/22/Android中的Proguard.html">Android中的Proguard</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/09/可缩放时间轴和录像片段选择器的实现.html">可缩放时间轴和录像片段选择器的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/13/一个android日志库的实现.html">一个android日志库的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/10/FlatBuffers学习总结.html">FlatBuffers学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/19/2015-9-19-Android编程要注意的安全规范.html">Android编程要注意的安全规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/16/2015-9-16-《Think-in-Java》类型信息-–-学习笔记.html">《Think in Java》类型信息 – 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/15/2015-9-15-Otto学习笔记.html">Otto学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/14/2015-9-14-EventBus学习总结.html">EventBus学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/08/2015-9-8-《Think-in-Java》并发-学习笔记.html">《Think in Java》并发 - 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/12/02/2013-12-2-FLEX无法启动服务因为fml文件损坏.html">【FLEX bug:无法启动服务，因为fml文件损坏】的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/04/03/2013-4-3-Flex中datagrid中checkbox的全选实现.html">Flex中datagrid中checkbox的全选实现</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 ljfxyj2008
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 3;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-73957282-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

    <script src="//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js"></script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>