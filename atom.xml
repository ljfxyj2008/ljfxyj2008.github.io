<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[ljfxyj2008çš„å°ç«™]]></title>
  <subtitle><![CDATA[è®°å½•ç‚¹æ»´]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://www.carrotsight.com/"/>
  <updated>2015-12-03T08:08:34.000Z</updated>
  <id>http://www.carrotsight.com/</id>
  
  <author>
    <name><![CDATA[ljfxyj2008]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[ä¸€ä¸ªandroidæ—¥å¿—åº“çš„å®ç°]]></title>
    <link href="http://www.carrotsight.com/2015/11/13/%E4%B8%80%E4%B8%AAandroid%E6%97%A5%E5%BF%97%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0.html"/>
    <id>http://www.carrotsight.com/2015/11/13/ä¸€ä¸ªandroidæ—¥å¿—åº“çš„å®ç°.html</id>
    <published>2015-11-13T06:12:58.000Z</published>
    <updated>2015-12-03T08:08:34.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è°ƒç ”">è°ƒç ”</h1><p>åœ¨androidå¼€å‘ä¸­ï¼Œå¦‚æœéœ€è¦æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œå¾€å¾€ä¼šä½¿ç”¨Log.d()ã€Log.e()ä¹‹ç±»çš„ç”±android.util.Logæä¾›çš„æ–¹æ³•ã€‚å®ƒçš„å¥½å¤„æ˜¯ç®€å•ã€æ–¹ä¾¿ï¼Œä¸è¶³ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯å®šåˆ¶æ€§å·®ï¼Œä¸èƒ½æ‰“å°åˆ°æ–‡ä»¶ã€‚å¦‚æœæƒ³åœ¨å‘è¡Œç‰ˆappä¸­çš„æŸäº›å…³é”®è¯­å¥æ‰“å°logåˆ°æ–‡ä»¶ï¼Œæˆ–è€…åœ¨appå´©æºƒæ—¶æŠŠå´©æºƒä¿¡æ¯æ‰“å°åˆ°æ–‡ä»¶ä¾›ä¸Šä¼ åˆ†æï¼Œé‚£ä¹ˆandroid.util.Logå°±æ— èƒ½ä¸ºåŠ›äº†ã€‚<br><a id="more"></a><br>åœ¨ç½‘ä¸Šåšäº†ä¸€ä¸‹androidå¹³å°æ—¥å¿—åº“çš„è°ƒç ”ï¼ŒæŒ‘å‡ºä¸€äº›æ¯”è¾ƒæœ‰ä»£è¡¨æ€§æœ‰å½±å“åŠ›çš„ï¼Œå¤§è‡´ç»“æœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>â‘ orhanobut/loggerï¼š<br>æ¥è‡ªgithub.comï¼Œæˆªæ­¢2015å¹´11æœˆ10æ—¥15:53:20è¯¥é¡¹ç›®å·²ç»æœ‰1996é¢—æ˜Ÿï¼ï¼ï¼<br>åœ°å€ï¼š<a href="https://github.com/orhanobut/logger" target="_blank" rel="external">https://github.com/orhanobut/logger</a></p>
<p>â‘¡JakeWharton/timberï¼š<br>æ¥è‡ªgithub.comï¼Œæˆªæ­¢2015å¹´11æœˆ10æ—¥15:54:22è¯¥é¡¹ç›®å·²ç»æœ‰1571é¢—æ˜Ÿï¼ï¼ï¼<br>åœ°å€ï¼š<a href="https://github.com/JakeWharton/timber" target="_blank" rel="external">https://github.com/JakeWharton/timber</a></p>
<p>â‘¢noveogroup/android-loggerï¼š<br>æ¥è‡ªgithub.comï¼Œæˆªæ­¢2015å¹´11æœˆ10æ—¥15:55:56è¯¥é¡¹ç›®å·²ç»æœ‰125é¢—æ˜Ÿï¼ˆè·Ÿä¸Šé¢ä¸¤ä½æ¯”å·®çš„æŒºå¤šï¼‰ã€‚<br>åœ°å€ï¼š<a href="https://github.com/noveogroup/android-logger" target="_blank" rel="external">https://github.com/noveogroup/android-logger</a></p>
<p>â‘£SLF4Jï¼š<br>å®ƒåªæ˜¯ä¸€ä¸ªå¯¹logç³»ç»Ÿè¿›è¡ŒæŠ½è±¡çš„è¡¨ç°å½¢å¼ï¼Œä¸æ˜¯å…·ä½“çš„å®ç°ã€‚å®ƒæ”¯æŒç¬¬ä¸‰æ–¹logæ¡†æ¶ï¼Œæ¯”å¦‚log4jç­‰ã€‚å¦‚æœéœ€è¦æŒ‡å®šç¬¬ä¸‰æ–¹logæ¡†æ¶ï¼Œåªéœ€è¦åœ¨è¿è¡Œæ—¶æŠŠå¯¹åº”çš„slf4jçš„jaræ–‡ä»¶æ”¾åœ¨ä½ çš„class pathä¸­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨bindè¯¥logæ¡†æ¶ã€‚æ¯”å¦‚ï¼Œè¦ä»java.util.loggingä¸­åˆ‡æ¢åˆ°log4jï¼Œåªéœ€è¦æŠŠslf4j-jdk-1.7.12.jaræ›¿æ¢ä¸ºslf4j-log4j12-1.7.12.jarå³å¯ã€‚<br>åœ°å€ï¼š<a href="http://www.slf4j.org/download.html" target="_blank" rel="external">http://www.slf4j.org/download.html</a></p>
<p>â‘¤SLF4J-Androidï¼š<br>SLF4J-Androidæ˜¯å¯¹SLF4Jçš„APIçš„é‡æ–°åŒ…è£…ï¼Œä»¥åŠä¸€ä¸ªè½»é‡çº§çš„bindå®ç°ã€‚è¯¥å®ç°ç®€å•çš„æŠŠæ‰€æœ‰çš„SLF4Jçš„logè¯·æ±‚éƒ½ç”¨Androidçš„Logå·¥å…·è¿›è¡Œäº†æ›¿æ¢ã€‚åŠŸèƒ½ä¸SLF4Jç±»ä¼¼ã€‚ä¸è¿‡åªæ”¯æŒ23ä¸ªå­—ç¬¦é•¿åº¦çš„Tagï¼Œä¾‹å¦‚com.example.myapp.MyClassä¼šè¢«æˆªæ–­ä¸ºc*.e*.m*.MyClassï¼Œä¼šå¯¼è‡´ä¸åŒçš„ç±»åœ¨tagä¸­æ˜¾ç¤ºåŒæ ·çš„åç§°ï¼Œå¼•èµ·æ··æ·†ã€‚<br>åœ°å€ï¼š<a href="http://www.slf4j.org/android/" target="_blank" rel="external">http://www.slf4j.org/android/</a></p>
<p>â‘¥ LOGBackï¼š<br>LOGBackä¸Log4Jçš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººã€‚ä½œè€…æ›´æ¨èä½¿ç”¨LOGBackã€‚å…·ä½œè€…è¯´LOGBackåœ¨æŸäº›è‹›åˆ»çš„æ‰§è¡Œè·¯å¾„ä¸‹ï¼Œæ¯”log4jå·®ä¸å¤šè¦å¿«10å€ï¼Œç»è¿‡äº†é•¿æœŸè€Œå¹¿æ³›çš„æµ‹è¯•ï¼Œæ¯”log4jæ›´ä¸ºå¯é ã€‚ä¸è¿‡è¿™è´§æ˜¯ä¸ªé‡é‡çº§é€‰æ‰‹ï¼ŒåŠŸèƒ½å¤ªå…¨ï¼Œä½“ç§¯åºå¤§ã€‚<br>åœ°å€ï¼š<a href="http://logback.qos.ch/" target="_blank" rel="external">http://logback.qos.ch/</a></p>
<p>â‘¦android-logging-log4jï¼š<br>å†…éƒ¨ä½¿ç”¨log4jï¼Œæ”¯æŒslf4j;é€‚ç”¨äºlog4jçš„LogCatAppenderï¼Œå®ƒèƒ½å¤ŸæŠŠlogæ‰“å°åˆ°LogCat;æä¾›äº†ä¸€ä¸ªlog4jçš„é…ç½®è£…é¥°ç±»ï¼Œç”¨å®ƒèƒ½å¤Ÿæ–¹ä¾¿åœ°é…ç½®Log4J;åŒæ—¶ä¸éœ€è¦ä¿®æ”¹log4j.jaræ–‡ä»¶ã€‚<br>åœ°å€ï¼š<a href="https://code.google.com/p/android-logging-log4j/" target="_blank" rel="external">https://code.google.com/p/android-logging-log4j/</a></p>
</blockquote>
<p>å‰ä¸‰ä¸ªåº“æ˜¯ä¸“ä¸ºandroidè®¾è®¡çš„ï¼Œå¯ä»¥çœ‹åˆ°æ”¯æŒè€…ä¼—å¤šï¼Œä¸è¿‡å®ƒä»¬å†…éƒ¨å®ç°ä¸Šä¹Ÿæ˜¯è°ƒç”¨android.util.Logçš„æ–¹æ³•æ‰“å°åˆ°æ§åˆ¶å°ï¼Œä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚åé¢çš„å‡ ä¸ªåº“ä¸­æœ‰ä¸€äº›é€‰æ‰‹éå¸¸å…¨èƒ½ï¼Œä¸è¿‡ä½“ç§¯è¾ƒå¤§ï¼Œå¾ˆå¤šåŠŸèƒ½æ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„ï¼Œè€Œä¸”å®ƒä¹Ÿæ— æ³•å¾ˆæ–¹ä¾¿çš„æ‰©å±•è‡ªå®šä¹‰çš„æ—¥å¿—å®ç°ï¼Œæ¯”å¦‚appå´©æºƒä¿¡æ¯è·å–ã€æ—¥å¿—æ–‡ä»¶åå°ä¸Šä¼ ç­‰ã€‚äºæ˜¯ä¹å¼€å§‹è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªæ—¢æ–¹ä¾¿å®ç”¨ï¼Œèƒ½è¦†ç›–åŸºæœ¬çš„æ§åˆ¶å°ã€æ–‡ä»¶è¾“å‡ºï¼Œåˆä¾¿äºè‡ªå®šä¹‰æ‰©å±•çš„androidæ—¥å¿—åº“ã€‚</p>
<h1 id="gradleç›´æ¥é…ç½®æ—¥å¿—åº“">gradleç›´æ¥é…ç½®æ—¥å¿—åº“</h1><p>log4jæœ€å¼ºå¤§æ–¹ä¾¿çš„åœ°æ–¹åº”è¯¥å°±æ˜¯å®ƒå¯ä»¥ç›´æ¥é€šè¿‡propertyæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚è¿™é‡Œç”±äºæˆ‘ä»¬å®ç”¨Android Studioè¿›è¡Œå¼€å‘ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿç›´æ¥é€šè¿‡build.gradleæ–‡ä»¶å¯¹æˆ‘ä»¬çš„æ—¥å¿—åº“è¿›è¡Œé…ç½®ã€‚åœ¨ç½‘ä¸Šæœç´¢äº†è‰¯ä¹…ï¼Œå‘ç°å¯ä»¥åœ¨buildTypesä¸­åˆ†åˆ«ä¸ºdebugç‰ˆæœ¬å’Œreleaseç‰ˆæœ¬ï¼ˆç”šè‡³æ›´å¤šå…¶ä»–è‡ªå®šä¹‰ç‰ˆæœ¬ï¼‰å®šä¹‰ä¸åŒçš„buildConfigFieldå‚æ•°ï¼Œç„¶ååœ¨javaä»£ç ä¸­é€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„BuildConfigæ–‡ä»¶è¿›è¡Œè¯»å–ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘åœ¨moduleçš„build.gradeæ–‡ä»¶ä¸­åšäº†å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//Logger settings for release mode</span></span><br><span class="line">            <span class="comment">//ä»¥ä¸‹æ˜¯é…ç½®MyLogæ‰“å°åŠŸèƒ½çš„å„é¡¹å‚æ•°</span></span><br><span class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"logLevel"</span>, <span class="string">"\"VERBOSE\""</span>)<span class="comment">//è®¾ç½®å½“å‰logçš„æ‰“å°çº§åˆ«ã€‚æ”¯æŒçš„æ‰“å°çº§åˆ«åˆ†åˆ«ä¸ºï¼šVERBOSE,DEBUG,INFO,WARN,ERROR,ASSERTã€‚ä¸logcatçš„çº§åˆ«ä¸€ä¸€å¯¹åº”ã€‚åªæœ‰ç­‰äºæˆ–é«˜äºæ­¤çº§åˆ«çš„logæ‰ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</span></span><br><span class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"logToSDDirName"</span>, <span class="string">"\"MyLogs-release\""</span>)<span class="comment">//å¦‚æœè®¾ç½®äº†æ‰“å°åˆ°æ–‡ä»¶ï¼Œåˆ™æ­¤å­—æ®µæŒ‡å®šæŠŠæ—¥å¿—æ‰“å°åˆ°SDå¡çš„å“ªä¸ªç›®å½•</span></span><br><span class="line">            buildConfigField(<span class="string">"int"</span>, <span class="string">"singleLogFileSizeLimit"</span>, <span class="string">"10"</span>)<span class="comment">//å¦‚æœè®¾ç½®äº†æ‰“å°åˆ°æ–‡ä»¶ï¼Œåˆ™æ­¤å­—æ®µè®¾ç½®å•ä¸ªlogæ–‡ä»¶çš„å¤§å°ä¸Šé™ï¼Œå•ä½æ˜¯MB</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            <span class="comment">//Logger settings for debug mode</span></span><br><span class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"logLevel"</span>, <span class="string">"\"DEBUG\""</span>)<span class="comment">//è®¾ç½®å½“å‰logçš„æ‰“å°çº§åˆ«ã€‚æ”¯æŒçš„æ‰“å°çº§åˆ«åˆ†åˆ«ä¸ºï¼šVERBOSE,DEBUG,INFO,WARN,ERROR,ASSERTã€‚ä¸logcatçš„çº§åˆ«ä¸€ä¸€å¯¹åº”ã€‚åªæœ‰ç­‰äºæˆ–é«˜äºæ­¤çº§åˆ«çš„logæ‰ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</span></span><br><span class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"logToSDDirName"</span>, <span class="string">"\"MyLogs-debug\""</span>)<span class="comment">//å¦‚æœè®¾ç½®äº†æ‰“å°åˆ°æ–‡ä»¶ï¼Œåˆ™æ­¤å­—æ®µæŒ‡å®šæŠŠæ—¥å¿—æ‰“å°åˆ°SDå¡çš„å“ªä¸ªç›®å½•</span></span><br><span class="line">            buildConfigField(<span class="string">"int"</span>, <span class="string">"singleLogFileSizeLimit"</span>, <span class="string">"10"</span>)<span class="comment">//å¦‚æœè®¾ç½®äº†æ‰“å°åˆ°æ–‡ä»¶ï¼Œåˆ™æ­¤å­—æ®µè®¾ç½®å•ä¸ªlogæ–‡ä»¶çš„å¤§å°ä¸Šé™ï¼Œå•ä½æ˜¯MB</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå°±å¯ä»¥åœ¨å¯¹åº”moduleçš„javaä»£ç ä¸­è¿›è¡Œè¯»å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = BuildConfig.logMethodDepth;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ¡ˆå¹¶æ²¡æœ‰é—®é¢˜ï¼Œä¸è¿‡æ¥ä¸‹æ¥å´è¸©è¿›äº†ä¸€ä¸ªå‘ï¼Œå› ä¸ºæˆ‘ä¸‹æ„è¯†çš„æŠŠè¿™äº›é…ç½®éƒ½å†™åœ¨äº†æˆ‘çš„Logåº“moduleä¸­ï¼ŒåŒæ ·ï¼Œå¯¹é…ç½®å‚æ•°ï¼ˆå¦‚logMethodDepthç­‰ï¼‰çš„è¯»å–ä¹Ÿæ˜¯åœ¨Logåº“moduleçš„javaä»£ç ä¸­ã€‚è¿™æ ·å°±å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯åæ¥æ‰æ„è¯†åˆ°çš„ï¼š</p>
<ul>
<li>å‘â‘ ï¼š<br>Gradleç›®å‰æœ‰ä¸€ä¸ªbugï¼šä½ åœ¨åº“é¡¹ç›®çš„build.gradleä¸­å®šä¹‰äº†releaseå’Œdebugä¸¤ç§é…ç½®ï¼Œç„¶åä¸è®ºä½ çš„Build Variantsæ˜¯é€‰æ‹©debugè¿˜æ˜¯releaseï¼Œé»˜è®¤éƒ½åªä¼šç¼–è¯‘releaseç‰ˆæœ¬ã€‚åœ¨stackoverflowä¸Šæœç´¢åå‘ç°å¥½å‡ å¹´å‰å°±å·²ç»æœ‰äººåœ¨æè¿™ä¸ªé—®é¢˜äº†ï¼Œä¸è¿‡ç›´åˆ°æ—¥å‰åœ¨androidå¼€å‘è€…ç½‘ç«™ä¸Šä»ç„¶æŠŠè¿™ä¸ªé—®é¢˜åˆ—ä¸ºå¸Œæœ›åœ¨å°†æ¥è§£å†³çš„é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜åæ¥é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒç»•çš„æ–¹æ³•è§£å†³äº†ï¼Œå°±æ˜¯åœ¨Logåº“moduleçš„build.gradleä¸­åŠ å…¥defaultPublishConfigé…ç½®ï¼Œå˜æˆè¿™æ ·ï¼š</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">23</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœè¦ä½¿ç”¨buildTypesä¸­debugç‰ˆçš„logé…ç½®ï¼Œåˆ™è®¾ç½®ä¸ºdebugï¼›å¦åˆ™ï¼Œè®¾ç½®ä¸ºrelease</span></span><br><span class="line">        defaultPublishConfig <span class="string">"debug"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥æŒ‡å®šæ˜¯ä½¿ç”¨debugç‰ˆè¿˜æ˜¯releaseç‰ˆçš„é…ç½®äº†ã€‚ä¸è¿‡è¿™æ ·çš„åº“æä¾›ç»™ç”¨æˆ·ä¹Ÿå¤Ÿéº»çƒ¦çš„ï¼Œå› ä¸ºç”¨æˆ·ä¸ä»…è¦è®¾ç½®è‡ªå·±appçš„buildTypeï¼Œè¿˜å¾—æ¯æ¬¡æ‰‹åŠ¨æ¥è®¾ç½®Logåº“moduleçš„ç¼–è¯‘typeï¼Œæä¸å¥½ä¸€ä¸å°å¿ƒä¸¤è€…è®¾çš„ä¸ç»Ÿä¸€å°±éº»çƒ¦äº†ã€‚</p>
<ul>
<li>å‘â‘¡ï¼š<br>å¦‚æœä»¥è¿™æ ·çš„æ–¹å¼æ¥é…ç½®Logåº“ï¼Œé‚£ä¹ˆç”¨æˆ·å°±åªèƒ½ä»¥moduleæºç çš„æ–¹å¼å°†Logåº“å¼•å…¥è‡ªå·±çš„å·¥ç¨‹ã€‚å¦‚æœè¦æŠŠLogåº“æ‰“æˆaaråŒ…æä¾›ç»™ç”¨æˆ·æ€ä¹ˆåŠï¼Ÿå‚æ•°å°±æ²¡æ³•è‡ªå®šä¹‰äº†å§ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œé†’æ‚Ÿåå°±æŠŠå¯¹Logåº“çš„è‡ªå®šä¹‰é…ç½®å‚æ•°ä»Logåº“çš„build.gradleç§»åŠ¨åˆ°äº†ç”¨æˆ·appçš„build.gradleä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨readme.mdæ–‡ä»¶ä¸­è¯´æ˜ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­ä¸€æ­¥å°±æ˜¯è¦ç”¨æˆ·ä¸æŠŠç¤ºä¾‹ä»£ç æ‹·è´åˆ°è‡ªå·±appçš„build.gradleä¸­ï¼Œåœ¨å¯¹Logè¿›è¡Œåˆå§‹åŒ–æ—¶è¿›è¡Œé…ç½®å‚æ•°çš„è°ƒç”¨ã€‚å½“ç„¶ï¼Œè¿™é‡ŒLogåˆå§‹åŒ–çš„ä»£ç ä¹Ÿæ˜¯åœ¨è¯´æ˜æ–‡ä»¶ä¸­å†™å¥½çš„ï¼Œç”¨æˆ·æ‹·è´å³å¯ã€‚</p>
<h1 id="æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶">æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶</h1><p>è¦å®ç°æŠŠæ—¥å¿—å†™å…¥åˆ°sdçš„æŒ‡å®šç›®å½•ä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶æŒ‰ç…§æ—¥æœŸè¿›è¡Œè‡ªåŠ¨å‘½åï¼Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶è¦é™åˆ¶å¤§å°ï¼Œè¾¾åˆ°æ–‡ä»¶å¤§å°ä¸Šé™åè‡ªåŠ¨åˆ›å»ºæ–°çš„æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚äºæ˜¯åˆgoogleäº†è‰¯ä¹…ï¼Œå‘ç°å¯ä»¥ç”¨java.util.logging.FileHandleré…åˆjava.util.logging.loggeræ¥å®ç°ã€‚<br>è¦ä½¿ç”¨FileHandlerï¼Œå…ˆè¦å®ç°ä¸€ä¸ªè‡ªå·±çš„Formatterç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFormatter</span> <span class="keyword">extends</span> <span class="title">Formatter</span> </span>&#123;</span><br><span class="line">        String appPackageName;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyFormatter</span><span class="params">(String appPackageName)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.appPackageName = appPackageName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">format</span><span class="params">(LogRecord rec)</span> </span>&#123;</span><br><span class="line">            StringBuffer buf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">            SimpleDateFormat timeFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">            buf.append(timeFormat.format(<span class="keyword">new</span> Date()));</span><br><span class="line">            buf.append(<span class="string">'/'</span>);</span><br><span class="line">            buf.append(appPackageName);</span><br><span class="line">            buf.append(<span class="string">' '</span>);</span><br><span class="line">            buf.append(MYLogLevel.getSimpleLevelStringByJavaLevel(rec.getLevel()));</span><br><span class="line">            buf.append(<span class="string">'/'</span>);</span><br><span class="line">            buf.append(rec.getParameters()[<span class="number">0</span>]);</span><br><span class="line">            buf.append(<span class="string">':'</span>);</span><br><span class="line">            buf.append(<span class="string">' '</span>);</span><br><span class="line">            buf.append(formatMessage(rec));</span><br><span class="line">            buf.append(<span class="string">'\n'</span>);</span><br><span class="line">            <span class="keyword">return</span> buf.toString();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>   
<p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªFileHandlerå®ä¾‹ï¼Œå¹¶æŠŠMyFormatterçš„ä¸€ä¸ªå®ä¾‹ä½œä¸ºå‚æ•°ä¼ ç»™æˆ‘ä»¬çš„FileHandlerå®ä¾‹ï¼Œå¹¶ç”¨FileHandleræ¥ä½œä¸ºæˆ‘ä»¬çš„Loggerçš„å¤„ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;                                                                                                                                        </span><br><span class="line">		Logger logger = Logger.getLogger(packageName);                                                                                       </span><br><span class="line">		logger.setUseParentHandlers(<span class="keyword">false</span>);                                                                                                  </span><br><span class="line">                                                                                                                                             </span><br><span class="line">		SimpleDateFormat dateformat1 = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);                                                                   </span><br><span class="line">		String datestring = dateformat1.format(<span class="keyword">new</span> Date());                                                                                  </span><br><span class="line">		fh = <span class="keyword">new</span> FileHandler(file.getAbsolutePath() + <span class="string">"_"</span> + datestring + <span class="string">"_%g"</span> + <span class="string">".log"</span>,                                                     </span><br><span class="line">				singleLogFileSizeLimit * <span class="number">1024</span> * <span class="number">1024</span>, <span class="number">9999</span>, <span class="keyword">true</span>);                                                                           </span><br><span class="line">		fh.setFormatter(<span class="keyword">new</span> MyFormatter(packageName));                                                                                       </span><br><span class="line">		logger.addHandler(fh);                                                                                                               </span><br><span class="line">                                                                                                                                             </span><br><span class="line">		<span class="keyword">return</span> logger;                                                                                                                       </span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;                                                                                                                </span><br><span class="line">		e.printStackTrace();                                                                                                                 </span><br><span class="line">		<span class="keyword">if</span> (fh != <span class="keyword">null</span>) &#123;                                                                                                                    </span><br><span class="line">			fh.close();                                                                                                                      </span><br><span class="line">		&#125;                                                                                                                                    </span><br><span class="line">                                                                                                                                             </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;                                                                                                                         </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºFileHandlerå®ä¾‹åŒ–çš„å‚æ•°ï¼Œå®˜ç½‘è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>public class FileHandler<br>extends StreamHandler<br>Simple file logging Handler.<br>The FileHandler can either write to a specified file, or it can write to a rotating set of files.<br>For a rotating set of files, as each file reaches a given size limit, it is closed, rotated out, and a new file opened. Successively older files are named by adding â€œ0â€, â€œ1â€, â€œ2â€, etc. into the base filename.<br>By default buffering is enabled in the IO libraries but each log record is flushed out when it is complete.<br>By default the XMLFormatter class is used for formatting.<br>Configuration: By default each FileHandler is initialized using the following LogManager configuration properties. If properties are not defined (or have invalid values) then the specified default values are used.<br>java.util.logging.FileHandler.level specifies the default level for the Handler (defaults to Level.ALL).<br>java.util.logging.FileHandler.filter specifies the name of a Filter class to use (defaults to no Filter).<br>java.util.logging.FileHandler.formatter specifies the name of a Formatter class to use (defaults to java.util.logging.XMLFormatter)<br>java.util.logging.FileHandler.encoding the name of the character set encoding to use (defaults to the default platform encoding).<br>java.util.logging.FileHandler.limit specifies an approximate maximum amount to write (in bytes) to any one file. If this is zero, then there is no limit. (Defaults to no limit).<br>java.util.logging.FileHandler.count specifies how many output files to cycle through (defaults to 1).<br>java.util.logging.FileHandler.pattern specifies a pattern for generating the output file name. See below for details. (Defaults to â€œ%h/java%u.logâ€).<br>java.util.logging.FileHandler.append specifies whether the FileHandler should append onto any existing files (defaults to false).<br>A pattern consists of a string that includes the following special components that will be replaced at runtime:<br>â€œ/â€œ the local pathname separator<br>â€œ%tâ€ the system temporary directory<br>â€œ%hâ€ the value of the â€œuser.homeâ€ system property<br>â€œ%gâ€ the generation number to distinguish rotated logs<br>â€œ%uâ€ a unique number to resolve conflicts<br>â€œ%%â€ translates to a single percent sign â€œ%â€<br>If no â€œ%gâ€ field has been specified and the file count is greater than one, then the generation number will be added to the end of the generated filename, after a dot.<br>Thus for example a pattern of â€œ%t/java%g.logâ€ with a count of 2 would typically cause log files to be written on Solaris to /var/tmp/java0.log and /var/tmp/java1.log whereas on Windows 95 they would be typically written to C:\TEMP\java0.log and C:\TEMP\java1.log<br>Generation numbers follow the sequence 0, 1, 2, etc.<br>Normally the â€œ%uâ€ unique field is set to 0. However, if the FileHandler tries to open the filename and finds the file is currently in use by another process it will increment the unique number field and try again. This will be repeated until FileHandler finds a file name that is not currently in use. If there is a conflict and no â€œ%uâ€ field has been specified, it will be added at the end of the filename after a dot. (This will be after any automatically added generation number.)<br>Thus if three processes were all trying to log to fred%u.%g.txt then they might end up using fred0.0.txt, fred1.0.txt, fred2.0.txt as the first file in their rotating sequences.<br>Note that the use of unique ids to avoid conflicts is only guaranteed to work reliably when using a local disk file system.</p>
</blockquote>
<h1 id="é…ç½®æ—¥å¿—åº“æœåŠ¡">é…ç½®æ—¥å¿—åº“æœåŠ¡</h1><p>æˆ‘ä»¬å¸Œæœ›æ—¥å¿—åº“èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼ŒæŠŠlogæ‰“å°åˆ°æ§åˆ¶å°ã€æˆ–è€…è¾“å‡ºåˆ°SDå¡çš„æ–‡ä»¶ï¼Œæˆ–è€…åœ¨æŸäº›æ¡ä»¶ä¸‹æŠŠSDçš„æ—¥å¿—æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä»¥serviceçš„å½¢å¼æ¥æä¾›æ—¥å¿—åº“çš„åŠŸèƒ½ã€‚</p>
<p>å¤§ä½“çš„æ¶æ„è®¾è®¡ï¼Œå°±æ˜¯æŠŠæ—¥å¿—åº“serviceè·‘åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œæä¾›ä¸€ä¸ªwrapperç±»ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œå¯¹äºæ—¥å¿—åº“servcieçš„ä»»ä½•è°ƒç”¨éƒ½å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·åªéœ€è¦åƒä½¿ç”¨androidè‡ªå¸¦çš„Logå·¥å…·é‚£æ ·ä½¿ç”¨.d()ã€.e()æ–¹æ³•å°±å¯ä»¥äº†ã€‚æ¯ä¸ªappåœ¨è‡ªå·±çš„Applicationç±»ä¸­è°ƒç”¨æ—¥å¿—åº“wrappeç±»çš„åˆå§‹åŒ–å‡½æ•°ï¼Œåœ¨è¿™ä¸€æ­¥ä¼ å…¥appè‡ªå·±çš„ç›¸å…³ä¿¡æ¯å¦‚åŒ…åç­‰ï¼Œæ—¥å¿—åº“ä¼šæ ¹æ®åŒ…åç”Ÿæˆå¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ã€‚serviceä¸­å¼€ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œé‡Œé¢æ˜¾ç¤ºåœ°å¯åŠ¨ä¸€ä¸ªlooperï¼Œå¤–ç•Œå‘æ¥çš„æ‰“å°logçš„è¯·æ±‚éƒ½è¢«ä»¥æ¶ˆæ¯çš„å½¢å¼ä¼ é€’ç»™è¿™ä¸ªæ–°çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç†ã€‚</p>
<p>Threadçš„runæ–¹æ³•å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                    <span class="keyword">case</span> Log.VERBOSE:</span><br><span class="line">                        printToFile(msg, <span class="string">"VERBOSE"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> Log.DEBUG:</span><br><span class="line">                        printToFile(msg, <span class="string">"DEBUG"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> Log.INFO:</span><br><span class="line">                        printToFile(msg, <span class="string">"INFO"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> Log.WARN:</span><br><span class="line">                        printToFile(msg, <span class="string">"WARN"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> Log.ERROR:</span><br><span class="line">                        printToFile(msg, <span class="string">"ERROR"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> Log.ASSERT:</span><br><span class="line">                        printToFile(msg, <span class="string">"ASSERT"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Looper.loop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€å¼€å§‹servcieçš„å·¥ä½œçº¿ç¨‹æ˜¯åœ¨orhanobut/loggerä¹‹ä¸Šåšæ‰©å±•ï¼Œå¯¹äºwrapperç±»çš„å®ç°æ˜¯ä½¿ç”¨AIDLï¼Œåœ¨appè°ƒç”¨wrapperçš„åˆå§‹åŒ–å‡½æ•°æ—¶ï¼Œwrapperè‡ªåŠ¨bindåˆ°æ—¥å¿—åº“serviceï¼Œç„¶åå†é€šè¿‡AIDLè°ƒç”¨serviceçš„åˆå§‹åŒ–ä»¥åŠæ‰“å°logçš„æ–¹æ³•ï¼ˆè¿™äº›å¯¹ç”¨æˆ·appéƒ½æ˜¯é€æ˜çš„ï¼‰ã€‚è¿™é‡Œå°±é‡åˆ°ä¸€ä¸ªå¤§å‘ï¼š</p>
<p>å¦‚æœä»¥æ˜¾ç¤ºIntentçš„æ–¹æ³•æ¥å¯åŠ¨servcieï¼Œå°±ä¼šå‘ç°æŠŠæ—¥å¿—åº“ä»¥moduleæºç çš„å½¢å¼æä¾›ç»™appä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæ‰“æˆaaråŒ…æä¾›ç»™appä½¿ç”¨ï¼Œå°±ä¼šå‡ºç°bindå¤±è´¥ï¼Œå¾ˆå¥‡æ€ªã€‚</p>
<p>å¦‚æœä»¥éšå¼Intentçš„æ–¹æ³•æ¥å¯åŠ¨serviceï¼Œæ‰“æˆaaråŒ…ä¹Ÿå¯ä»¥æ­£å¸¸å¯åŠ¨servieï¼Œä½†æ˜¯ç”±äºandroid 5.0ä»¥ä¸Šè¦æ±‚å¿…é¡»ä»¥æ˜¾ç¤ºIntentå¯åŠ¨serviceï¼Œæ•…è¿™ç§æ–¹æ³•çš„è¦†ç›–èŒƒå›´å¤ªå°ã€‚</p>
<p>åæ¥å¤§ç¥reviewäº†æˆ‘çš„ä»£ç ï¼Œè¯´æœ€å¥½ä¸è¦ç”¨AIDLï¼Œå› ä¸ºé‚£æ ·ä¼šä¸€ç›´åœ¨appå’Œservcieä¹‹é—´ä¿æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œæ²¡æœ‰å¿…è¦ã€‚å¯ä»¥ç›´æ¥ç”¨startæ–¹æ³•å¯åŠ¨servcieï¼Œç”¨intentæ¥ä¼ é€’è¯·æ±‚å‚æ•°ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å†åŠ ä¸Šæˆ‘å†™çš„ç¬¬ä¸€ç‰ˆæ˜¯ä»¥log4jçš„å½¢å¼ï¼Œè™½ç„¶æä¾›äº†gradleçš„å‚æ•°é…ç½®æ—¥å¿—åº“çš„å„é¡¹åŠŸèƒ½ï¼Œä½†æ˜¯åŠŸèƒ½æ˜¯å†™æ­»çš„ï¼Œæ— æ³•æ‰©å±•ï¼Œå¦‚æœç”¨æˆ·æœ‰ä¸€äº›ä¸ªæ€§åŒ–çš„æ—¥å¿—éœ€æ±‚å°±æ²¡æ³•ç”¨æˆ‘è¿™ä¸ªä¸œè¥¿ã€‚</p>
<p>æ‰€ä»¥åæ¥å°±å¯¹ä»£ç è¿›è¡Œäº†é‡æ„ï¼Œæ”¹ä¸ºåœ¨JakeWharton/timberä¹‹ä¸Šæ‰©å±•ï¼Œæˆ‘æä¾›ä¸€ä¸ªæ—¥å¿—æ¡†æ¶ï¼Œä»¥åŠä¸¤ä¸ªæ—¥å¿—å·¥å…·ï¼ˆæ‰“å°åˆ°æ§åˆ¶å°ã€æ‰“å°åˆ°æ–‡ä»¶ï¼‰ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ç»§æ‰¿æˆ‘çš„æ—¥å¿—å·¥å…·åŸºç±»å®ç°è‡ªå·±çš„æ—¥å¿—å·¥å…·ã€‚ç”¨æˆ·åœ¨è‡ªå·±çš„appä¸­ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œåœ¨åˆå§‹åŒ–æ—¶é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ—¥å¿—å·¥å…·å®‰è£…åˆ°æ¡†æ¶ï¼Œå…·ä½“çš„æ‰“å°è¯·æ±‚ä¹Ÿæ˜¯åŒandroidé»˜è®¤æ—¥å¿—å·¥å…·ä¸€æ ·ç›´æ¥.d()ã€.e()è¿™æ ·è°ƒç”¨ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p>
<p>è¿™é‡Œè®°ä¸€ä¸‹è¸©åˆ°çš„å¦å¤–å‡ ä¸ªå‘ï¼Œæœ‰äº›æ¯”è¾ƒä½çº§ğŸ˜“ï¼š<br>1ã€ä¸€å¼€å§‹ä¹‹æ‰€ä»¥é€‰æ‹©åœ¨orhanobut/loggerä¸Šæ‰©å±•ï¼Œæ˜¯å› ä¸ºå®ƒé»˜è®¤æä¾›äº†éå¸¸ç¾è§‚çš„æ‰“å°æ ¼å¼ï¼Œä»¥åŠçº¿ç¨‹ä¿¡æ¯ã€æ—¥å¿—è°ƒç”¨æ ˆä¿¡æ¯ã€‚åæ¥çªç„¶ååº”è¿‡æ¥ï¼Œæˆ‘æä¾›çš„åº“è™½ç„¶ä¼šä¸ç”¨æˆ·appæ‰“è¿›åŒä¸€ä¸ªapkï¼Œwrapperä¹Ÿæ˜¯ä¸ç”¨æˆ·appè·‘åœ¨åŒä¸€çº¿ç¨‹ï¼Œä½†æ˜¯çœŸæ­£çš„æ—¥å¿—æ‰“å°å·¥ä½œæ˜¯åœ¨serviceçš„å•ç‹¬è¿›ç¨‹ä¸­å®Œæˆçš„ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤æä¾›çš„è°ƒç”¨æ ˆä¿¡æ¯å°±æ— æ„ä¹‰äº†ã€‚  </p>
<p>2ã€ADILæ˜¯åŒæ­¥è°ƒç”¨ï¼Œè€Œserviceçš„æ‰€æœ‰å…¶å®ƒæ¥å£ï¼ˆbind, unbind, startService, stopServiceï¼‰éƒ½æ˜¯å¼‚æ­¥æ¥å£ï¼Œç«‹å³è¿”å›ã€‚å‚è€ƒï¼š<a href="http://blog.csdn.net/edisonlg/article/details/7164761ï¼‰ã€‚" target="_blank" rel="external">http://blog.csdn.net/edisonlg/article/details/7164761ï¼‰ã€‚</a>  </p>
<p>3ã€åœ¨è°ƒè¯•æ—¶å‘ç°åˆå§‹åŒ–è²Œä¼¼å¾ˆè€—æ—¶ï¼Œè·Ÿè¸ªäº†ä¸€ä¸‹ï¼Œå‘ç°new FileHandler()è¿™ä¸€æ“ä½œå±…ç„¶è¦è€—æ—¶30~40ms!!!</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="è°ƒç ”">è°ƒç ”</h1><p>åœ¨androidå¼€å‘ä¸­ï¼Œå¦‚æœéœ€è¦æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œå¾€å¾€ä¼šä½¿ç”¨Log.d()ã€Log.e()ä¹‹ç±»çš„ç”±android.util.Logæä¾›çš„æ–¹æ³•ã€‚å®ƒçš„å¥½å¤„æ˜¯ç®€å•ã€æ–¹ä¾¿ï¼Œä¸è¶³ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯å®šåˆ¶æ€§å·®ï¼Œä¸èƒ½æ‰“å°åˆ°æ–‡ä»¶ã€‚å¦‚æœæƒ³åœ¨å‘è¡Œç‰ˆappä¸­çš„æŸäº›å…³é”®è¯­å¥æ‰“å°logåˆ°æ–‡ä»¶ï¼Œæˆ–è€…åœ¨appå´©æºƒæ—¶æŠŠå´©æºƒä¿¡æ¯æ‰“å°åˆ°æ–‡ä»¶ä¾›ä¸Šä¼ åˆ†æï¼Œé‚£ä¹ˆandroid.util.Logå°±æ— èƒ½ä¸ºåŠ›äº†ã€‚<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://www.carrotsight.com/tags/Android/"/>
    
      <category term="åº“é¡¹ç›®" scheme="http://www.carrotsight.com/tags/%E5%BA%93%E9%A1%B9%E7%9B%AE/"/>
    
      <category term="æ—¥å¿—" scheme="http://www.carrotsight.com/tags/%E6%97%A5%E5%BF%97/"/>
    
      <category term="Android" scheme="http://www.carrotsight.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[FlatBufferså­¦ä¹ æ€»ç»“]]></title>
    <link href="http://www.carrotsight.com/2015/10/10/FlatBuffers%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93.html"/>
    <id>http://www.carrotsight.com/2015/10/10/FlatBufferså­¦ä¹ æ€»ç»“.html</id>
    <published>2015-10-10T13:37:08.000Z</published>
    <updated>2015-12-03T08:41:07.000Z</updated>
    <content type="html"><![CDATA[<p>æ®è¯´facebookä½¿ç”¨googleçš„é»‘ç§‘æŠ€flatbuffersï¼Œç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„jsonè¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå¤§å¤§æé«˜äº†facebook androidå®¢æˆ·ç«¯çš„æ•ˆç‡ã€‚äºæ˜¯æˆ‘åœ¨ç½‘ä¸ŠæŸ¥æ‰¾å„ç§èµ„æ–™å­¦ä¹ äº†ä¸€ä¸‹flatbuffersï¼Œå‚çœ‹èµ„æ–™åŒ…æ‹¬GOOGLEå®˜æ–¹æ–‡æ¡£ã€facebookæŠ€æœ¯åšå®¢ã€ä»¥åŠå…¶ä»–å›½å†…çš„ä¸ªäººåšå®¢ï¼Œä¹Ÿå†™äº†äº›ä»£ç åšå®éªŒï¼Œä»¥æ­¤æ–‡ä½œä¸ºå­¦ä¹ æ€»ç»“ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯Google_FlatBuffers">ä»€ä¹ˆæ˜¯Google FlatBuffers</h2><p>FlatBuffersæ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ã€é«˜æ•ˆçš„ã€æä¾›äº†C++/Javaæ¥å£çš„åºåˆ—åŒ–å·¥å…·åº“ã€‚å®ƒæ˜¯Googleä¸“é—¨ä¸ºæ¸¸æˆå¼€å‘æˆ–å…¶ä»–æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ç¨‹åºéœ€æ±‚è€Œåˆ›å»ºã€‚å°¤å…¶æ›´é€‚ç”¨äºç§»åŠ¨å¹³å°ï¼Œè¿™äº›å¹³å°ä¸Šå†…å­˜å¤§å°åŠå¸¦å®½ç›¸æ¯”æ¡Œé¢ç³»ç»Ÿéƒ½æ˜¯å—é™çš„ï¼Œè€Œåº”ç”¨ç¨‹åºæ¯”å¦‚æ¸¸æˆåˆæœ‰æ›´é«˜çš„æ€§èƒ½è¦æ±‚ã€‚å®ƒå°†åºåˆ—åŒ–æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œè¿™äº›æ•°æ®æ—¢å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œåˆå¯ä»¥é€šè¿‡ç½‘ç»œåŸæ ·ä¼ è¾“ï¼Œè€Œä¸éœ€è¦ä»»ä½•è§£æå¼€é”€ã€‚<br><a id="more"></a></p>
<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Google_FlatBuffers">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Google FlatBuffers</h2><ol>
<li>å¯¹åºåˆ—åŒ–æ•°æ®çš„è®¿é—®ä¸éœ€è¦æ‰“åŒ…å’Œæ‹†åŒ…â€”â€”å®ƒå°†åºåˆ—åŒ–æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œè¿™äº›æ•°æ®æ—¢å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œåˆå¯ä»¥é€šè¿‡ç½‘ç»œåŸæ ·ä¼ è¾“ï¼Œè€Œæ²¡æœ‰ä»»ä½•è§£æå¼€é”€ï¼›  </li>
<li>å†…å­˜æ•ˆç‡å’Œé€Ÿåº¦â€”â€”è®¿é—®æ•°æ®æ—¶çš„å”¯ä¸€å†…å­˜éœ€æ±‚å°±æ˜¯ç¼“å†²åŒºï¼Œä¸éœ€è¦é¢å¤–çš„å†…å­˜åˆ†é…ï¼›   </li>
<li>æ‰©å±•æ€§ã€çµæ´»æ€§â€”â€”å®ƒæ”¯æŒçš„å¯é€‰å­—æ®µæ„å‘³ç€ä¸ä»…èƒ½è·å¾—å¾ˆå¥½çš„å‰å‘/åå‘å…¼å®¹æ€§ï¼ˆå¯¹äºé•¿ç”Ÿå‘½å‘¨æœŸçš„æ¸¸æˆæ¥è¯´å°¤å…¶é‡è¦ï¼Œå› ä¸ºä¸éœ€è¦æ¯ä¸ªæ–°ç‰ˆæœ¬éƒ½æ›´æ–°æ‰€æœ‰æ•°æ®ï¼‰ï¼›  </li>
<li>æœ€å°ä»£ç ä¾èµ–â€”â€”ä»…ä»…éœ€è¦è‡ªåŠ¨ç”Ÿæˆçš„å°‘é‡ä»£ç å’Œä¸€ä¸ªå•ä¸€çš„å¤´æ–‡ä»¶ä¾èµ–ï¼Œå¾ˆå®¹æ˜“é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­ã€‚  </li>
<li>å¼ºç±»å‹è®¾è®¡â€”â€”å°½å¯èƒ½ä½¿é”™è¯¯å‡ºç°åœ¨ç¼–è¯‘æœŸï¼Œè€Œä¸æ˜¯ç­‰åˆ°è¿è¡ŒæœŸæ‰æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®æ­£ï¼›</li>
<li>ä½¿ç”¨ç®€å•â€”â€”ç”Ÿæˆçš„C++ä»£ç æä¾›äº†ç®€å•çš„è®¿é—®å’Œæ„é€ æ¥å£ï¼›è€Œä¸”å¦‚æœéœ€è¦ï¼Œé€šè¿‡ä¸€ä¸ªå¯é€‰åŠŸèƒ½å¯ä»¥ç”¨æ¥åœ¨è¿è¡Œæ—¶é«˜æ•ˆè§£æSchemaå’Œç±»JSONæ ¼å¼çš„æ–‡æœ¬ï¼›</li>
<li>è·¨å¹³å°â€”â€”æ”¯æŒC++11ã€Javaï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¾èµ–åº“ï¼›åœ¨æœ€æ–°çš„gccã€clangã€vs2010ç­‰ç¼–è¯‘å™¨ä¸Šå·¥ä½œè‰¯å¥½ã€‚  </li>
</ol>
<p>å®˜ç½‘çš„åŸºå‡†æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/å±å¹•å¿«ç…§%202015-09-30%20ä¸‹åˆ3.08.24.png" alt=""></p>
<h2 id="ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Protocol_Buffersæˆ–è€…JSON">ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Protocol Buffersæˆ–è€…JSON</h2><h3 id="Protocol_Buffers_vs_FlatBuffers">Protocol Buffers vs FlatBuffers</h3><p>Protocol Buffersçš„ç¡®å’ŒFlatBuffersæ¯”è¾ƒç±»ä¼¼ï¼Œä½†å…¶ä¸»è¦åŒºåˆ«åœ¨äºFlatBuffersåœ¨è®¿é—®æ•°æ®å‰ä¸éœ€è¦è§£æ/æ‹†åŒ…è¿™ä¸€æ­¥ï¼Œè€Œä¸”Protocol Buffersæ²¡æœ‰å¯é€‰çš„æ–‡æœ¬å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½ï¼ˆFlatBufferså¯ä»¥ç›´æ¥æ ¹æ®Schemaå’Œjsonæ–‡æœ¬ç”Ÿæˆå¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶ï¼‰ã€‚<br>Protocol Buffersä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œä»è€Œåœ¨è§£ææ•°æ®æ—¶éœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨varintsæ¥å­˜å‚¨æ•´å‹æ•°ï¼Œvarintsæ˜¯ä¸€ç§ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚æ¥åºåˆ—åŒ–æ•´å‹æ•°çš„æ–¹æ³•ï¼Œè¶Šå°çš„æ•°å ç”¨çš„å­—èŠ‚æ•°å°±è¶Šå°‘ã€‚åŒæ—¶ï¼Œä»£è¡¨ä¸€ä¸ªæ•°å­—çš„å¤šä¸ªå­—èŠ‚é‡‡ç”¨little endiançš„æ–¹å¼æ¥å­˜å‚¨ã€‚è¿™å°±å¯¼è‡´åœ¨è§£ææ•°æ®æ—¶ï¼Œéœ€è¦åˆ¤æ–­å“ªå‡ ä¸ªå­—èŠ‚æ˜¯è¡¨ç¤ºè¿™ä¸ªå­—æ®µçš„ï¼Œå¹¶è¿›è¡Œå…¶ä»–çš„æ•°å­¦å˜æ¢æ¥è¿˜åŸå‡ºåŸå§‹æ•°æ®ã€‚<br>å…³äºprotocal bufferså…·ä½“çš„æ•°æ®ç¼–ç æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒ<a href="https://developers.google.com/protocol-buffers/docs/encoding" target="_blank" rel="external">googleå¼€å‘è€…ç½‘ç«™</a>ä»¥åŠ<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/" target="_blank" rel="external">IBMæŠ€æœ¯åšå®¢</a>ã€‚  </p>
<p>ä¸ä¹‹ç›¸å¯¹ï¼ŒFlatBufferså¯ä»¥ç›´æ¥æ ¹æ®èµ·å§‹ä½ç½®+åç§»é‡ç›´æ¥è·å–åˆ°æ•°æ®ï¼Œæ— è§£æè¿‡ç¨‹ï¼Œæ•ˆç‡æ›´é«˜ï¼Œè€Œä¼´éšçš„å‰¯ä½œç”¨æ˜¯FlatBufferséœ€è¦å ç”¨ç›¸å¯¹æ›´å¤šçš„ç©ºé—´ï¼Œå› ä¸ºProtocol Buffersçš„ç¼–ç åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‹ç¼©äº†æ•°æ®ã€‚</p>
<p>ç½‘ä¸Šæœ‰äººè¿›è¡Œäº†æ€§èƒ½å¯¹æ¯”è¯•éªŒï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-10-10/60479922.jpg" alt=""></p>
<h3 id="JSON_vs_FlatBuffers">JSON vs FlatBuffers</h3><p>JSONæ˜¯éå¸¸å¯è¯»çš„ï¼Œè€Œä¸”å½“å’ŒåŠ¨æ€ç±»å‹è¯­è¨€ï¼ˆå¦‚JavaScriptï¼‰ä¸€èµ·ä½¿ç”¨æ—¶éå¸¸æ–¹ä¾¿ã€‚ç„¶è€Œåœ¨é™æ€ç±»å‹è¯­è¨€ä¸­åºåˆ—åŒ–æ•°æ®æ—¶ï¼ŒJSONä¸ä½†å…·æœ‰è¿è¡Œæ•ˆç‡ä½çš„æ˜æ˜¾ç¼ºç‚¹ï¼Œè€Œä¸”ä¼šè®©ä½ å†™æ›´å¤šçš„ä»£ç æ¥è®¿é—®æ•°æ®ï¼ˆè¿™ä¸ªä¸ç›´è§‰ç›¸åï¼‰ã€‚</p>
<h2 id="å“ªäº›é¡¹ç›®ä½¿ç”¨äº†FlatBuffers">å“ªäº›é¡¹ç›®ä½¿ç”¨äº†FlatBuffers</h2><ul>
<li><strong>Cocos2d-x</strong>, the #1 open source mobile game engine, uses it to serialize all their game data.</li>
<li><strong>Facebook</strong> uses it for client-server communication in their Android app. They have a nice article explaining how it speeds up loading their posts.</li>
<li><strong>Fun Propulsion Labs</strong> at Google uses it extensively in all their libraries and games.</li>
</ul>
<h2 id="FlatBuffersåŸç†">FlatBuffersåŸç†</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªpersonç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> friendshipStatus;</span><br><span class="line">    Person spouse;</span><br><span class="line">    List&lt;Person&gt;friends;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„spouseå’Œfriendså­—æ®µé¡µåŒ…å«äº†personå¯¹è±¡ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªæ ‘ç»“æ„ã€‚ä¸‹é¢å°±æ˜¯å…³äºæ­¤å¯¹è±¡åœ¨FlatBufferä¸­å­˜å‚¨çš„ç®€åŒ–å›¾ç¤ºï¼š<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-10-8/13378046.jpg" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>æ¯ä¸ªå¯¹è±¡éƒ½è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼šä¸­å¿ƒç‚¹å·¦è¾¹çš„å…ƒæ•°æ®éƒ¨åˆ†ï¼ˆæˆ–è€…å«vtableï¼‰ï¼Œå’Œä¸­å¿ƒç‚¹å³è¾¹çš„çœŸå®æ•°æ®éƒ¨åˆ†ã€‚</li>
<li>æ¯ä¸ªå­—æ®µéƒ½å¯¹åº”vtableä¸­çš„ä¸€ä¸ªæ§½ï¼ˆslotï¼‰ï¼Œå®ƒå­˜å‚¨äº†é‚£ä¸ªå­—æ®µçš„çœŸå®æ•°æ®çš„åç§»é‡ã€‚ä¾‹å¦‚ï¼ŒJohnçš„vtableçš„ç¬¬ä¸€ä¸ªæ§½çš„å€¼æ˜¯1ï¼Œè¡¨æ˜Johnçš„åå­—è¢«å­˜å‚¨åœ¨Johnçš„ä¸­å¿ƒç‚¹å³è¾¹çš„ä¸€ä¸ªå­—èŠ‚çš„ä½ç½®ä¸Šã€‚</li>
<li>å¦‚æœä¸€ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒåœ¨vtableä¸­çš„åç§»é‡ä¼šæŒ‡å‘å­å¯¹è±¡çš„ä¸­å¿ƒç‚¹ï¼ˆpivot pointï¼‰ã€‚æ¯”å¦‚ï¼ŒJohnçš„vtableä¸­ç¬¬ä¸‰ä¸ªæ§½æŒ‡å‘Maryçš„ä¸­å¿ƒç‚¹ã€‚</li>
<li>è¦è¡¨æ˜æŸä¸ªå­—æ®µç°åœ¨æ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥åœ¨vtableå¯¹åº”çš„æ§½ä¸­ä½¿ç”¨åç§»é‡0æ¥æ ‡æ³¨ã€‚</li>
</ul>
<p>è¦äº†è§£æ›´å¤æ‚çš„å…³äºFlatBufferså­—æ®µä¿®æ”¹çš„å®ç°åŸç†ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://code.facebook.com/posts/872547912839369/improving-facebook-s-performance-on-android-with-flatbuffers/" target="_blank" rel="external">facebookçš„æ–‡æ¡£</a>ä¸­çš„â€œMutation on FlatBuffersâ€éƒ¨åˆ†ã€‚</p>
<h2 id="ç®€æ˜ä½¿ç”¨æ­¥éª¤">ç®€æ˜ä½¿ç”¨æ­¥éª¤</h2><ol>
<li>ç¼–å†™ä¸€ä¸ªç”¨æ¥å®šä¹‰ä½ æƒ³åºåˆ—åŒ–çš„æ•°æ®çš„schemaæ–‡ä»¶ï¼ˆåˆç§°IDLï¼‰ï¼Œæ•°æ®ç±»å‹å¯ä»¥æ˜¯å„ç§å¤§å°çš„intã€floatï¼Œæˆ–è€…æ˜¯stringã€arrayï¼Œæˆ–è€…å¦ä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œç”šè‡³æ˜¯å¯¹è±¡é›†åˆã€‚å„ä¸ªæ•°æ®å±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼Œä¸”å¯ä»¥è®¾ç½®é»˜è®¤å€¼,æ‰€ä»¥ä¸å¿…è¦ä¸ºæ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½å»å‘ˆç°è¿™äº›å­—æ®µã€‚  </li>
<li>ä½¿ç”¨FlatBufferç¼–è¯‘å™¨flatcç”ŸæˆC++å¤´æ–‡ä»¶æˆ–è€…Javaç±»ï¼Œç”Ÿæˆçš„ä»£ç é‡Œé¢å¤–æä¾›äº†è®¿é—®ã€æ„é€ åºåˆ—åŒ–æ•°æ®çš„è¾…åŠ©ç±»ã€‚ç”Ÿæˆçš„ä»£ç ä»…ä»…ä¾èµ–flatbuffers.hï¼›  </li>
<li>ä½¿ç”¨FlatBufferBuilderç±»æ„é€ ä¸€ä¸ªäºŒè¿›åˆ¶bufferã€‚ä½ å¯ä»¥å‘è¿™ä¸ªbufferé‡Œå¾ªç¯æ·»åŠ å„ç§å¯¹è±¡ï¼Œè€Œä¸”å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªå•ä¸€å‡½æ•°è°ƒç”¨ï¼›</li>
<li>ä¿å­˜æˆ–è€…å‘é€è¯¥bufferï¼›</li>
<li>å½“å†æ¬¡è¯»å–è¯¥bufferæ—¶ï¼Œä½ å¯ä»¥å¾—åˆ°è¿™ä¸ªbufferæ ¹å¯¹è±¡çš„æŒ‡é’ˆï¼Œç„¶åå°±å¯ä»¥ç®€å•çš„å°±åœ°è¯»å–æ•°æ®å†…å®¹ã€‚</li>
</ol>
<h2 id="FlatBuffersä½¿ç”¨å®æˆ˜">FlatBuffersä½¿ç”¨å®æˆ˜</h2><h3 id="æ„å»ºflatc(FlatBuffersç¼–è¯‘å™¨)">æ„å»ºflatc(FlatBuffersç¼–è¯‘å™¨)</h3><p>ä»<a href="https://github.com/google/flatbuffers" target="_blank" rel="external">Googleçš„flatbuffersä»“åº“</a>ä¸‹è½½æˆ–å…‹éš†æºä»£ç ,å¯ä»¥åœ¨<a href="https://google.github.io/flatbuffers/md__building.html" target="_blank" rel="external">Googleçš„FlatBuffersæ„å»ºæ–‡æ¡£ä¸­</a>æŸ¥çœ‹æ„å»ºè¿‡ç¨‹ã€‚å¦‚æœä½ æ˜¯Macç”¨æˆ·çš„è¯å°±å¯ä»¥ç›´æ¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥æ“ä½œï¼š  </p>
<ol>
<li>æ‰“å¼€ä¸‹è½½çš„æºä»£ç ï¼Œç›®å½•æ˜¯<code>\{extract directory}\build\Xcode\FlatBuffers.xcodeproj</code> ï¼Œç”¨Xcodeæ‰“å¼€æ­¤æ–‡ä»¶ã€‚   </li>
<li>ç‚¹å‡»<code>Play</code>æŒ‰é’®æˆ–è€…<code>âŒ˜ + R</code>è¿è¡Œã€‚  </li>
<li>flatcå¯æ‰§è¡Œæ–‡ä»¶ä¼šå‡ºç°åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ã€‚<br>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨flatcæ¥ä»ç»™å®šçš„schemaç”Ÿæˆæ¨¡å‹ç±»ï¼Œæˆ–è€…æŠŠJSONè½¬æ¢æˆFlatBuffersäºŒè¿›åˆ¶æ–‡ä»¶äº†ã€‚</li>
</ol>
<h3 id="ç¼–å†™ä¸€ä¸ªSchema">ç¼–å†™ä¸€ä¸ªSchema</h3><p>Schemaè¯­è¨€ï¼ˆå³IDLï¼‰çš„è¯­æ³•ä¸Cè¯­è¨€å®¶æ—å¾ˆç±»ä¼¼ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example IDL file</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> MyGame;</span><br><span class="line"></span><br><span class="line">attribute <span class="string">"priority"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Color : byte &#123; Red = <span class="number">1</span>, Green, Blue &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> Any &#123; Monster, Weapon, Pickup &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Vec3 &#123;</span><br><span class="line">  x:<span class="keyword">float</span>;</span><br><span class="line">  y:<span class="keyword">float</span>;</span><br><span class="line">  z:<span class="keyword">float</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table Monster &#123;</span><br><span class="line">  pos:Vec3;</span><br><span class="line">  mana:<span class="keyword">short</span> = <span class="number">150</span>;</span><br><span class="line">  hp:<span class="keyword">short</span> = <span class="number">100</span>;</span><br><span class="line">  name:<span class="built_in">string</span>;</span><br><span class="line">  friendly:<span class="keyword">bool</span> = <span class="literal">false</span> (deprecated, priority: <span class="number">1</span>);</span><br><span class="line">  inventory:[ubyte];</span><br><span class="line">  color:Color = Blue;</span><br><span class="line">  test:Any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root_type Monster;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆWeapon å’Œ Pickupæ²¡æœ‰åœ¨è¿™ä¸ªä¾‹å­ä¸­åˆ—å‡ºã€‚ï¼‰</p>
<h4 id="Tables">Tables</h4><p>Tablesæ˜¯åœ¨FlatBuffersä¸­å®šä¹‰å¯¹è±¡çš„ä¸»è¦æ–¹å¼ï¼Œç”±åå­—ï¼ˆè¿™é‡Œçš„Monsterï¼‰å’Œå­—æ®µåˆ—è¡¨ç»„æˆã€‚æ¯ä¸€ä¸ªå­—æ®µéƒ½æœ‰åå­—ã€ç±»å‹ã€å’Œä¸€ä¸ªå¯é€‰çš„é»˜è®¤å€¼ï¼ˆå¦‚æœå¿½ç•¥çš„è¯ï¼Œé»˜è®¤æ˜¯0/NULLï¼‰ã€‚<br><strong>æ¯ä¸€ä¸ªå­—æ®µéƒ½æ˜¯å¯é€‰çš„</strong>ï¼šå¯¹æ¯ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ä¸ªä½“ï¼Œä½ éƒ½å¯ä»¥é€‰æ‹©å¿½ç•¥ä¸€äº›å­—æ®µã€‚ä¹Ÿå°±ä½¿ä½ å¯ä»¥çµæ´»çš„å¢åŠ å­—æ®µï¼Œè€Œä¸å¿…æ‹…å¿ƒæ•°æ®è†¨èƒ€ã€‚è¿™ä¸ªè®¾è®¡ä¹Ÿæ˜¯FlatBufferså‘å‰å’Œå‘åå…¼å®¹çš„æœºåˆ¶ã€‚<br><strong>æ³¨æ„ï¼š</strong>  </p>
<ul>
<li>å¦‚æœè¦åœ¨schemaä¸­æ·»åŠ æ–°å­—æ®µï¼Œåªèƒ½åœ¨tableçš„æœ«å°¾è¿›è¡Œæ·»åŠ ã€‚</li>
<li>å¦‚æœä½ ä¸å†ä½¿ç”¨æŸäº›å­—æ®µäº†ï¼Œä½ ä¸èƒ½ä»schemaä¸­åˆ é™¤å®ƒä»¬ã€‚ä½ å¯ä»¥ä¸å†æŠŠå®ƒä»¬å†™å…¥åˆ°ä½ çš„æ•°æ®ä¸­ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚  </li>
</ul>
<h4 id="Structs">Structs</h4><p>Structsä¸Tableç±»ä¼¼ï¼Œåªä¸è¿‡æ²¡æœ‰å­—æ®µæ˜¯å¯é€‰çš„äº†(æ‰€ä»¥æ²¡æœ‰é»˜è®¤å€¼äº†)ï¼Œå¹¶ä¸”å­—æ®µä¸èƒ½å¢åŠ æˆ–è¢«åºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚Structåªèƒ½åŒ…å«æ ‡é‡æˆ–è€…å…¶ä»–structã€‚å¦‚æœä½ <strong>éå¸¸ç¡®å®š</strong>ä»»ä½•å˜åŒ–éƒ½ä¸ä¼šå‘ç”Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨structã€‚Structä½¿ç”¨çš„å†…å­˜æ¯”tableå°‘ï¼Œå¹¶ä¸”è¯»å–æ—¶æ¯”tableæ›´å¿«ï¼ˆå®ƒä»¬é€šå¸¸è¢«ä»¥in-lineçš„æ–¹å¼å­˜å‚¨åœ¨å®ƒä»¬çš„çˆ¶å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”ä¸é€‚ç”¨virtual tableï¼‰ã€‚</p>
<h4 id="ç±»å‹">ç±»å‹</h4><p>å†…å»ºçš„æ ‡é‡ç±»å‹ï¼š  </p>
<blockquote>
<ul>
<li>8 bit: byte ubyte bool</li>
<li>16 bit: short ushort</li>
<li>32 bit: int uint float</li>
<li>64 bit: long ulong double</li>
</ul>
</blockquote>
<p>å†…å»ºçš„éæ ‡é‡ç±»å‹ï¼š  </p>
<blockquote>
<ul>
<li>å…³äºä»»ä½•å…¶ä»–ç±»å‹çš„Vector</li>
<li>stringï¼Œåªèƒ½å­˜å‚¨UTF-8æˆ–è€…7-bit ASCIIã€‚å¦‚æœéœ€è¦å­˜å‚¨å…¶ä»–ç¼–ç çš„æ–‡æœ¬ï¼Œæˆ–è€…é€šç”¨äºŒè¿›åˆ¶æ•°æ®ï¼Œè¯·ä½¿ç”¨vectorï¼ˆ[byte]æˆ–è€…[ubyte]ï¼‰ã€‚</li>
<li>å¯¹å…¶ä»–tableã€structã€enumæˆ–è€…unionçš„å¼•ç”¨ã€‚</li>
</ul>
</blockquote>
<p>å…³äºç¼–å†™Schemaçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ<a href="https://google.github.io/flatbuffers/md__schemas.html" target="_blank" rel="external">Googleæ–‡æ¡£ï¼šWriting a aschema</a>ã€‚</p>
<p>åœ¨å®éªŒä¸­ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ç½‘ä¸Šçš„ç¤ºä¾‹æ–‡ä»¶ã€‚<br>è¦å¤„ç†çš„æ•°æ®å¯¹åº”çš„JSONæ–‡ä»¶çš„ä¸‹è½½åœ°å€ä¸ºï¼š<a href="https://github.com/frogermcs/FlatBuffs/blob/master/flatbuffers/repos_json.json" target="_blank" rel="external">https://github.com/frogermcs/FlatBuffs/blob/master/flatbuffers/repos_json.json</a>    </p>
<p>è¿™ä¸ªJSONçš„ç»“æ„å¦‚ä¸‹é¢çš„ç‰‡æ®µæ‰€ç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "repos": [</span><br><span class="line">    &#123;</span><br><span class="line">      "id": 27149168,</span><br><span class="line">      "name": "acai",</span><br><span class="line">      "full_name": "google/acai",</span><br><span class="line">      "owner": &#123;</span><br><span class="line">        "login": "google",</span><br><span class="line">        "id": 1342004,</span><br><span class="line">        ...</span><br><span class="line">        "type": "Organization",</span><br><span class="line">        "site_admin": false</span><br><span class="line">      &#125;,</span><br><span class="line">      "private": false,</span><br><span class="line">      "html_url": "https://github.com/google/acai",</span><br><span class="line">      "description": "Testing library for JUnit4 and Guice.",</span><br><span class="line">      ...</span><br><span class="line">      "watchers": 21,</span><br><span class="line">      "default_branch": "master"</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä½¿ç”¨FlatBufferså¤„ç†è¿™ä¸ªJSONæ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™å¯¹åº”çš„Schemaï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­éœ€è¦åˆ›å»º3ä¸ªTableï¼š<code>ReposList</code>, <code>Repo</code> å’Œ <code>User</code>ï¼Œè¿˜è¦å®šä¹‰<code>root_type</code>ã€‚  </p>
<p>å¯ä»¥ç›´æ¥ä»githubä¸‹è½½å·²ç»ç¼–å†™å¥½çš„Schemaï¼Œåœ°å€ä¸º<a href="https://github.com/frogermcs/FlatBuffs/blob/master/flatbuffers/repos_schema.fbs" target="_blank" rel="external">https://github.com/frogermcs/FlatBuffs/blob/master/flatbuffers/repos_schema.fbs</a>ã€‚<br>è¿™ä¸ªSchemaçš„éƒ¨åˆ†ç‰‡æ®µå¦‚ä¸‹ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">table ReposList &#123;</span><br><span class="line">    repos : [Repo];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table Repo &#123;</span><br><span class="line">    id : <span class="keyword">long</span>;</span><br><span class="line">    name : <span class="built_in">string</span>;</span><br><span class="line">    full_name : <span class="built_in">string</span>;</span><br><span class="line">    owner : User;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    labels_url : <span class="built_in">string</span> (deprecated);</span><br><span class="line">    releases_url : <span class="built_in">string</span> (deprecated);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table User &#123;</span><br><span class="line">    login : <span class="built_in">string</span>;</span><br><span class="line">    id : <span class="keyword">long</span>;</span><br><span class="line">    avatar_url : <span class="built_in">string</span>;</span><br><span class="line">    gravatar_id : <span class="built_in">string</span>;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    site_admin : <span class="keyword">bool</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root_type ReposList;</span><br></pre></td></tr></table></figure>
<h3 id="FlatBuffersæ•°æ®æ–‡ä»¶">FlatBuffersæ•°æ®æ–‡ä»¶</h3><p>ç°åœ¨æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠJSONæ–‡ä»¶è½¬æ¢æˆFlatBuffersäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”ç”Ÿæˆèƒ½å¤Ÿä»¥JAVAå‹å¥½æ–¹å¼è¡¨è¾¾æˆ‘ä»¬çš„æ•°æ®çš„JAVAæ¨¡å‹ã€‚æ–¹æ³•æ˜¯åœ¨ä¸­æ–­ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><code>$ ./flatc -j -b repos_schema.fbs repos_json.json</code></p>
<p>å¦‚æœä¸€åˆ‡è¿è¡Œæ­£å¸¸ï¼Œä¼šçœ‹åˆ°ä¸€ç³»åˆ—æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>repos_json.bin (æˆ‘ä»¬æŠŠå®ƒé‡å‘½åä¸ºrepos_flat.bin)</li>
<li>Repos/Repo.java</li>
<li>Repos/ReposList.java</li>
<li>Repos/User.java</li>
</ul>
<p>Schemaç¼–è¯‘å™¨(å³flatc)çš„å®Œæ•´ä½¿ç”¨æ–¹æ³•ä¸ºï¼š  </p>
<blockquote>
<p>flatc [ -c ] [ -j ] [ -b ] [ -t ] [ -o PATH ] [ -I PATH ] [ -S ] FILESâ€¦<br>      [ â€“ FILESâ€¦]  </p>
</blockquote>
<p>å…·ä½“å‚æ•°è¯´æ˜å¯ä»¥åœ¨<a href="https://google.github.io/flatbuffers/md__compiler.html" target="_blank" rel="external">Googleè¯´æ˜æ–‡æ¡£</a>æŸ¥çœ‹ã€‚</p>
<h3 id="åœ¨Android_appä¸­è¯»æ•°æ®">åœ¨Android appä¸­è¯»æ•°æ®</h3><p>åœ¨Android Studioä¸­ä½¿ç”¨FlatBuffersï¼Œéœ€è¦æŠŠrepos_flat.binæ”¾åˆ°res/raw/ç›®å½•ä¸‹ï¼ŒåŒæ—¶æŠŠ<code>repo.java</code>, <code>ReposList.java</code> å’Œ <code>User.java</code>æ”¾åˆ°å·¥ç¨‹æºä»£ç çš„æŸä¸ªç›®å½•ä¸‹ã€‚  </p>
<p>FlatBuffersæä¾›javaåº“æ¥ç›´æ¥åœ¨javaä¸­æ“çºµè¿™ç§æ•°æ®æ ¼å¼ã€‚ä»<a href="https://github.com/frogermcs/FlatBuffs/blob/master/app/libs/flatbuffers-java-1.2.0-SNAPSHOT.jar" target="_blank" rel="external">è¿™é‡Œ</a>ä¸‹è½½jaræ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½çš„latBuffersæºä»£ç ï¼Œç”¨mvnç”Ÿæˆè¿™ä¸ªåº“æ–‡ä»¶ï¼‰ï¼ŒæŠŠå®ƒæ”¾åœ¨Androidå·¥ç¨‹çš„app/libs/ç›®å½•ä¸‹ã€‚  </p>
<p>åœ¨éœ€è¦è¯»å–FlatBuffersæ•°æ®çš„åœ°æ–¹ï¼Œå…ˆæŠŠbinæ–‡ä»¶è¯»å–åˆ°ä¸€ä¸ªbyteæ•°ç»„ä¸­ï¼Œç„¶åç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç è®¿é—®å„æ•°æ®å­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer bb = ByteBuffer.wrap(dataByteArray);</span><br><span class="line">ReposList rootRoposList = ReposList.getRootAsReposList(bb);</span><br><span class="line">Log.i(<span class="string">"TAG"</span>, <span class="string">"reposLength = "</span> + rootRoposList.reposLength());</span><br><span class="line">Repo repo1 = rootRoposList.repos(<span class="number">0</span>);</span><br><span class="line">Log.i(<span class="string">"TAG"</span>, <span class="string">"id: "</span> + repo1.id() + <span class="string">"\nname: "</span> + repo1.name() + <span class="string">"\nforks: "</span> + repo1.forks());</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€è¡Œä»£ç ä¸­ä¼ å…¥çš„å‚æ•°dataByteArrayå°±æ˜¯ä»binæ–‡ä»¶è¯»å‡ºçš„äºŒè¿›åˆ¶byteæ•°ç»„ã€‚</p>
<p><em>æ³¨æ„ï¼š</em><br>Javaä¸æ”¯æŒæ— ç¬¦å·æ ‡é‡ã€‚è¿™æ„å‘³ç€ä½ åœ¨schemaä¸­ä½¿ç”¨çš„ä»»ä½•æ— ç¬¦å·ç±»å‹å®é™…ä¸Šéƒ½ä¼šè¢«è¡¨è¾¾æˆä¸ºä¸€ä¸ªæœ‰ç¬¦å·çš„å€¼ã€‚è¿™è¡¨æ˜ï¼Œæ‰€æœ‰çš„bitéƒ½ä»ç„¶åœ¨ï¼Œä½†å¯èƒ½ä»£è¡¨ä¸€ä¸ªè´Ÿæ•°ã€‚æ¯”å¦‚ï¼Œè¦æŠŠä¸€ä¸ª<code>byte b</code>ä½œä¸ºä¸€ä¸ªæ— ç¬¦å·æ•°æ¥è¯»å–ï¼Œå¯ä»¥è¿™æ ·åšï¼š<code>(short)(b &amp; 0xFF)</code>ã€‚</p>
<h3 id="åœ¨Android_appä¸­å†™æ•°æ®ï¼ˆä»¥FlatBuffersæ ¼å¼ä¼ è¾“æ•°æ®ï¼‰">åœ¨Android appä¸­å†™æ•°æ®ï¼ˆä»¥FlatBuffersæ ¼å¼ä¼ è¾“æ•°æ®ï¼‰</h3><p>å…ˆåˆ›å»ºBuilderï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FlatBufferBuilder fbb = <span class="keyword">new</span> FlatBufferBuilder();</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºStringå­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> str = fbb.createString(<span class="string">"MyMonster"</span>);</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«structçš„tableï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Monster.startMonster(fbb);</span><br><span class="line">Monster.addPos(fbb, Vec3.createVec3(fbb, <span class="number">1.0f</span>, <span class="number">2.0f</span>, <span class="number">3.0f</span>, <span class="number">3.0</span>, (<span class="keyword">byte</span>)<span class="number">4</span>, (<span class="keyword">short</span>)<span class="number">5</span>, (<span class="keyword">byte</span>)<span class="number">6</span>));</span><br><span class="line">Monster.addHp(fbb, (<span class="keyword">short</span>)<span class="number">80</span>);</span><br><span class="line">Monster.addName(fbb, str);</span><br><span class="line">Monster.addInventory(fbb, inv);</span><br><span class="line">Monster.addTest_type(fbb, (<span class="keyword">byte</span>)<span class="number">1</span>);</span><br><span class="line">Monster.addTest(fbb, mon2);</span><br><span class="line">Monster.addTest4(fbb, test4s);</span><br><span class="line"><span class="keyword">int</span> mon = Monster.endMonster(fbb);</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œéœ€è¦ç»ˆæ­¢è¿™ä¸ªbufferï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Monster.finishMonsterBuffer(fbb, mon);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªbufferç°åœ¨å·²ç»å¯ä»¥è¢«ä¼ è¾“äº†ã€‚å®ƒè¢«åŒ…å«åœ¨ByteBufferä¸­ï¼Œå¯ä»¥é€šè¿‡fbb.dataBuffer()æ¥è·å–ã€‚å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œbufferä¸­æœ‰æ•ˆçš„æ•°æ®ä¸æ˜¯ä»åç§»é‡0å¼€å§‹çš„ï¼Œè€Œæ˜¯ä»fbb.dataBuffer().position()å¼€å§‹çš„ï¼Œåœ¨fbb.dataBuffer().capacity()ç»“æŸã€‚</p>
<p>æ›´è¯¦ç»†çš„javaä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥å‚è§<a href="https://google.github.io/flatbuffers/md__java_usage.html" target="_blank" rel="external">googleå®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>æ®è¯´facebookä½¿ç”¨googleçš„é»‘ç§‘æŠ€flatbuffersï¼Œç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„jsonè¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå¤§å¤§æé«˜äº†facebook androidå®¢æˆ·ç«¯çš„æ•ˆç‡ã€‚äºæ˜¯æˆ‘åœ¨ç½‘ä¸ŠæŸ¥æ‰¾å„ç§èµ„æ–™å­¦ä¹ äº†ä¸€ä¸‹flatbuffersï¼Œå‚çœ‹èµ„æ–™åŒ…æ‹¬GOOGLEå®˜æ–¹æ–‡æ¡£ã€facebookæŠ€æœ¯åšå®¢ã€ä»¥åŠå…¶ä»–å›½å†…çš„ä¸ªäººåšå®¢ï¼Œä¹Ÿå†™äº†äº›ä»£ç åšå®éªŒï¼Œä»¥æ­¤æ–‡ä½œä¸ºå­¦ä¹ æ€»ç»“ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯Google_FlatBuffers">ä»€ä¹ˆæ˜¯Google FlatBuffers</h2><p>FlatBuffersæ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ã€é«˜æ•ˆçš„ã€æä¾›äº†C++/Javaæ¥å£çš„åºåˆ—åŒ–å·¥å…·åº“ã€‚å®ƒæ˜¯Googleä¸“é—¨ä¸ºæ¸¸æˆå¼€å‘æˆ–å…¶ä»–æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ç¨‹åºéœ€æ±‚è€Œåˆ›å»ºã€‚å°¤å…¶æ›´é€‚ç”¨äºç§»åŠ¨å¹³å°ï¼Œè¿™äº›å¹³å°ä¸Šå†…å­˜å¤§å°åŠå¸¦å®½ç›¸æ¯”æ¡Œé¢ç³»ç»Ÿéƒ½æ˜¯å—é™çš„ï¼Œè€Œåº”ç”¨ç¨‹åºæ¯”å¦‚æ¸¸æˆåˆæœ‰æ›´é«˜çš„æ€§èƒ½è¦æ±‚ã€‚å®ƒå°†åºåˆ—åŒ–æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œè¿™äº›æ•°æ®æ—¢å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œåˆå¯ä»¥é€šè¿‡ç½‘ç»œåŸæ ·ä¼ è¾“ï¼Œè€Œä¸éœ€è¦ä»»ä½•è§£æå¼€é”€ã€‚<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://www.carrotsight.com/tags/Android/"/>
    
      <category term="FlatBuffers" scheme="http://www.carrotsight.com/tags/FlatBuffers/"/>
    
      <category term="Google" scheme="http://www.carrotsight.com/tags/Google/"/>
    
      <category term="facebook" scheme="http://www.carrotsight.com/tags/facebook/"/>
    
      <category term="Android" scheme="http://www.carrotsight.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Androidç¼–ç¨‹è¦æ³¨æ„çš„å®‰å…¨è§„èŒƒ]]></title>
    <link href="http://www.carrotsight.com/2015/09/19/2015-9-19-Android%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%AE%89%E5%85%A8%E8%A7%84%E8%8C%83.html"/>
    <id>http://www.carrotsight.com/2015/09/19/2015-9-19-Androidç¼–ç¨‹è¦æ³¨æ„çš„å®‰å…¨è§„èŒƒ.html</id>
    <published>2015-09-19T11:46:08.000Z</published>
    <updated>2015-12-03T08:08:03.000Z</updated>
    <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©é˜…è¯»äº†ä¸€ä¸‹android developerç½‘ç«™ä¸å®‰å…¨ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¯¹androidç¼–ç¨‹è¿‡ç¨‹ä¸­ä¸»è¦æ³¨æ„çš„å®‰å…¨ç»†èŠ‚è¿›è¡Œäº†å­¦ä¹ ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è¦ç‚¹ã€‚</p>
<h2 id="Androidæ¡†æ¶è‡ªèº«çš„å®‰å…¨æ€§æœºåˆ¶">Androidæ¡†æ¶è‡ªèº«çš„å®‰å…¨æ€§æœºåˆ¶</h2><ol>
<li>Androidåº”ç”¨ç¨‹åºæ²™ç›’ï¼ŒæŠŠæ¯ä¸ªappçš„æ•°æ®ä¸ä»£ç éƒ½åˆ†éš”å¼€ã€‚  </li>
<li>å¯¹å„ç§å®‰å…¨åŠŸèƒ½è¿›è¡Œäº†å¼ºå¥å®ç°çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¦‚å¯†ç å­¦ã€æƒé™ã€å®‰å…¨IPCç­‰ã€‚  </li>
<li>åŠ å¯†çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿä¿æŠ¤ä¸¢å¤±æˆ–è¢«ç›—è®¾å¤‡çš„æ•°æ®ã€‚  </li>
<li>ç”¨æˆ·èƒ½å¤Ÿæˆæƒæƒé™æ¥é™åˆ¶å¯¹ç³»ç»Ÿå’Œç”¨æˆ·æ•°æ®çš„è®¿é—®ã€‚  </li>
<li>åº”ç”¨ç¨‹åºå®šä¹‰çš„æƒé™ã€‚<a id="more"></a>
<h2 id="æ•°æ®å­˜å‚¨">æ•°æ®å­˜å‚¨</h2><h3 id="ä½¿ç”¨å†…éƒ¨å­˜å‚¨">ä½¿ç”¨å†…éƒ¨å­˜å‚¨</h3></li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ åœ¨å†…éƒ¨å­˜å‚¨ä¸Šåˆ›å»ºçš„æ–‡ä»¶åªèƒ½è¢«è¯¥appæœ¬èº«è®¿é—®ã€‚  </li>
<li>åº”è¯¥å°½é‡é¿å…åœ¨IPCæ–‡ä»¶ä¸Šä½¿ç”¨ MODE_WORLD_WRITEABLEæˆ–MODE_WORLD_READABLEæ¨¡å¼ã€‚å¦‚æœå®åœ¨éœ€è¦æ•°æ®å…±äº«ï¼Œåº”è¯¥ä½¿ç”¨content providerã€‚  </li>
<li>å¯¹äºæ•æ„Ÿæ•°æ®ï¼Œåº”è¯¥é€‰æ‹©ä¸€ä¸ªå¯†é’¥å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œè¿™ä¸ªå¯†é’¥åº”è¯¥ä¸èƒ½ç›´æ¥è¢«åº”ç”¨ç¨‹åºè®¿é—®ã€‚æ¯”å¦‚ï¼ŒæŠŠå¯†é’¥ä¿å­˜åœ¨KeyStoreä¸­ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªä¸å­˜å‚¨åœ¨è¯¥è®¾å¤‡ä¸Šçš„ç”¨æˆ·å¯†ç æ¥ä¿æŠ¤å®ƒã€‚</li>
</ol>
<h3 id="ä½¿ç”¨æ‰©å±•å­˜å‚¨">ä½¿ç”¨æ‰©å±•å­˜å‚¨</h3><ol>
<li>æ‰©å±•å­˜å‚¨ï¼ˆå¦‚SDå¡ï¼‰ä¸Šçš„æ–‡ä»¶æ˜¯å…¨å±€å¯è¯»å†™çš„ï¼ˆè¢«å…¶ä»–åº”ç”¨ç¨‹åºï¼‰ã€‚ä¸è¦åœ¨æ‰©å±•å­˜å‚¨ä¸Šå­˜æ”¾æ•æ„Ÿä¿¡æ¯ã€‚  </li>
<li>å¤„ç†æ‰©å±•å­˜å‚¨ä¸Šçš„æ•°æ®å‰æœ€å¥½è¿›è¡Œè¾“å…¥éªŒè¯ã€‚</li>
</ol>
<h3 id="ä½¿ç”¨content_providers">ä½¿ç”¨content providers</h3><ol>
<li>å¦‚æœä¸æ‰“ç®—è®©å…¶ä»–åº”ç”¨ç¨‹åºè®¿é—®ä½ çš„ContentProviderï¼Œå°±åœ¨manifestæ–‡ä»¶ä¸­ç”¨<code>android:exported=false</code>æ¥æ ‡è®°å®ƒã€‚  </li>
<li>å¦‚æœåˆ›å»ºçš„ContentProvideréœ€è¦è¢«æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå¯ä»¥ç‰¹åˆ«æŒ‡å®šå•ç‹¬çš„è¯»æƒé™å’Œå†™æƒé™ã€‚  </li>
<li>å¦‚æœä½¿ç”¨ContentProvideråªæ˜¯åœ¨ä½ è‡ªå·±çš„å‡ ä¸ªappä¹‹é—´å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆæœ€å¥½æŠŠ<code>android:protectionLevel</code>å±æ€§è®¾ç½®ä¸º<code>&quot;signature&quot;</code>ã€‚  </li>
<li>å¯ä»¥å¯¹content provideræä¾›æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œå¦‚ä½¿ç”¨<code>android:grantUriPermissions</code>å±æ€§ï¼Œåœ¨Intentå¯¹è±¡ä¸­ä½¿ç”¨<code>FLAG_GRANT_READ_URI_PERMISSION</code>å’Œ<code>FLAG_GRANT_WRITE_URI_PERMISSION</code>æ ‡è®°ã€‚  </li>
<li>åœ¨è®¿é—®content provideræ—¶ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æ–¹æ³•å¦‚query()ã€update()ã€delete()ç­‰æ¥é¿å…æ½œåœ¨çš„SQLæ³¨å…¥é£é™©ã€‚ä½†è¿™ä»æœ‰é£é™©ï¼Œæ¯”å¦‚selectionå‚æ•°æ˜¯é€šè¿‡ä¹‹å‰ç”¨æˆ·æäº¤çš„æ•°æ®è¿æ¥è€Œæˆçš„ã€‚  </li>
<li>ä¸è¦å¯¹å†™æƒé™çš„å®‰å…¨æ€§äº§ç”Ÿé”™è§‰ã€‚æ¯”å¦‚ï¼Œå¦‚æœå†™æƒé™å…è®¸å†™SQLè¯­å¥ï¼Œé‚£ä¹ˆWHEREå­—å¥å·§å¦™åœ°æ„é€ å°±å¯ä»¥ä½¿å¾—â€œå†™æƒé™â€ç­‰ä»·äºâ€œè¯»å†™æƒé™â€ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨æƒé™">ä½¿ç”¨æƒé™</h2><h3 id="è¯·æ±‚æƒé™">è¯·æ±‚æƒé™</h3><ol>
<li>è¯·æ±‚æœ€å°‘æ•°é‡çš„æƒé™ï¼Œå¦‚æœä¸€ä¸ªæƒé™å¯¹ä½ çš„appæ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œå°±ä¸è¦è¯·æ±‚ã€‚  </li>
<li>å®Œå…¨æœ‰å¯èƒ½ç”¨ä¸€ç§æ–¹æ³•ä¸è¯·æ±‚ä»»ä½•æƒé™ï¼Œæ¯”å¦‚ä¸ºäº†åˆ›å»ºç‹¬ä¸€æ— äºŒçš„æ ‡ç¤ºç¬¦å¯ä»¥ä½¿ç”¨GUIDè€Œä¸æ˜¯è¯·æ±‚è®¾å¤‡ä¿¡æ¯ï¼Œå¯ä»¥æŠŠæ•°æ®å­˜å‚¨åœ¨å†…éƒ¨å­˜å‚¨ï¼ˆæ— é¡»æƒé™ï¼‰è€Œä¸æ˜¯å­˜å‚¨åœ¨æ‰©å±•å­˜å‚¨ï¼ˆéœ€è¦æƒé™ï¼‰ã€‚  </li>
<li>æ¨èå°½å¯èƒ½ä½¿ç”¨è®¿é—®æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ç¡®è®¤çš„æƒé™ï¼Œå› ä¸ºæƒé™å¯èƒ½è®©ç”¨æˆ·ç–‘æƒ‘ã€‚</li>
<li>ä¸è¦æ³„éœ²æœ‰æƒé™ä¿æŠ¤çš„æ•°æ®ã€‚</li>
</ol>
<h3 id="åˆ›å»ºæƒé™">åˆ›å»ºæƒé™</h3><p>è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼Œå› ä¸ºç³»ç»Ÿå®šä¹‰çš„æƒé™å·²è¿‘è¦†ç›–äº†å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚<br>å¦‚æœå¿…é¡»åˆ›å»ºæ–°æƒé™ï¼Œè€ƒè™‘æ˜¯å¦å¯ä»¥ç”¨<code>&quot;signature&quot;</code>çº§åˆ«çš„<code>protection level</code>æ¥å®ç°ã€‚</p>
<h2 id="ä½¿ç”¨ç½‘ç»œ">ä½¿ç”¨ç½‘ç»œ</h2><h3 id="ä½¿ç”¨IPç½‘ç»œ">ä½¿ç”¨IPç½‘ç»œ</h3><ol>
<li>ç¡®ä¿å¯¹äºæ•æ„Ÿä¿¡æ¯ä½¿ç”¨åˆé€‚çš„åè®®ï¼Œæ¯”å¦‚HttpsURLConnectionã€‚å¦‚æœæœåŠ¡å™¨æ”¯æŒçš„è¯ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨HTTPSè€Œä¸æ˜¯HTTPï¼Œå› ä¸ºç§»åŠ¨è®¾å¤‡é¢‘ç¹çš„è¿æ¥åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­ï¼Œæ¯”å¦‚å…¬å…±Wi-Fiçƒ­ç‚¹ã€‚  </li>
<li>è®¤è¯çš„åŠ å¯†çš„å¥—æ¥å­—çº§åˆ«çš„ä¼šè¯ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨SSLSocketç±»æ¥å®ç°ã€‚  </li>
<li>æœ‰äº›å¼•ç”¨ç¨‹åºä½¿ç”¨localhostç½‘ç»œç«¯å£æ¥å¤„ç†æ•æ„Ÿçš„IPCï¼Œè¿™ç§åšæ³•åº”è¯¥é¿å…ï¼Œå› ä¸ºå…¶ä»–åº”ç”¨ç¨‹åºä¹Ÿèƒ½å¤Ÿè®¿é—®åˆ°è¿™äº›æ¥å£ã€‚åº”è¯¥ä½¿ç”¨å…·æœ‰æˆæƒæ§åˆ¶çš„Android IPCæœºåˆ¶æ¯”å¦‚Serviceã€‚</li>
<li>æ‰€æœ‰é€šè¿‡HTTPåè®®æˆ–å…¶ä»–ä¸å®‰å…¨åè®®è·å–åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸å¯ä¿¡ä»»çš„ï¼Œè¦åšå¥½æ•°æ®éªŒè¯å·¥ä½œã€‚</li>
</ol>
<h3 id="ä½¿ç”¨ç”µè¯ç½‘ç»œ">ä½¿ç”¨ç”µè¯ç½‘ç»œ</h3><p>SMSåè®®çš„è®¾è®¡æœ¬å°±ä¸é€‚åˆappä¼ è¾“æ•°æ®ã€‚ä¸ç®¡æ˜¯åœ¨ç½‘ç»œä¸Šè¿˜æ˜¯è®¾å¤‡ä¸Šï¼ŒSMSæ—¢æ²¡æœ‰åŠ å¯†ä¹Ÿæ²¡æœ‰å¼ºå£®çš„è®¤è¯ã€‚åœ¨Androidè®¾å¤‡ä¸Šï¼ŒSMSæ¶ˆæ¯æ˜¯ä»¥å¹¿æ’­å½¢å¼ä¼ è¾“çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è¢«æ‰€æœ‰å…¶ä»–å…·æœ‰<code>READ_SMS</code>æƒé™çš„åº”ç”¨ç¨‹åºè¯»å–æˆ–æ•è·ã€‚  </p>
<h2 id="ä½¿ç”¨WebView">ä½¿ç”¨WebView</h2><ol>
<li>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸ç›´æ¥é€šè¿‡webviewä½¿ç”¨JavaScriptï¼Œé‚£ä¹ˆå°±ä¸è¦è°ƒç”¨<code>setJavaScriptEnabled()</code>ã€‚é»˜è®¤æƒ…å†µä¸‹webviewæ˜¯ä¸æ‰§è¡ŒJavaScriptçš„ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»ã€‚  </li>
<li>åªæŠŠ<code>addJavaScriptInterface()</code>æš´éœ²ç»™å…·æœ‰å¯ä¿¡è¾“å…¥çš„ç½‘é¡µã€‚  </li>
<li>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºé€šè¿‡WebViewè®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨    <code>clearCache()</code>æ–¹æ³•æ¥åˆ é™¤ä»»ä½•å­˜å‚¨åœ¨æœ¬åœ°çš„æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„headeræ¯”å¦‚<code>no-cache</code>æ¥è¡¨æ˜ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸åº”è¯¥ç¼“å­˜ç‰¹å®šçš„å†…å®¹ã€‚</li>
<li>ç”¨æˆ·åå’Œå¯†ç ä¸åº”è¯¥å­˜å‚¨åœ¨è®¾å¤‡ä¸Šã€‚åˆæ¬¡è®¤è¯çš„æ—¶å€™ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åå°±ä½¿ç”¨ä¸€ä¸ªçŸ­ç”Ÿå‘½å‘¨æœŸçš„ã€serviceç‰¹æœ‰çš„è®¤è¯tokenã€‚</li>
<li>è¢«å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®çš„Serviceåº”è¯¥ä½¿ç”¨AccountManageræ¥è®¿é—®ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨å¯†ç å­¦">ä½¿ç”¨å¯†ç å­¦</h2><ol>
<li>å¦‚æœéœ€è¦å®‰å…¨åœ°ä»å·²çŸ¥ä½ç½®è·å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨<code>HTTPS URI</code>ã€‚  </li>
<li>å¦‚æœéœ€è¦å®‰å…¨æ•°æ®é€šé“ï¼Œè€ƒè™‘ä½¿ç”¨<code>HttpsURLConnection</code>æˆ–è€…<code>SSLSocket</code>ï¼Œè€Œä¸æ˜¯å»å†™ä¸€ä¸ªä½ è‡ªå·±çš„åè®®ã€‚  </li>
<li>å¦‚æœä½ çœŸçš„éœ€è¦å®ç°è‡ªå·±çš„åè®®ï¼Œä¹Ÿä¸è¦è‡ªå·±å®ç°åŠ å¯†ç®—æ³•ï¼Œå¯ä»¥ç›´æ¥åªç”¨å­˜åœ¨çš„å·²å®ç°çš„åŠ å¯†ç®—æ³•ï¼Œæ¯”å¦‚<code>Cipher</code>ç±»ä¸­çš„AESæˆ–è€…RSAç®—æ³•ã€‚  </li>
<li>ä½¿ç”¨å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨<code>SecureRandom</code>æ¥åˆå§‹åŒ–ä»»ä½•çš„å¯†é’¥ã€<code>KeyGenerator</code>ã€‚ä½¿ç”¨éå®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨å¾—åˆ°çš„å¯†é’¥ï¼Œä¼šå‰Šå¼±ç®—æ³•çš„å®‰å…¨å¼ºåº¦ï¼Œä¹Ÿä¼šå¯¼è‡´ç¦»çº¿æ”»å‡»ã€‚</li>
<li>å¦‚æœéœ€è¦å­˜å‚¨ä¸€ä¸ªå¯†é’¥æ¥æä¾›å¤šæ¬¡ä½¿ç”¨ï¼Œåº”è¯¥ä½¿ç”¨è¯¸å¦‚<code>KeyStore</code>ä¹‹ç±»çš„æœºåˆ¶ã€‚  </li>
</ol>
<h2 id="ä½¿ç”¨IPC">ä½¿ç”¨IPC</h2><ol>
<li>ä¸è¦ä½¿ç”¨ä¼ ç»ŸLinuxä¸­çš„IPCæŠ€æœ¯æ¯”å¦‚ç½‘ç»œå¥—æ¥å­—å’Œå…±äº«æ–‡ä»¶ç­‰ã€‚åº”è¯¥ä½¿ç”¨Androidç³»ç»Ÿæä¾›çš„IPCåŠŸèƒ½æ¯”å¦‚Intentã€ä¸Serviceé…åˆçš„Binderæˆ–è€…Messengerã€BroadcastReceiverã€‚Androidçš„IPCæœºåˆ¶å…è®¸ä½ éªŒè¯è¿æ¥åˆ°ä½ IPCçš„åº”ç”¨ç¨‹åºçš„èº«ä»½ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸ºæ¯ä¸ªIPCæœºåˆ¶è®¾ç½®å®‰å…¨ç­–ç•¥ã€‚  </li>
<li>å¦‚æœä½ çš„IPCæœºåˆ¶ä¸æ‰“ç®—ç»™å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå¯ä»¥åœ¨manifestæ¸…å•ä¸­æŠŠ<code>android:exported</code>å±æ€§è®¾ç½®ä¸º<code>false</code>ã€‚  </li>
</ol>
<hr>
<p>å…¶ä»–å®‰å…¨æ€§ç›¸å…³é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ:<br>1ã€<a href="http://developer.android.com/training/best-security.html" target="_blank" rel="external">http://developer.android.com/training/best-security.html</a><br>2ã€<a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=Secure_Mobile_Development" target="_blank" rel="external">https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=Secure_Mobile_Development</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>è¿™ä¸¤å¤©é˜…è¯»äº†ä¸€ä¸‹android developerç½‘ç«™ä¸å®‰å…¨ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¯¹androidç¼–ç¨‹è¿‡ç¨‹ä¸­ä¸»è¦æ³¨æ„çš„å®‰å…¨ç»†èŠ‚è¿›è¡Œäº†å­¦ä¹ ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è¦ç‚¹ã€‚</p>
<h2 id="Androidæ¡†æ¶è‡ªèº«çš„å®‰å…¨æ€§æœºåˆ¶">Androidæ¡†æ¶è‡ªèº«çš„å®‰å…¨æ€§æœºåˆ¶</h2><ol>
<li>Androidåº”ç”¨ç¨‹åºæ²™ç›’ï¼ŒæŠŠæ¯ä¸ªappçš„æ•°æ®ä¸ä»£ç éƒ½åˆ†éš”å¼€ã€‚  </li>
<li>å¯¹å„ç§å®‰å…¨åŠŸèƒ½è¿›è¡Œäº†å¼ºå¥å®ç°çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¦‚å¯†ç å­¦ã€æƒé™ã€å®‰å…¨IPCç­‰ã€‚  </li>
<li>åŠ å¯†çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿä¿æŠ¤ä¸¢å¤±æˆ–è¢«ç›—è®¾å¤‡çš„æ•°æ®ã€‚  </li>
<li>ç”¨æˆ·èƒ½å¤Ÿæˆæƒæƒé™æ¥é™åˆ¶å¯¹ç³»ç»Ÿå’Œç”¨æˆ·æ•°æ®çš„è®¿é—®ã€‚  </li>
<li>åº”ç”¨ç¨‹åºå®šä¹‰çš„æƒé™ã€‚]]>
    
    </summary>
    
      <category term="Android" scheme="http://www.carrotsight.com/tags/Android/"/>
    
      <category term="å®‰å…¨" scheme="http://www.carrotsight.com/tags/%E5%AE%89%E5%85%A8/"/>
    
      <category term="Android" scheme="http://www.carrotsight.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ã€ŠThink in Javaã€‹ç±»å‹ä¿¡æ¯ â€“ å­¦ä¹ ç¬”è®°]]></title>
    <link href="http://www.carrotsight.com/2015/09/16/2015-9-16-%E3%80%8AThink-in-Java%E3%80%8B%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF-%E2%80%93-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"/>
    <id>http://www.carrotsight.com/2015/09/16/2015-9-16-ã€ŠThink-in-Javaã€‹ç±»å‹ä¿¡æ¯-â€“-å­¦ä¹ ç¬”è®°.html</id>
    <published>2015-09-16T08:22:16.000Z</published>
    <updated>2015-12-03T08:07:51.000Z</updated>
    <content type="html"><![CDATA[<h2 id="Classå¯¹è±¡">Classå¯¹è±¡</h2><p>Classå¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚Classå¯¹è±¡ç”¨æ¥åˆ›å»ºç±»çš„æ‰€æœ‰çš„â€œå¸¸è§„â€å¯¹è±¡ã€‚Javaä½¿ç”¨Classå¯¹è±¡æ¥æ‰§è¡ŒRTTIï¼ˆåŒ…æ‹¬ç±»å‹è½¬æ¢æ“ä½œï¼‰ã€‚<br>æ¯å½“ç¼–å†™å¹¶ç¼–è¯‘ä¸€ä¸ªæ–°ç±»ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ï¼ˆæˆ–è€…è¯´è¢«ä¿å­˜åœ¨ä¸€ä¸ªåŒåçš„.classæ–‡ä»¶ä¸­ï¼‰ã€‚  </p>
<p>Classå¯¹è±¡çš„å¼•ç”¨å¯ä»¥é€šè¿‡Class.forName()æˆ–æ™®é€šå¯¹è±¡çš„getClass()æ–¹æ³•æ¥è·å–,æˆ–ç±»ååŠ ä¸Š.classæ¥è·å¾—ã€‚å…¶ä¸­ï¼ŒgetClass()æ–¹æ³•å±äºæ ¹ç±»Objectçš„ä¸€éƒ¨åˆ†ã€‚â€.classâ€ç§°ä¸º<em>ç±»å­—é¢å¸¸é‡</em>ï¼Œä»–åœ¨ç¼–è¯‘æ—¶å°±ä¼šå—åˆ°æ£€æŸ¥ï¼Œæ‰€ä»¥æ›´å®‰å…¨ï¼Œä¹Ÿæ›´é«˜æ•ˆã€‚  </p>
<p>å·®åˆ«ï¼šâ€œ.classâ€ä¸ä¼šå¼•èµ·ç±»çš„åˆå§‹åŒ–ï¼Œè€ŒClass.forName()æ–¹æ³•ä¼šç«‹å³å°±è¿›è¡Œåˆå§‹åŒ–ã€‚<br><a id="more"></a><br>Classå¯¹è±¡åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿäº†è§£ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š  </p>
<ol>
<li>getNameï¼ˆï¼‰ï¼šäº§ç”Ÿå…¨é™å®šçš„ç±»å  </li>
<li>getSimpleNameï¼ˆï¼‰ï¼šäº§ç”Ÿä¸å«åŒ…åçš„ç±»å  </li>
<li>getCanonicalNameï¼ˆï¼‰ï¼šäº§ç”Ÿå…¨é™å®šçš„ç±»å  </li>
<li>isInterfaceï¼ˆï¼‰ï¼šåˆ¤å®šè¿™ä¸ªClasså¯¹è±¡æ˜¯å¦è¡¨ç¤ºæŸä¸ªæ¥å£  </li>
<li>getSuperclassï¼ˆï¼‰ï¼šæŸ¥è¯¢ç›´æ¥åŸºç±»```</li>
</ol>
<p>å¦‚æœè°ƒç”¨Classå¯¹è±¡çš„newInstanceï¼ˆï¼‰æ–¹æ³•æ¥å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œåˆ™è¿™ä¸ªç±»å¿…é¡»å¸¦æœ‰é»˜è®¤æ„é€ å™¨ã€‚  </p>
<p>ä¸ºäº†ä½¿ç”¨ç±»è€Œåšçš„å‡†å¤‡å·¥ä½œå®é™…åŒ…å«3ä¸ªæ­¥éª¤ï¼š  </p>
<ol>
<li><strong>åŠ è½½</strong>ã€‚è¿™æ˜¯ç”±ç±»åŠ è½½å™¨æ‰§è¡Œçš„ã€‚è¯¥æ­¥éª¤æŸ¥æ‰¾å­—èŠ‚ç å¹¶ä»è¿™äº›å­—èŠ‚ç ä¸­åˆ›å»ºä¸€ä¸ªClasså¯¹è±¡ã€‚  </li>
<li><strong>é“¾æ¥</strong>ã€‚åœ¨é“¾æ¥é˜¶æ®µå°†éªŒè¯ç±»ä¸­çš„å­—èŠ‚ç ï¼Œä¸ºé™æ€åŸŸåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”å¦‚æœå¿…è¦çš„è¯ï¼Œå°†è§£æè¿™ä¸ªç±»åˆ›å»ºçš„å¯¹å…¶ä»–ç±»çš„æ‰€æœ‰å¼•ç”¨ã€‚  </li>
<li><strong>åˆå§‹åŒ–</strong>ã€‚å¦‚æœè¯¥ç±»å…·æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åˆå§‹åŒ–å™¨å’Œé™æ€åˆå§‹åŒ–å—ã€‚  </li>
</ol>
<h2 id="åå°„ï¼šè¿è¡Œæ—¶çš„ç±»ä¿¡æ¯">åå°„ï¼šè¿è¡Œæ—¶çš„ç±»ä¿¡æ¯</h2><p>RTTIå’Œåå°„ä¹‹é—´çœŸæ­£çš„åŒºåˆ«åªåœ¨äºï¼Œå¯¹RTTIæ¥è¯´ï¼Œç¼–è¯‘å™¨åœ¨<strong>ç¼–è¯‘æ—¶</strong>æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶ï¼ˆå³æˆ‘ä»¬å¯ä»¥ç”¨â€œæ™®é€šâ€æ–¹å¼è°ƒç”¨å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ï¼‰ã€‚è€Œå¯¹äºåå°„æœºåˆ¶æ¥è¯´ï¼Œ.classæ–‡ä»¶åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸å¯è·å–çš„ï¼Œæ‰€ä»¥æ˜¯åœ¨<strong>è¿è¡Œæ—¶</strong>æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶ã€‚  </p>
<p>Classç±»ä¸java.lang.reflectç±»åº“ä¸€èµ·å¯¹<em>åå°„</em>çš„æ¦‚å¿µè¿›è¡Œäº†æ”¯æ’‘ï¼Œè¯¥ç±»åº“åŒ…å«äº†Fieldã€Methodä»¥åŠConstructorç±»ï¼ˆæ¯ä¸ªç±»éƒ½å®ç°äº†Memberæ¥å£ï¼‰ã€‚è¿™äº›ç±»å‹çš„å¯¹è±¡æ˜¯ç”±JVMåœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ï¼Œç”¨ä»¥è¡¨ç¤ºæœªçŸ¥ç±»é‡Œå¯¹åº”çš„æˆå‘˜ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨Constructoråˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç”¨get()å’Œset()æ–¹æ³•è¯»å–å’Œä¿®æ”¹ä¸Fieldå¯¹è±¡å…³è”çš„å­—æ®µï¼Œç”¨invoke()æ–¹æ³•è°ƒç”¨ä¸Methodå¯¹è±¡å…³è”çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨getField()ã€getMethods()å’ŒgetConstructors()ç­‰å¾ˆä¾¿åˆ©çš„æ–¹æ³•ï¼Œä»¥è¿”å›è¡¨ç¤ºå­—æ®µã€æ–¹æ³•ä»¥åŠæ„é€ å™¨çš„å¯¹è±¡çš„æ•°ç»„ã€‚è¿™æ ·ï¼Œ<strong>åŒ¿åå¯¹è±¡çš„ç±»ä¿¡æ¯å°±èƒ½åœ¨è¿è¡Œæ—¶è¢«å®Œå…¨ç¡®å®šä¸‹æ¥ï¼Œè€Œåœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦çŸ¥é“ä»»ä½•äº‹æƒ…ã€‚</strong>  </p>
<p>ç”¨å¦‚ä¸‹ä»£ç æ¥æµ‹è¯•åå°„æœºåˆ¶ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class&lt;?&gt; appleClass = Class.forName(<span class="string">"classinfo.Apple"</span>);</span><br><span class="line">			System.out.println(<span class="string">"===Methods:===\n"</span>);</span><br><span class="line">			<span class="keyword">for</span>( Method method : appleClass.getMethods())&#123;</span><br><span class="line">				System.out.println(method.toString());</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">"===Constructors:===\n"</span>);</span><br><span class="line">			<span class="keyword">for</span>( Constructor&lt;?&gt; cons : appleClass.getConstructors())&#123;</span><br><span class="line">				System.out.println(cons.toString());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> weight;</span><br><span class="line">	<span class="keyword">private</span> String color;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">(<span class="keyword">int</span> weight, String color)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.weight = weight;</span><br><span class="line">		<span class="keyword">this</span>.color = color;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">incWeight</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ++weight;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">decWeight</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> --weight;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœä¸ºï¼š </p>
<blockquote>
<p>===Methods:===<br>public int classinfo.Apple.incWeight()<br>public int classinfo.Apple.decWeight()<br>public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException<br>public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException<br>public final void java.lang.Object.wait() throws java.lang.InterruptedException<br>public boolean java.lang.Object.equals(java.lang.Object)<br>public java.lang.String java.lang.Object.toString()<br>public native int java.lang.Object.hashCode()<br>public final native java.lang.Class java.lang.Object.getClass()<br>public final native void java.lang.Object.notify()<br>public final native void java.lang.Object.notifyAll()</p>
<p>===Constructors:===<br>public classinfo.Apple()<br>public classinfo.Apple(int,java.lang.String)</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Classå¯¹è±¡">Classå¯¹è±¡</h2><p>Classå¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚Classå¯¹è±¡ç”¨æ¥åˆ›å»ºç±»çš„æ‰€æœ‰çš„â€œå¸¸è§„â€å¯¹è±¡ã€‚Javaä½¿ç”¨Classå¯¹è±¡æ¥æ‰§è¡ŒRTTIï¼ˆåŒ…æ‹¬ç±»å‹è½¬æ¢æ“ä½œï¼‰ã€‚<br>æ¯å½“ç¼–å†™å¹¶ç¼–è¯‘ä¸€ä¸ªæ–°ç±»ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ï¼ˆæˆ–è€…è¯´è¢«ä¿å­˜åœ¨ä¸€ä¸ªåŒåçš„.classæ–‡ä»¶ä¸­ï¼‰ã€‚  </p>
<p>Classå¯¹è±¡çš„å¼•ç”¨å¯ä»¥é€šè¿‡Class.forName()æˆ–æ™®é€šå¯¹è±¡çš„getClass()æ–¹æ³•æ¥è·å–,æˆ–ç±»ååŠ ä¸Š.classæ¥è·å¾—ã€‚å…¶ä¸­ï¼ŒgetClass()æ–¹æ³•å±äºæ ¹ç±»Objectçš„ä¸€éƒ¨åˆ†ã€‚â€.classâ€ç§°ä¸º<em>ç±»å­—é¢å¸¸é‡</em>ï¼Œä»–åœ¨ç¼–è¯‘æ—¶å°±ä¼šå—åˆ°æ£€æŸ¥ï¼Œæ‰€ä»¥æ›´å®‰å…¨ï¼Œä¹Ÿæ›´é«˜æ•ˆã€‚  </p>
<p>å·®åˆ«ï¼šâ€œ.classâ€ä¸ä¼šå¼•èµ·ç±»çš„åˆå§‹åŒ–ï¼Œè€ŒClass.forName()æ–¹æ³•ä¼šç«‹å³å°±è¿›è¡Œåˆå§‹åŒ–ã€‚<br>]]>
    
    </summary>
    
      <category term="Java" scheme="http://www.carrotsight.com/tags/Java/"/>
    
      <category term="reflection" scheme="http://www.carrotsight.com/tags/reflection/"/>
    
      <category term="åå°„" scheme="http://www.carrotsight.com/tags/%E5%8F%8D%E5%B0%84/"/>
    
      <category term="Java" scheme="http://www.carrotsight.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Ottoå­¦ä¹ ç¬”è®°]]></title>
    <link href="http://www.carrotsight.com/2015/09/15/2015-9-15-Otto%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"/>
    <id>http://www.carrotsight.com/2015/09/15/2015-9-15-Ottoå­¦ä¹ ç¬”è®°.html</id>
    <published>2015-09-15T07:49:16.000Z</published>
    <updated>2015-12-02T04:19:44.000Z</updated>
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ å®ŒEventBusåï¼Œå‘ç°ä¸ä¹‹ç±»ä¼¼çš„äº‹ä»¶åº“è¿˜æœ‰ottoï¼Œäºæ˜¯æˆ‘ä¹Ÿå­¦ä¹ äº†ä¸€ä¸‹ã€‚åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„å¤§éƒ¨åˆ†åšå®¢å…¶å®éƒ½æ˜¯å¯¹ottoå®˜æ–¹æ–‡æ¡£çš„ä¸­æ–‡ç¿»è¯‘è€Œå·²ï¼Œå¯¹ç”Ÿäº§è€…çš„@Produceã€PUBLISHINGã€PRODUCINGä¹‹é—´çš„å…³ç³»æ²¡æœ‰æ·±å…¥è§£é‡Šï¼Œä¹Ÿæ²¡æœ‰å¯¹EventBusçš„StickyEvnetä¸Ottoä¸­ç±»ä¼¼æœºåˆ¶çš„å¯¹æ¯”ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘æƒ³äº†è§£çš„ã€‚æ‰€ä»¥å°±è‡ªå·±å†™demoåšäº†äº›å®éªŒï¼Œæ€»ç»“äº†è¿™ç¯‡å­¦ä¹ ç¬”è®°ã€‚</p>
<p><strong><br>æœ¬æ–‡çš„OttoæŒ‡çš„æ˜¯ï¼šsquare/otto<br>EventBusæŒ‡çš„æ˜¯ï¼šgreenrobot/EventBus<br>Githubä¸Šæœ‰å¾ˆå¤šåŒåé¡¹ç›®ï¼Œä¸è¦æé”™ã€‚
</strong></p>
<p>æœ¬æ–‡æ¡£å‰é¢æ˜¯å¯¹Ottoå„æ–¹é¢çš„ä»‹ç»ã€‚å¦‚æœè¦å­¦ä¹ å¿«é€Ÿä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°åé¢çš„<a href="#è¯¦ç»†ä½¿ç”¨å®ä¾‹">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a>éƒ¨åˆ†ã€‚</p>
<h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2><p>Ottoçš„ä½œç”¨ä¸EventBusç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨äºç»„ä»¶é—´é€šä¿¡ï¼Œé™ä½ä¸åŒçš„ç±»ç›¸äº’ä¹‹é—´çš„è€¦åˆã€‚å¦‚æœä¸ç†Ÿæ‚‰EventBusï¼Œå¯ä»¥å…ˆäº†è§£EventBusï¼Œä¸‹æ–‡æ¶‰åŠåˆ°ottoä¸EventBusçš„å¯¹æ¯”ã€‚</p>
<p>Ottoå¯ä»¥éšä¾¿å®šä¹‰è®¢é˜…è€…çš„æ¶ˆæ¯å¤„ç†å‡½æ•°çš„å‡½æ•°åï¼Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼æ¥è¯†åˆ«ç”Ÿäº§å‡½æ•°å’Œæ¶ˆè´¹å‡½æ•°ï¼ˆ@Produceå’Œ@Subscribeï¼‰ï¼Œè¿™æ˜¯ä¸EventBusæ˜æ˜¾çš„ä¸åŒã€‚<br><a id="more"></a></p>
<h2 id="PUBLISHINGã€SUBSCRIBINGä¸PRODUCING">PUBLISHINGã€SUBSCRIBINGä¸PRODUCING</h2><p>è™½ç„¶åŒæ ·æ˜¯è®¢é˜…è€…æ¨¡å¼çš„å®ç°ï¼Œä½†æ˜¯Ottoä¸Eventbusç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªâ€œPRODUCINGâ€çš„æ¦‚å¿µï¼ˆEventbusä¸­åªæœ‰PUBLISHINGå’ŒSUBSCRIBINGçš„æ¦‚å¿µï¼‰ã€‚<br>å…¶å®è¿™é‡Œçš„PRODUCINGè®¾è®¡çš„åˆè¡·ä¸Eventbusä¸­çš„StickyEventæ˜¯ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯ä¸ºäº†èƒ½å¤Ÿå–åˆ°æŸä¸­ç±»å‹çš„äº‹ä»¶çš„æœ€æ–°å€¼ï¼Œä½†åœ¨å®ç°ä¸Šæœ‰è¾ƒå¤§å·®å¼‚ã€‚</p>
<h3 id="è®¢é˜…äº‹ä»¶">è®¢é˜…äº‹ä»¶</h3><p><strong>ç”¨æ¥æ¶ˆè€—ï¼ˆæˆ–è€…è¯´å¤„ç†ï¼‰äº‹ä»¶çš„æ˜¯è®¢é˜…è€…ï¼Œå¿…é¡»ç”¨@Subscribeæ ‡æ³¨ã€‚</strong>  è®¢é˜…è€…ï¼ˆå‡å®šæ˜¯ä¸€ä¸ªActivityï¼‰éœ€è¦åœ¨åˆå§‹åŒ–æ—¶ï¼ˆonCreate()æ–¹æ³•æˆ–onResume()æ–¹æ³•ä¸­ï¼‰ä½¿ç”¨registerï¼ˆï¼‰æ–¹æ³•å‘æ€»çº¿æ³¨å†Œï¼Œåœ¨onDestroyï¼ˆï¼‰æˆ–onPauseï¼ˆï¼‰æ—¶è°ƒç”¨unregisterï¼ˆï¼‰ä»æ€»çº¿åæ³¨å†Œã€‚  </p>
<h3 id="å‘å¸ƒäº‹ä»¶">å‘å¸ƒäº‹ä»¶</h3><h4 id="PUBLISHING">PUBLISHING</h4><p>è€Œäº§ç”Ÿï¼ˆæˆ–è€…è¯´å‘å¸ƒï¼‰äº‹ä»¶çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸ä½¿ç”¨@Produceæ ‡æ³¨ï¼Œè¿™ç§æ–¹å¼è¢«ottoå®˜æ–¹æ–‡æ¡£ç§°ä¸º<strong>PUBLISHING</strong>ï¼Œæ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨buså¯¹è±¡çš„postæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyApplicationUtil.bus.post(<span class="keyword">new</span> TextEvent(<span class="string">"è¿™æ˜¯PUBLISHINGäº‹ä»¶: "</span> + <span class="keyword">new</span> Date()));</span><br></pre></td></tr></table></figure>   </p>
<h4 id="PRODUCING">PRODUCING</h4><p>å¦ä¸€ç§æ˜¯ä½¿ç”¨@Produceæ ‡æ³¨ï¼Œè¿™ç§æ–¹å¼è¢«ottoå®˜æ–¹æ–‡æ¡£ç§°ä¸º<strong>PRODUCING</strong>ã€‚å¦‚æœä½¿ç”¨äº†@Produceæ¥æ ‡æ³¨ç”Ÿäº§è€…ï¼ˆå³å®ç°PRODUCINGåŠŸèƒ½ï¼‰ï¼Œå°±éœ€è¦åŒæ—¶åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨bus.register(this)æ¥æ³¨å†Œè¿™ä¸ªç”Ÿäº§è€…ï¼Œåœ¨é”€æ¯ç»„ä»¶æ—¶è°ƒç”¨unregisterï¼ˆï¼‰ã€‚  </p>
<p>PRODUCINGå…¶å®ç±»ä¼¼äºEventBusä¸­çš„StickyEventã€‚ ç”¨rigisteræ–¹æ³•æ³¨å†Œ@Produceæ ‡æ³¨çš„ç”Ÿäº§è€…ï¼ˆè¢«æ³¨å†Œçš„å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªäº‹ä»¶å®ä¾‹ï¼‰æ—¶ï¼Œ @Produceæ ‡æ³¨çš„ç”Ÿäº§è€…å‡½æ•°ä¼šä¸ºæ‰€æœ‰ä¹‹å‰æ³¨å†Œäº†è¯¥äº‹ä»¶ç±»å‹çš„è®¢é˜…è€…<strong>åˆ†åˆ«è¿›è¡Œä¸€æ¬¡å›è°ƒ</strong>ï¼Œå¹¶ä¸”æ­¤ç”Ÿäº§è€…å‡½æ•°ä¹Ÿå°†ä¸ºåœ¨æ­¤ä¹‹åæ³¨å†Œçš„è¯¥äº‹ä»¶ç±»å‹çš„è®¢é˜…è€…<strong>åˆ†åˆ«è¿›è¡Œä¸€æ¬¡å›è°ƒ</strong>ã€‚  </p>
<p>Ottoæ²¡æœ‰EventBusä¸­é‚£ç§å¯ä»¥åœ¨ä»»æ„åœ°æ–¹è·å–StickyEventçš„æ–¹æ³•ï¼Œå› ä¸ºè™½ç„¶PRODUCINGä¸StickyEventç±»ä¼¼ï¼Œä½†<strong>Eventbusæ˜¯é€šè¿‡ä¸€ä¸ªmapæ¥ç¼“å­˜StickyEventçš„æœ€åä¸€æ¬¡æ›´æ–°å€¼ï¼Œä¸ä¼šè§¦å‘ä»»ä½•å‡½æ•°å›è°ƒï¼Œè€ŒOttoçš„PRODUCINGå¹¶æ²¡æœ‰è¿™ç§ç¼“å­˜ï¼Œæ˜¯å®æ—¶å»å›è°ƒProduceå‡½æ•°æ¥æ‹¿åˆ°æœ€æ–°å€¼çš„</strong>ã€‚</p>
<p>PRODUCINGçš„å®šä¹‰å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Produce</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TextEvent <span class="title">postEvent</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TextEvent(<span class="string">"hahaah"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸€ä¸ªæ€»çº¿ä¸Šï¼ˆä¸€ä¸ªbuså¯¹è±¡ï¼‰ä¸Šï¼ŒåŒä¸€æ—¶åˆ»åŒä¸€ç±»å‹çš„ç”¨@Produceæ ‡æ³¨çš„äº‹ä»¶ç”Ÿäº§è€…åªèƒ½æœ‰ä¸€ä¸ªã€‚å®˜æ–¹æ–‡æ¡£çš„åŸæ–‡æ˜¯ï¼š</p>
<blockquote>
<p><strong>You may only have one producer per event type registered at a time on a bus.  </strong></p>
</blockquote>
<p>ä¸€èˆ¬åœ¨ä½¿ç”¨EventBusæ—¶ï¼Œä¼šç›´æ¥é‡‡ç”¨EventBus.getDefault()æ¥è·å–ç³»ç»Ÿé»˜è®¤æä¾›çš„å•ä¾‹å¯¹è±¡ï¼Œç„¶åå†è¯¥å¯¹è±¡ï¼ˆæ€»çº¿å¯¹è±¡ï¼‰ä¸Šè¿›è¡Œå®è·µçš„å‘å¸ƒå’Œè®¢é˜…ã€‚ä½†æ˜¯ottoæ²¡æœ‰æä¾›é»˜è®¤çš„å•ä¾‹ï¼Œä¸€èˆ¬éœ€è¦è‡ªå·±åœ¨åº”ç”¨ç¨‹åºèŒƒå›´å†…ï¼Œè‡ªå·±å»æ‰‹åŠ¨åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªottoçš„buså¯¹è±¡ã€‚</p>
<p>Ottoåœ¨åˆå§‹åŒ–Busçš„æ—¶å€™æ¥å†³å®šå¤„ç†äº‹ä»¶çš„æ‰§è¡Œçº¿ç¨‹ã€‚é»˜è®¤åªæœ‰ThreadEnforcer.ANYå’ŒThreadEnforcer.MAINä¸¤ç§ã€‚å¦‚æœéœ€è¦å…¶ä»–ç±»å‹çš„çº¿ç¨‹æ§åˆ¶ï¼Œéœ€è¦è‡ªå·±å®ç°ThreadEnforceræ¥å£ã€‚ç›¸å¯¹è€Œè¨€ï¼ŒEventBusçš„æ§åˆ¶æ›´ç²¾ç»†æ›´ç®€å•ã€‚   </p>
<h2 id="ä¸EventBusçš„å¯¹æ¯”">ä¸EventBusçš„å¯¹æ¯”</h2><p><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-8-28/24002070.jpg" alt="Ottoä¸EventBusçš„å¯¹æ¯”"></p>
<h2 id="è¯¦ç»†ä½¿ç”¨å®ä¾‹"><a href="id:è¯¦ç»†ä½¿ç”¨å®ä¾‹" target="_blank" rel="external">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a></h2><p>1.åœ¨build.gradleçš„dependenciesä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.squareup:otto:1.3.8'</span></span><br></pre></td></tr></table></figure>
<p>2.æ ¹æ®ä¸šåŠ¡éœ€è¦å®šä¹‰äº‹ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextEvent</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.åˆ›å»ºä¸€ä¸ªç±»ï¼Œåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´å†…æŒæœ‰ä¸€ä¸ªæ€»çº¿å¯¹è±¡ã€‚ï¼ˆä½¿ç”¨EventBusä¸éœ€è¦è¿™ä¸€æ­¥ï¼Œå› ä¸ºEventBuså·²è¿‘æ›¿æˆ‘ä»¬å®ç°å¥½äº†é»˜è®¤çš„å•ä¾‹å¯¹è±¡ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bus bus = <span class="keyword">new</span> Bus();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.åœ¨éœ€è¦è®¢é˜…äº‹ä»¶çš„ç»„ä»¶ä¸­ï¼ˆå³è®¢é˜…è€…ï¼Œå‡è®¾æ˜¯ä¸€ä¸ªActivityï¼‰ï¼Œåšä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œï¼š  </p>
<ul>
<li>åœ¨åˆå§‹åŒ–ç»„ä»¶æ—¶å‘æ€»çº¿æ³¨å†Œè‡ªå·±ä¸ºæŸç±»å‹äº‹ä»¶çš„è®¢é˜…è€…  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_main3);</span><br><span class="line">       tv = (TextView)findViewById(R.id.getdatatv);</span><br><span class="line">       </span><br><span class="line">       MyApplicationUtil.bus.register(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å®ç°äº‹ä»¶å¤„ç†å‡½æ•°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Subscribe</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEvent</span><span class="params">(TextEvent event)</span></span>&#123;</span><br><span class="line">       tv.setText(event.getData());</span><br><span class="line">       Log.d(<span class="string">"TAG"</span>,  <span class="string">"==in Main3Activity==   getEvent:"</span> + event.getData());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ç»„ä»¶é”€æ¯æ—¶åæ³¨å†Œè®¢é˜…è€…</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onDestroy();</span><br><span class="line">       MyApplicationUtil.bus.unregister(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>5.åœ¨äº§ç”Ÿäº‹ä»¶çš„ç»„ä»¶ï¼ˆç”Ÿäº§è€…ï¼‰ä¸­ï¼Œå¦‚æœåªæ˜¯å‘é€æ™®é€šäº‹ä»¶ï¼Œå°±ç›´æ¥è°ƒç”¨buså¯¹è±¡çš„postæ–¹æ³•å³å¯ï¼Œä¹‹å‰æ³¨å†Œçš„è®¢é˜…è€…å°±å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyApplicationUtil.bus.post(<span class="keyword">new</span> TextEvent(dataEditText.getText().toString()));</span><br></pre></td></tr></table></figure>
<p>6.å¦‚æœéœ€è¦å®ç°PRODUCINGåŠŸèƒ½ï¼ˆå³ç±»ä¼¼StickyEventåŠŸèƒ½ï¼‰ï¼Œå°±éœ€è¦ç”¨@Produceræ˜¾ç¤ºæ ‡æ³¨ç”Ÿäº§è€…ï¼ŒåŒæ—¶ä¹Ÿè¦å¯¹è¯¥ç”Ÿäº§è€…è¿›è¡Œæ³¨å†Œå’Œåæ³¨å†Œï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_main2);</span><br><span class="line">       dataEditText = (EditText)findViewById(R.id.activity2_et);</span><br><span class="line">       btn1 = (Button)findViewById(R.id.activity2_btn1);</span><br><span class="line">       btn1.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">       MyApplicationUtil.bus.register(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="annotation">@Produce</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> TextEvent <span class="title">postEvent</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> TextEvent(<span class="string">"hahaah"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onDestroy();</span><br><span class="line">       MyApplicationUtil.bus.unregister(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§è¿™ç§æ–¹å¼æ˜¾ç¤ºå®šä¹‰äº†ç”Ÿäº§è€…ä¹‹åï¼Œä¹‹å‰åœ¨æ­¤busä¸Šæ³¨å†Œè¿‡çš„æ‰€æœ‰è¯¥ç±»å‹äº‹ä»¶çš„è®¢é˜…è€…éƒ½ä¼šæ¥æ”¶åˆ°æœ¬äº‹ä»¶çš„å®ä¾‹ã€‚ä¹‹åå†å†æ­¤busä¸Šæ³¨å†Œçš„æ­¤ç±»å‹çš„æ–°çš„è®¢é˜…è€…åŒæ ·èƒ½å¤Ÿæ¥æ”¶åˆ°æœ¬äº‹ä»¶å®ä¾‹ã€‚</p>
<hr>
<p>å‚è€ƒèµ„æ–™</p>
<ol>
<li><p><a href="https://github.com/square/otto" target="_blank" rel="external">å®˜æ–¹ä¸‹è½½ï¼šhttps://github.com/square/otto</a></p>
</li>
<li><p><a href="http://square.github.io/otto/" target="_blank" rel="external">å®˜æ–¹ä½¿ç”¨è¯´æ˜ï¼šhttp://square.github.io/otto/</a></p>
</li>
<li><p><a href="http://blog.csdn.net/wangjia55/article/details/17148535" target="_blank" rel="external">Ottoä»‹ç»ï¼šhttp://blog.csdn.net/wangjia55/article/details/17148535</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/qianxudetianxia/p/4216949.html" target="_blank" rel="external">ä½¿ç”¨äº‹ä»¶æ€»çº¿æ¡†æ¶EventBuså’ŒOttoï¼š<br>http://www.cnblogs.com/qianxudetianxia/p/4216949.html</a></p>
</li>
<li><p><a href="http://m.blog.csdn.net/blog/Estellise/41758401" target="_blank" rel="external">Androidç»„ä»¶é—´é€šä¿¡æœºè§£è€¦â€”â€”Android EventBuså’ŒOttoæ¡†æ¶ï¼š<br>http://m.blog.csdn.net/blog/Estellise/41758401</a></p>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>åœ¨å­¦ä¹ å®ŒEventBusåï¼Œå‘ç°ä¸ä¹‹ç±»ä¼¼çš„äº‹ä»¶åº“è¿˜æœ‰ottoï¼Œäºæ˜¯æˆ‘ä¹Ÿå­¦ä¹ äº†ä¸€ä¸‹ã€‚åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„å¤§éƒ¨åˆ†åšå®¢å…¶å®éƒ½æ˜¯å¯¹ottoå®˜æ–¹æ–‡æ¡£çš„ä¸­æ–‡ç¿»è¯‘è€Œå·²ï¼Œå¯¹ç”Ÿäº§è€…çš„@Produceã€PUBLISHINGã€PRODUCINGä¹‹é—´çš„å…³ç³»æ²¡æœ‰æ·±å…¥è§£é‡Šï¼Œä¹Ÿæ²¡æœ‰å¯¹EventBusçš„StickyEvnetä¸Ottoä¸­ç±»ä¼¼æœºåˆ¶çš„å¯¹æ¯”ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘æƒ³äº†è§£çš„ã€‚æ‰€ä»¥å°±è‡ªå·±å†™demoåšäº†äº›å®éªŒï¼Œæ€»ç»“äº†è¿™ç¯‡å­¦ä¹ ç¬”è®°ã€‚</p>
<p><strong><br>æœ¬æ–‡çš„OttoæŒ‡çš„æ˜¯ï¼šsquare/otto<br>EventBusæŒ‡çš„æ˜¯ï¼šgreenrobot/EventBus<br>Githubä¸Šæœ‰å¾ˆå¤šåŒåé¡¹ç›®ï¼Œä¸è¦æé”™ã€‚
</strong></p>
<p>æœ¬æ–‡æ¡£å‰é¢æ˜¯å¯¹Ottoå„æ–¹é¢çš„ä»‹ç»ã€‚å¦‚æœè¦å­¦ä¹ å¿«é€Ÿä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°åé¢çš„<a href="#è¯¦ç»†ä½¿ç”¨å®ä¾‹">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a>éƒ¨åˆ†ã€‚</p>
<h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2><p>Ottoçš„ä½œç”¨ä¸EventBusç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨äºç»„ä»¶é—´é€šä¿¡ï¼Œé™ä½ä¸åŒçš„ç±»ç›¸äº’ä¹‹é—´çš„è€¦åˆã€‚å¦‚æœä¸ç†Ÿæ‚‰EventBusï¼Œå¯ä»¥å…ˆäº†è§£EventBusï¼Œä¸‹æ–‡æ¶‰åŠåˆ°ottoä¸EventBusçš„å¯¹æ¯”ã€‚</p>
<p>Ottoå¯ä»¥éšä¾¿å®šä¹‰è®¢é˜…è€…çš„æ¶ˆæ¯å¤„ç†å‡½æ•°çš„å‡½æ•°åï¼Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼æ¥è¯†åˆ«ç”Ÿäº§å‡½æ•°å’Œæ¶ˆè´¹å‡½æ•°ï¼ˆ@Produceå’Œ@Subscribeï¼‰ï¼Œè¿™æ˜¯ä¸EventBusæ˜æ˜¾çš„ä¸åŒã€‚<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://www.carrotsight.com/tags/Android/"/>
    
      <category term="EventBus" scheme="http://www.carrotsight.com/tags/EventBus/"/>
    
      <category term="Otto" scheme="http://www.carrotsight.com/tags/Otto/"/>
    
      <category term="è§‚å¯Ÿè€…æ¨¡å¼" scheme="http://www.carrotsight.com/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="Android" scheme="http://www.carrotsight.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[EventBuså­¦ä¹ æ€»ç»“]]></title>
    <link href="http://www.carrotsight.com/2015/09/14/2015-9-14-EventBus%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93.html"/>
    <id>http://www.carrotsight.com/2015/09/14/2015-9-14-EventBuså­¦ä¹ æ€»ç»“.html</id>
    <published>2015-09-14T12:12:43.000Z</published>
    <updated>2015-12-02T13:07:27.000Z</updated>
    <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©å¯¹Githubä¸Šå¾ˆç«çš„eventbusè¿›è¡Œäº†å­¦ä¹ ï¼ŒæŸ¥é˜…äº†ä¸€äº›åšå®¢ï¼Œä¹Ÿè‡ªå·±å†™ä»£ç åšäº†å®éªŒï¼Œå†™ä¸‹æ­¤æ€»ç»“æ–‡æ¡£ã€‚<br>æœ¬æ–‡æ¡£å‰é¢æ˜¯å¯¹EventBuså„æ–¹é¢çš„ä»‹ç»ã€‚å¦‚æœè¦å­¦ä¹ å¿«é€Ÿä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°åé¢çš„<a href="#è¯¦ç»†ä½¿ç”¨å®ä¾‹">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a>éƒ¨åˆ†ã€‚</p>
<p><strong>æœ¬æ–‡EventBusæŒ‡çš„æ˜¯ï¼šgreenrobot/EventBus<br>Githubä¸Šæœ‰å¾ˆå¤šåŒåé¡¹ç›®ï¼Œä¸è¦æé”™ã€‚</strong><br>EventBusæ˜¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥æ›¿ä»£Intentã€Handlerã€Broadcastçš„åœ¨Activityã€Fragmentã€Serviceä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æœºåˆ¶ã€‚èƒ½é™ä½ç»„ä»¶é—´çš„è€¦åˆï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚</p>
<h2 id="æ¦‚å¿µå›¾">æ¦‚å¿µå›¾</h2><p><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-8-28/38822932.jpg" alt="EventBusæ¦‚å¿µå›¾"><br><a id="more"></a></p>
<h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2><p>â€œäº‹ä»¶â€æ˜¯ä¸€ä¸ªPOJOï¼Œæ ¹æ®è‡ªå·±éœ€è¦è‡ªå·±éšä¾¿å®šä¹‰çš„ä¸€ä¸ªJAVAç±»ï¼ŒåŒ…å«éœ€è¦ä¼ é€’ç»™å…¶ä»–ç»„ä»¶çš„ä¿¡æ¯ã€‚  </p>
<p>äº‹ä»¶å‘å¸ƒè€…ä¸éœ€è¦æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨EventBus.getDefault().post(new TextEvent(â€œæˆ‘æœ‰ä¸€å¤´å°æ¯›é©´â€))ã€‚å…¶ä¸­TextEventæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»ã€‚  </p>
<p>äº‹ä»¶è®¢é˜…è€…ï¼ˆæ¥å—è€…ã€å¤„ç†è€…ï¼‰éœ€è¦åœ¨onCreate()æ–¹æ³•ä¸­é€šè¿‡EventBus.getDefault().register(this)æ³¨å†Œè‡ªå·±ï¼Œåœ¨onDestroy()æ–¹æ³•ä¸­é€šè¿‡EventBus.getDefault().unregister(this)å–æ¶ˆæ³¨å†Œã€‚åŒæ—¶ï¼Œéœ€è¦è‡³å°‘å®ç°4ç§onEventXXXæ–¹æ³•ä¸­çš„ä¸€ç§ã€‚   </p>
<p>æ”¯æŒ4ç§äº‹ä»¶å“åº”æ¨¡å¼ï¼š  </p>
<blockquote>
<ol>
<li>MainThreadï¼šå¯¹åº”çš„å“åº”å‡½æ•°å†™æ³•ä¸ºonEventMainThreadï¼Œäº‹ä»¶å“åº”å‡½æ•°ä¼šåœ¨Androidåº”ç”¨çš„ä¸»çº¿ç¨‹(å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯UIçº¿ç¨‹)ä¸­æ‰§è¡Œã€‚</li>
<li>PostThreadï¼šå¯¹åº”çš„å“åº”å‡½æ•°å†™æ³•ä¸ºonEventï¼Œå³é»˜è®¤çš„å¤„ç†æ–¹å¼å°±æ˜¯postæ–¹å¼ã€‚äº‹ä»¶å“åº”å‡½æ•°å’Œäº‹ä»¶å‘å¸ƒåœ¨åŒä¸€çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œè¿™æ ·å¯ä»¥é¿å…çº¿ç¨‹åˆ‡æ¢ã€‚</li>
<li>BackgroundThreadï¼šå¯¹åº”çš„å“åº”å‡½æ•°å†™æ³•ä¸ºonEventBackgroundThreadï¼Œäº‹ä»¶å“åº”å‡½æ•°ä¼šåœ¨ä¸€ä¸ªåå°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœäº‹ä»¶å‘å¸ƒå‡½æ•°ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåˆ™ä¼šç«‹å³åœ¨äº‹ä»¶å‘å¸ƒçº¿ç¨‹ä¸­æ‰§è¡Œå“åº”å‡½æ•°ã€‚å¦‚æœäº‹ä»¶å‘å¸ƒå‡½æ•°åœ¨ä¸»çº¿ç¨‹ä¸­ï¼ŒEventBusåˆ™ä¼šåœ¨å”¯ä¸€çš„ä¸€ä¸ªåå°çº¿ç¨‹ä¸­æŒ‰ç…§é¡ºåºæ¥æ‰§è¡Œæ‰€æœ‰çš„åå°äº‹ä»¶å“åº”å‡½æ•°ã€‚</li>
<li>Asyncï¼šå¯¹åº”çš„å“åº”å‡½æ•°å†™æ³•ä¸ºonEventAsyncï¼Œæ¯æ¥æ”¶åˆ°ä¸€ä¸ªäº‹ä»¶éƒ½ä¼šå¼€å¯ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹æ‰§è¡Œã€‚  </li>
</ol>
</blockquote>
<p>å‰3ç§å“åº”å‡½æ•°éƒ½è¦æ±‚å…¶ä¸­ä¸èƒ½æœ‰è€—æ—¶æ“ä½œï¼Œé˜²æ­¢UIæ›´æ–°ã€äº‹ä»¶åˆ†å‘æˆ–æ–°äº‹ä»¶çš„å¤„ç†ç­‰æ“ä½œè¢«é˜»å¡ã€‚ </p>
<p>é€šè¿‡å®éªŒï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªè®¢é˜…è€…ä¸­å¯¹åŒä¸€ä¸ªäº‹ä»¶åŒæ—¶æ³¨å†Œäº†è¿™4ç§å“åº”å‡½æ•°ï¼Œåˆ™æ§åˆ¶å°æ‰“å°çš„æ—¶é—´å¤„ç†å‡½æ•°é¡ºåºä¸º :</p>
<blockquote>
<p>onEvent()-&gt;onEventMainThread()-&gt;onEventAsync()-&gt;onEventBackgroundThread()</p>
</blockquote>
<p>æˆ–</p>
<blockquote>
<p>onEvent()-&gt;onEventMainThread()-&gt;onEventBackgroundThread()-&gt;onEventAsync()ã€‚ </p>
</blockquote>
<p>ç”±äºonEventBackgroundThreadï¼ˆï¼‰å’ŒonEventAsyncï¼ˆï¼‰éƒ½æ˜¯åœ¨åå°çº¿ç¨‹æ‰§è¡Œçš„ï¼ŒåŒ…æ‹¬åœ¨æ§åˆ¶å°æ‰“å°å‡½æ•°åçš„æ“ä½œï¼Œæ‰€ä»¥æ­¤é¡ºåºä¸ä¸€å®šå°±æ˜¯è¿™å‡ ä¸ªå‡½æ•°è¢«è§¦å‘çš„é¡ºåºã€‚</p>
<h2 id="ä¼˜å…ˆçº§">ä¼˜å…ˆçº§</h2><p>EventBusåœ¨æ³¨å†Œè®¢é˜…è€…æ—¶éœ€è¦æŒ‡å®šæ­¤è®¢é˜…è€…çš„ä¼˜å…ˆçº§ï¼Œç”¨æ•´å‹æ•°è¡¨ç¤ºï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¦‚æœä¸æ˜¾ç¤ºæŒ‡å®šä¼˜å…ˆçº§ï¼Œåˆ™é»˜è®¤ä¸º0ã€‚ä¼˜å…ˆçº§å¯ä»¥ä¸ºè´Ÿæ•°ã€‚  </p>
<p>å¯¹äºåŒä¸€ä¸ªäº‹ä»¶çš„å¤šä¸ªè®¢é˜…è€…ï¼Œé«˜ä¼˜å…ˆçº§çš„è®¢é˜…è€…ä¼šå…ˆæ¥æ”¶åˆ°Eventã€‚</p>
<p>æ¥æ”¶åˆ°Eventçš„è®¢é˜…è€…å¯ä»¥å†³å®šæ˜¯å¦å–æ¶ˆäº‹ä»¶çš„ä¼ é€’ï¼Œæ¥ä½¿åé¢çš„è®¢é˜…è€…æ— æ³•æ¥æ”¶åˆ°Eventã€‚æ–¹æ³•æ˜¯åœ¨onEventæ–¹æ³•ä¸­è°ƒç”¨EventBus.getDefault().cancelEventDelivery(event)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½åœ¨Postçº¿ç¨‹çš„onEventæ–¹æ³•ä¸­å–æ¶ˆäº‹ä»¶çš„ä¼ é€’ã€‚ </p>
<p>ç»è¿‡å®éªŒï¼Œ<strong>ç›¸åŒä¼˜å…ˆçº§çš„è®¢é˜…è€…æ˜¯æŒ‰ç…§æ³¨å†Œçš„å…ˆåé¡ºåºæ¥æ¥æ”¶äº‹ä»¶çš„</strong>ã€‚å…ˆæ¥æ”¶åˆ°äº‹ä»¶çš„è®¢é˜…è€…å¦‚æœåœ¨onEvent()æ–¹æ³•ä¸­è°ƒç”¨EventBus.getDefault().cancelEventDelivery(event)ï¼ŒåŒæ ·å¯ä»¥ä¸­æ–­äº‹ä»¶ç»§ç»­ä¼ æ’­ï¼Œä½†ä¸­æ–­å¾—ä¸å½»åº•ï¼Œç´§éšå…¶åçš„1ä¸ªè®¢é˜…è€…ä»ç„¶æœ‰å¯èƒ½æ¥æ”¶åˆ°äº‹ä»¶ã€‚</p>
<p><strong><em>æ³¨æ„ï¼š</em></strong>  </p>
<p>å¦‚æœç¬¬ä¸€ä¸ªæ¥æ”¶åˆ°æ—¶é—´çš„è®¢é˜…è€…åœ¨ä»»ä½•ä¸€ä¸ªè®¢é˜…å‡½æ•°ä¸­å¯¹æ¥æ”¶åˆ°çš„eventçš„å†…å®¹åšäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆåç»­çš„å…¶ä»–è®¢é˜…è€…çš„æ‰€æœ‰onEventXXXå‡½æ•°æ¥å—åˆ°çš„eventä¹Ÿéƒ½æ˜¯è¢«ä¿®æ”¹çš„ã€‚å³<strong>postæ“ä½œåªäº§ç”Ÿä¸€ä¸ªeventå¯¹è±¡ï¼Œæ‰€æœ‰è®¢é˜…è€…çš„onEventXXXå‡½æ•°æ¥å—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</strong>ã€‚</p>
<p>å¦‚æœeventè¢«ç”Ÿäº§è€…postä¹‹åï¼Œè®¢é˜…è€…æ¥æ”¶åˆ°äº†äº‹ä»¶å¹¶è¶³å¤Ÿå¿«çš„å¯¹è¯¥eventçš„æŸäº›å­—æ®µåšäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆç”Ÿäº§è€…åœ¨postè¯­å¥ä¹‹åå¯¹eventçš„å¼•ç”¨ä¹Ÿä¼šä½“ç°å‡ºå­—æ®µçš„ä¿®æ”¹ã€‚è¿™é‡Œçš„â€œè¶³å¤Ÿå¿«â€æ²¡æœ‰å®šè®ºï¼Œå®éªŒçš„æ¯æ¬¡ç»“æœéƒ½æœ‰å·®å¼‚ï¼Œä¸è¿‡åŸºæœ¬çš„è§„å¾‹æ˜¯ç”Ÿäº§è€…çš„postï¼ˆï¼‰è¯­å¥ä¹‹åçš„ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šåœ¨æ‰€æœ‰è®¢é˜…è€…çš„onEvent()å’ŒonEventMainThread()éƒ½æ‰§è¡Œå®Œæˆåæ‰æ‰§è¡Œã€‚è€ŒonEventAsync()å’ŒonEventBackgroundThread()ç›¸å¯¹äºpostï¼ˆï¼‰ä¸‹ä¸€æ¡è¯­å¥çš„æ‰§è¡Œé¡ºåºåˆ™æ²¡æœ‰å®šè®ºã€‚</p>
<h2 id="å…³äºcancelEventDeliveryçš„é—®é¢˜">å…³äºcancelEventDeliveryçš„é—®é¢˜</h2><p>å¦‚æœåœ¨postçº¿ç¨‹çš„onEventæ–¹æ³•ä¸­ï¼Œå…ˆæœ‰ä¸€æ®µç‰¹åˆ«è€—æ—¶çš„æ“ä½œï¼Œç„¶åæ‰è°ƒç”¨cancelEventDeliveryï¼Œé‚£ä¹ˆåé¢çš„è®¢é˜…è€…æœ‰å¯èƒ½å› ä¸ºcancelEventDeliveryæ²¡è¢«å³æ—¶æ‰§è¡Œè€Œæ¥æ”¶åˆ°äº‹ä»¶å—ï¼Ÿæ¯”å¦‚è®¢é˜…è€…1çš„onEventæ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(TextEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">99999999</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> a = i;</span><br><span class="line">            &#125;</span><br><span class="line">            EventBus.getDefault().cancelEventDelivery(event);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæœ¬è¯¥åœ¨è®¢é˜…è€…1åé¢æ‰æ¥æ”¶åˆ°äº‹ä»¶çš„è®¢é˜…è€…2ä¼šæ¥æ”¶åˆ°eventå—ï¼Ÿä¹Ÿè®¸EventBusä¼šåœ¨forå¾ªç¯è¿™æ®µæ—¶é—´å†…å·²è¿‘æŠŠäº‹ä»¶ä¼ é€’ç»™è®¢é˜…è€…2äº†ï¼Œæ¯•ç«Ÿè¿™æ—¶è¿˜æ²¡æœ‰æ‰§è¡ŒEventBus.getDefault().cancelEventDelivery(event)ï¼Ÿ</p>
<p>å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œè·Ÿè¿›äº†ä¸€ä¸‹EventBusçš„æºç ï¼Œæœ‰ä»¥ä¸‹å‘ç°ã€‚  </p>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-12-2/91530689.jpg" alt=""></p>
<p>åœ¨äº‹ä»¶ç”Ÿäº§è€…è°ƒç”¨postæ–¹æ³•æ—¶ï¼ŒEventbuså†…éƒ¨æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªpostSingleEventForEventType<br>æ–¹æ³•æ¥è¿›è¡Œæ¶ˆæ¯ä¼ é€’çš„ï¼Œä¸€æ—¦EventBus.getDefault().cancelEventDelivery<br>(event)æ–¹æ³•è¢«è°ƒç”¨ï¼Œabortedå°±è¢«ç½®ä¸ºfalseï¼Œè¿™ä¸ªforå¾ªç¯å°±ä¼šåœæ­¢ï¼Œæ¶ˆæ¯ä¸ä¼šå†å‘åé¢ä»»ä½•è®¢é˜…è€…çš„ä»»ä½•ä¸€ç§çº¿ç¨‹å‡½æ•°ä¼ é€’ã€‚<br>ç”±äºcancelEventDeliveryæ–¹æ³•åªèƒ½åœ¨postçº¿ç¨‹çš„onEventå‡½æ•°ä¸­è°ƒç”¨ï¼Œè€Œè¿™é‡Œçš„postToSubscriptionæ–¹æ³•å¯¹äºpostçº¿ç¨‹çš„æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥å³ä½¿æŸä¸ªè®¢é˜…è€…åœ¨postçº¿ç¨‹çš„onEventä¸­å…ˆè¿›è¡Œè€—æ—¶æ“ä½œå†è°ƒç”¨cancelEventDeliveryï¼Œåé¢çš„è®¢é˜…è€…ä¹Ÿæ¥å—ä¸åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå› ä¸ºpostSingleEventForEventTypeæ–¹æ³•è¿˜åœ¨ç­‰å¾…2è¿”å›ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰ã€‚  </p>
<p>postToSubscriptionçš„å†…éƒ¨å®ç°å¦‚ä¸‹ï¼š<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-12-2/70984573.jpg" alt=""></p>
<p>æˆ‘ç”¨ä»£ç åœ¨å„ç§çº¿ç¨‹ä¸­éƒ½è¯•è¿‡äº†ï¼Œç¡®å®ä¸ç”¨æ‹…å¿ƒcancelEventDeliveryä¹‹å‰çš„è€—æ—¶æ“ä½œå¯¼è‡´åœ¨è€—æ—¶æ“ä½œæœŸé—´äº‹ä»¶ä»ç„¶è¢«ä¼ é€’çš„é—®é¢˜ã€‚åªæœ‰ä¸€ç§ä¾‹å¤–ï¼Œå°±æ˜¯åœ¨postçº¿ç¨‹çš„onThreadæ–¹æ³•ä¸­å†å¯æ–°çº¿ç¨‹è¿›è¡ŒcancelEventDeliveryè°ƒç”¨ï¼Œä¸ä¼šè¿™æ ·åšæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºeventbuså·²ç»æä¾›äº†4ç§çº¿ç¨‹æ¨¡å‹äº†ï¼Œä¸éœ€è¦è¿™æ ·å¤šæ­¤ä¸€ä¸¾ï¼Œ ç›¸ä¿¡ä¸ä¼šæœ‰äººè¿™æ ·å†™ä»£ç ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š<br><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-12-2/40991601.jpg" alt=""></p>
<h2 id="åŸºæœ¬ç”¨æ³•æµç¨‹3æ­¥æå®š">åŸºæœ¬ç”¨æ³•æµç¨‹3æ­¥æå®š</h2><p>1.å®šä¹‰äº‹ä»¶  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123; <span class="comment">/* Additional fields if needed */</span> &#125;</span><br></pre></td></tr></table></figure>
<p>2.æ³¨å†Œè®¢é˜…è€…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eventBus.register(<span class="keyword">this</span>);<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(AnyEventType event)</span> </span>&#123;<span class="comment">/* Do something */</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>3.å‘é€äº‹ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eventBus.post(event);</span><br></pre></td></tr></table></figure>
<h2 id="StickyEvent">StickyEvent</h2><p>é™¤äº†æ™®é€šçš„Eventï¼Œè¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„StickyEventï¼Œå®ƒä¹Ÿæ˜¯POJOï¼Œäº‹ä»¶æœ¬èº«å’Œæ™®é€šäº‹ä»¶æ— åŒºåˆ«ï¼Œåªæ˜¯åœ¨æ³¨å†Œè®¢é˜…è€…æ³¨å†Œæ—¶éœ€è¦ä½¿ç”¨EventBus.getDefault().registerSticky(this)ã€‚äº‹ä»¶å¤„ç†å‡½æ•°çš„å‡½æ•°åä¹Ÿä¸æ™®é€šäº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸€æ ·ï¼Œå› ä¸ºæ³¨å†Œä¸ºäº†StickyEventçš„ç›‘å¬å™¨ï¼Œæ‰€ä»¥EventBusåœ¨è°ƒç”¨è¿™äº›äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ä¼šæŒ‰ç…§StickyEventçš„æ–¹å¼æ¥å¤„ç†ã€‚  </p>
<p>StickyEventä¸æ™®é€šEventçš„æ™®é€šå°±åœ¨äºï¼ŒEventBusä¼šè‡ªåŠ¨ç»´æŠ¤è¢«ä½œä¸ºStickyEventè¢«postå‡ºæ¥ï¼ˆå³åœ¨å‘å¸ƒäº‹ä»¶æ—¶ä½¿ç”¨EventBus.getDefault().postSticky(new MyEvent())æ–¹æ³•ï¼‰çš„äº‹ä»¶çš„æœ€åä¸€ä¸ªå‰¯æœ¬åœ¨ç¼“å­˜ä¸­ã€‚  </p>
<p>ä»»ä½•æ—¶å€™åœ¨ä»»ä½•ä¸€ä¸ªè®¢é˜…äº†è¯¥äº‹ä»¶çš„è®¢é˜…è€…ä¸­çš„ä»»ä½•åœ°æ–¹ï¼ˆå¯ä»¥åœ¨ä»»ä½•å‡½æ•°ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨onEventXXXæ–¹æ³•ä¸­ï¼‰ï¼Œéƒ½å¯ä»¥é€šè¿‡EventBus.getDefault().getStickyEvent(MyEvent.class)æ¥å–å¾—è¯¥ç±»å‹äº‹ä»¶çš„æœ€åä¸€æ¬¡ç¼“å­˜ã€‚  </p>
<p>åŒæ—¶ï¼Œå³ä¾¿äº‹ä»¶å·²ç»åœ¨æ‰€æœ‰è®¢é˜…è€…ä¸­ä¼ é€’å®Œæˆäº†ï¼Œå¦‚æœæ­¤æ—¶å†åˆ›å»ºä¸€ä¸ªæ–°çš„è®¢é˜…è€…ï¼ˆå¦‚ä¸€ä¸ªæ³¨å†Œäº†è¯¥StickyEventçš„Activityï¼‰ï¼Œåˆ™åœ¨è®¢é˜…è€…å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡è¯¥è®¢é˜…è€…çš„noEventXXXæ–¹æ³•æ¥å¤„ç†è¯¥StickyEventã€‚  </p>
<p>ä¹Ÿå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™ï¼Œåˆ©ç”¨removeStickyEventæ–¹æ³•æ¥ç§»é™¤å¯¹æŸç§StickyEventçš„ç¼“å­˜ã€‚</p>
<h2 id="ç½‘ä¸Šåšæ–‡æ€»ç»“EventBusçš„ä¼˜ç‚¹">ç½‘ä¸Šåšæ–‡æ€»ç»“EventBusçš„ä¼˜ç‚¹</h2><blockquote>
<ol>
<li>æ”¯æŒåœ¨ä¸åŒç±»å‹çš„çº¿ç¨‹ä¸­å¤„ç†è®¢é˜…ï¼ŒåŒ…æ‹¬å‘å¸ƒæ‰€åœ¨çº¿ç¨‹ï¼ŒUIçº¿ç¨‹ã€å•ä¸€åå°çº¿ç¨‹ã€å¼‚æ­¥çº¿ç¨‹</li>
<li>æ”¯æŒäº‹ä»¶ä¼˜å…ˆçº§å®šä¹‰ï¼Œæ”¯æŒä¼˜å…ˆçº§é«˜çš„è®¢é˜…è€…å–æ¶ˆäº‹ä»¶ç»§ç»­ä¼ é€’ï¼Œæ”¯æŒç²˜æ€§äº‹ä»¶ï¼Œæ˜¯ä¸æ˜¯è·Ÿç³»ç»Ÿçš„æœ‰åºå¹¿æ’­ã€ç²˜æ€§å¹¿æ’­å¾ˆåƒå•Š</li>
<li>ä¸æ˜¯åŸºäºannotations</li>
<li>æ€§èƒ½æ›´ä¼˜</li>
<li>ä½“ç§¯å°</li>
<li>æ”¯æŒå•ä¾‹åˆ›å»ºæˆ–åˆ›å»ºå¤šä¸ªå¯¹è±¡</li>
<li>æ”¯æŒæ ¹æ®äº‹ä»¶ç±»å‹è®¢é˜…</li>
</ol>
</blockquote>
<h2 id="è¯¦ç»†ä½¿ç”¨å®ä¾‹"><a href="id:è¯¦ç»†ä½¿ç”¨å®ä¾‹" target="_blank" rel="external">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a></h2><p>1.å‡†å¤‡å·¥ä½œï¼š  </p>
<p>åœ¨é¡¹ç›®build.gradleçš„dependenciesä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span> <span class="string">'de.greenrobot:eventbus:2.4.0'</span></span><br></pre></td></tr></table></figure></p>
<p>2.ç¼–å†™äº‹ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextEvent</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">    	<span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.åœ¨éœ€è¦è®¢é˜…è¯¥äº‹ä»¶çš„Activityçš„onCreateï¼ˆï¼‰æ–¹æ³•ä¸­ï¼ŒæŠŠè‡ªå·±æ³¨å†Œä¸ºè®¢é˜…è€…ã€‚<br>é»˜è®¤ä½¿ç”¨EventBusæä¾›çš„é»˜è®¤æ€»çº¿ï¼Œå³EventBus.getDefault()æ–¹æ³•è·å¾—çš„æ€»çº¿ï¼Œå…¶å†…éƒ¨å®ç°äº†å•ä¾‹æ¨¡å¼ã€‚è‡ªå·±ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶ä¸åŒçš„æ€»çº¿ã€‚<br>register()æ–¹æ³•æ˜¯å‘æ€»çº¿è®¢é˜…æ™®é€šäº‹ä»¶ï¼ŒregisterStickyæ–¹æ³•æ˜¯å‘æ€»çº¿è®¢é˜…Stickyäº‹ä»¶ã€‚åªèƒ½ä½¿ç”¨äºŒè€…å½“ä¸­çš„ä¸€ç§æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    	<span class="comment">//EventBus.getDefault().registerSticky(this);</span></span><br><span class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.åœ¨æ³¨å†Œä¸ºè®¢é˜…è€…çš„Activityçš„onDestroyï¼ˆï¼‰æ–¹æ³•ä¸­ï¼Œè§£é™¤æ³¨å†Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">	EventBus.getDefault().unregister(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.åœ¨æ³¨å†Œä¸ºè®¢é˜…è€…çš„Activityä¸­ï¼Œç¼–å†™äº‹ä»¶å¤„ç†æ–¹æ³•ã€‚<br>ä¸‹é¢çš„ä»£ç åˆ—ä¸¾äº†4ç§çº¿ç¨‹ç±»å‹çš„äº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œå®é™…ä½¿ç”¨æ—¶å¯ä»¥æ ¹æ®éœ€è¦åªå®ç°å…¶ä¸­çš„å‡ ç§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventAsync</span><span class="params">(TextEvent event)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">/* messageTextView.setText(event.getMsg());</span><br><span class="line">           Toast.makeText(this, event.getMsg(), Toast.LENGTH_SHORT).show();*/</span></span><br><span class="line">           Log.d(<span class="string">"TAG"</span>, event.getMsg());</span><br><span class="line">           Log.d(<span class="string">"onEvent"</span>, <span class="string">"onEventAsync()"</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(TextEvent event)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           messageTextView.setText(event.getMsg());</span><br><span class="line">           Toast.makeText(<span class="keyword">this</span>, event.getMsg(), Toast.LENGTH_SHORT).show();</span><br><span class="line">           Log.d(<span class="string">"TAG"</span>, event.getMsg());</span><br><span class="line">           Log.d(<span class="string">"onEvent"</span>, <span class="string">"onEvent()"</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(TextEvent event)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">/* messageTextView.setText(event.getMsg());</span><br><span class="line">           Toast.makeText(this, event.getMsg(), Toast.LENGTH_SHORT).show();*/</span></span><br><span class="line">           Log.d(<span class="string">"TAG"</span>, event.getMsg());</span><br><span class="line">           Log.d(<span class="string">"onEvent"</span>, <span class="string">"onEventMainThread()"</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventBackgroundThread</span><span class="params">(TextEvent event)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">/* messageTextView.setText(event.getMsg());</span><br><span class="line">           Toast.makeText(this, event.getMsg(), Toast.LENGTH_SHORT).show();*/</span></span><br><span class="line">           Log.d(<span class="string">"TAG"</span>, event.getMsg());</span><br><span class="line">           Log.d(<span class="string">"onEvent"</span>, <span class="string">"onEventBackgroundThread()"</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>6.åœ¨éœ€è¦äº§ç”Ÿäº‹ä»¶çš„ç»„ä»¶ï¼ˆActivityã€Fragmentã€Serviceç­‰ï¼‰ä¸­ï¼Œè°ƒç”¨å‘é€äº‹ä»¶çš„æ–¹æ³•ã€‚<br>ä¸‹é¢çš„ä»£ç åˆ—ä¸¾äº†å‘é€æ™®é€šäº‹ä»¶å’Œå‘é€Stickyäº‹ä»¶ä¸¤ç§æƒ…å†µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">           <span class="keyword">case</span> R.id.activity8_btn1:</span><br><span class="line">               EventBus.getDefault().post(<span class="keyword">new</span> TextEvent(<span class="string">"æˆ‘æœ‰ä¸€å¤´å°æ¯›é©´"</span>));</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">case</span> R.id.activity8_btn2:</span><br><span class="line">               EventBus.getDefault().postSticky(<span class="keyword">new</span> TextEvent(<span class="string">"æˆ‘æœ‰ä¸€å¤´å°æ¯›é©´"</span>));</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œå½“ç‚¹å‡»æŒ‰é’®è§¦å‘onClickï¼ˆï¼‰æ—¶ï¼Œå°±èƒ½åœ¨ç¬¬5æ­¥çš„MainActivityä¸­çš„onEventXXXæ–¹æ³•ä¸­æ¥æ”¶åˆ°äº‹ä»¶äº†ã€‚<br>å¦‚æœå‘é€çš„æ˜¯Stickyäº‹ä»¶ï¼Œåˆ™å¯ä»¥åœ¨ä»»ä½•éœ€è¦è·å–è¯¥äº‹ä»¶çš„åœ°æ–¹é€šè¿‡EventBus.getDefault().getStickyEvent(TextEvent.class)æ–¹æ³•æ¥è·å–è¯¥ç±»å‹çš„StickyEventçš„æœ€åä¸€æ¬¡æ•°æ®ã€‚</p>
<hr>
<p>å‚è€ƒèµ„æ–™</p>
<ol>
<li><p><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">å®˜æ–¹ä¸‹è½½: https://github.com/greenrobot/EventBus
</a></p>
</li>
<li><p><a href="https://github.com/greenrobot/EventBus/blob/master/HOWTO.md" target="_blank" rel="external">å®˜æ–¹ä½¿ç”¨è¯´æ˜: https://github.com/greenrobot/EventBus/blob/master/HOWTO.md</a></p>
</li>
<li><p><a href="http://blog.csdn.net/marktheone/article/details/47725553" target="_blank" rel="external">EventBus, otto, LocalBroadcastçš„å¯¹æ¯”ï¼šhttp://blog.csdn.net/marktheone/article/details/47725553</a></p>
</li>
<li><p><a href="http://blog.csdn.net/harvic880925/article/details/40660137" target="_blank" rel="external">EventBusä½¿ç”¨è¯¦è§£ï¼š<br>http://blog.csdn.net/harvic880925/article/details/40660137</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/wangjq/archive/2012/07/12/2587966.html" target="_blank" rel="external">è§‚å¯Ÿè€…æ¨¡å¼ï¼š<br>http://www.cnblogs.com/wangjq/archive/2012/07/12/2587966.html</a></p>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>è¿™ä¸¤å¤©å¯¹Githubä¸Šå¾ˆç«çš„eventbusè¿›è¡Œäº†å­¦ä¹ ï¼ŒæŸ¥é˜…äº†ä¸€äº›åšå®¢ï¼Œä¹Ÿè‡ªå·±å†™ä»£ç åšäº†å®éªŒï¼Œå†™ä¸‹æ­¤æ€»ç»“æ–‡æ¡£ã€‚<br>æœ¬æ–‡æ¡£å‰é¢æ˜¯å¯¹EventBuså„æ–¹é¢çš„ä»‹ç»ã€‚å¦‚æœè¦å­¦ä¹ å¿«é€Ÿä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°åé¢çš„<a href="#è¯¦ç»†ä½¿ç”¨å®ä¾‹">è¯¦ç»†ä½¿ç”¨å®ä¾‹</a>éƒ¨åˆ†ã€‚</p>
<p><strong>æœ¬æ–‡EventBusæŒ‡çš„æ˜¯ï¼šgreenrobot/EventBus<br>Githubä¸Šæœ‰å¾ˆå¤šåŒåé¡¹ç›®ï¼Œä¸è¦æé”™ã€‚</strong><br>EventBusæ˜¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥æ›¿ä»£Intentã€Handlerã€Broadcastçš„åœ¨Activityã€Fragmentã€Serviceä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æœºåˆ¶ã€‚èƒ½é™ä½ç»„ä»¶é—´çš„è€¦åˆï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚</p>
<h2 id="æ¦‚å¿µå›¾">æ¦‚å¿µå›¾</h2><p><img src="http://7xle8x.com1.z0.glb.clouddn.com/15-8-28/38822932.jpg" alt="EventBusæ¦‚å¿µå›¾"><br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://www.carrotsight.com/tags/Android/"/>
    
      <category term="EventBus" scheme="http://www.carrotsight.com/tags/EventBus/"/>
    
      <category term="Android" scheme="http://www.carrotsight.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ã€ŠThink in Javaã€‹å¹¶å‘ - å­¦ä¹ ç¬”è®°]]></title>
    <link href="http://www.carrotsight.com/2015/09/08/2015-9-8-%E3%80%8AThink-in-Java%E3%80%8B%E5%B9%B6%E5%8F%91-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"/>
    <id>http://www.carrotsight.com/2015/09/08/2015-9-8-ã€ŠThink-in-Javaã€‹å¹¶å‘-å­¦ä¹ ç¬”è®°.html</id>
    <published>2015-09-08T08:08:15.000Z</published>
    <updated>2015-12-03T08:07:13.000Z</updated>
    <content type="html"><![CDATA[<p>1.Executorå…è®¸ä½ ç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— é¡»æ˜¾ç¤ºåœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚Executoråœ¨Java SE5/6ä¸­æ˜¯å¯åŠ¨ä»»åŠ¡çš„ä¼˜é€‰æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨Executoræ¥ä»£æ›¿æ˜¾ç¤ºåœ°åˆ›å»ºThreadå¯¹è±¡ã€‚  </p>
<p>2.ExecutorServiceçŸ¥é“å¦‚ä½•æ„å»ºæ°å½“çš„ä¸Šä¸‹æ–‡æ¥æ‰§è¡ŒRunnableå¯¹è±¡ã€‚  </p>
<p>3.CachedThreadPoolåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é€šå¸¸ä¼šåˆ›å»ºä¸æ‰€éœ€æ•°é‡ç›¸åŒçš„çº¿ç¨‹ï¼Œç„¶åå†å®ƒå›æ”¶æ—§çº¿ç¨‹æ—¶åœæ­¢åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå› æ­¤å®ƒæ˜¯åˆç†çš„Executorçš„é¦–é€‰ã€‚åªæœ‰å½“è¿™ç§æ–¹å¼ä¼šå¼•å‘é—®é¢˜æ—¶ï¼Œæ‰éœ€è¦åˆ‡æ¢åˆ°FixedThreadPoolã€‚<br><a id="more"></a><br>4.SingleThreadExecutorå°±åƒæ˜¯çº¿ç¨‹æ•°é‡ä¸º1çš„FixedThreadPoolã€‚å¦‚æœå‘SingleThreadExecutoræäº¤äº†å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡å°†æ’é˜Ÿï¼Œæ¯ä¸ªä»»åŠ¡éƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹ä¹‹å‰è¿è¡Œç»“æŸï¼Œæ‰€æœ‰çš„ä»»åŠ¡å°†ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹ã€‚SingleThreadExecutorä¼šåºåˆ—åŒ–æ‰€æœ‰æäº¤ç»™å®ƒçš„ä»»åŠ¡ï¼Œå¹¶ä¼šç»´æŠ¤å®ƒè‡ªå·±ï¼ˆéšè—ï¼‰çš„æ‚¬æŒ‚ä»»åŠ¡é˜Ÿåˆ—ã€‚<br>SingleThreadExecutorç¡®ä¿ä»»ä½•æ—¶åˆ»åœ¨ä»»ä½•çº¿ç¨‹ä¸­éƒ½åªæœ‰å”¯ä¸€çš„ä»»åŠ¡åœ¨è¿è¡Œï¼Œå°±ä¸éœ€è¦åœ¨å…±äº«èµ„æºä¸Šå¤„ç†åŒæ­¥ã€‚  </p>
<p>5.Runnableæ˜¯æ‰§è¡Œå·¥ä½œçš„ç‹¬ç«‹ä»»åŠ¡ï¼Œä½†æ˜¯ä»–ä¸è¿”å›ä»»ä½•å€¼ã€‚å¦‚æœå¸Œæœ›ä»»åŠ¡åœ¨å®Œæˆæ—¶èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°Callableæ¥å£è€Œä¸æ˜¯Runnableæ¥å£ã€‚åœ¨Java SE5ä¸­å¼•å…¥çš„Callableæ˜¯ä¸€ç§å…·æœ‰ç±»å‹å‚æ•°çš„æ³›å‹ï¼Œå®ƒçš„ç±»å‹å‚æ•°è¡¨ç¤ºçš„æ˜¯ä»æ–¹æ³•callï¼ˆï¼‰ï¼ˆè€Œä¸æ˜¯runï¼ˆï¼‰ï¼‰ä¸­è¿”å›çš„å€¼ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨ExecutorService.submitï¼ˆï¼‰æ–¹æ³•è°ƒç”¨å®ƒã€‚<br>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskWithResult</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TaskWithResult</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Thread.sleep((<span class="keyword">new</span> Random()).nextInt(<span class="number">2000</span>) + <span class="number">1000</span>);<span class="comment">//åœ¨è¿™é‡Œéšæœºç¡çœ æ—¶é—´ï¼Œä¸ºäº†æµ‹è¯•Future.isDone()çš„æ•ˆæœ</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"TaskWithResult id: "</span> + id;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">		ArrayList&lt;Future&lt;String&gt;&gt; results = <span class="keyword">new</span> ArrayList&lt;Future&lt;String&gt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			results.add(exec.submit(<span class="keyword">new</span> TaskWithResult(i)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(Future&lt;String&gt; fs : results)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				System.out.println(<span class="string">"\n==taskIndex "</span> + results.indexOf(fs) + <span class="string">"=="</span>);</span><br><span class="line">				System.out.println(<span class="string">"isDone(): "</span> + fs.isDone());</span><br><span class="line">				System.out.println(fs.get());</span><br><span class="line">				System.out.println(<span class="string">"isDone(): "</span> + fs.isDone());</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">				exec.shutdown();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸ºï¼š</p>
<blockquote>
<p>==taskIndex 0==<br>isDone(): false<br>TaskWithResult id: 0<br>isDone(): true</p>
<p>==taskIndex 1==<br>isDone(): false<br>TaskWithResult id: 1<br>isDone(): true</p>
<p>==taskIndex 2==<br>isDone(): true<br>TaskWithResult id: 2<br>isDone(): true</p>
<p>==taskIndex 3==<br>isDone(): false<br>TaskWithResult id: 3<br>isDone(): true</p>
<p>==taskIndex 4==<br>isDone(): true<br>TaskWithResult id: 4<br>isDone(): true</p>
<p>==taskIndex 5==<br>isDone(): true<br>TaskWithResult id: 5<br>isDone(): true</p>
<p>==taskIndex 6==<br>isDone(): true<br>TaskWithResult id: 6<br>isDone(): true</p>
<p>==taskIndex 7==<br>isDone(): false<br>TaskWithResult id: 7<br>isDone(): true</p>
<p>==taskIndex 8==<br>isDone(): true<br>TaskWithResult id: 8<br>isDone(): true</p>
<p>==taskIndex 9==<br>isDone(): true<br>TaskWithResult id: 9<br>isDone(): true</p>
</blockquote>
<p>ä¸”æ¯å½“è¾“å‡ºåˆ°isDone(): falseçš„åœ°æ–¹ï¼Œè¾“å‡ºçº¿ç¨‹å°±ä¼šå¡ä½ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªçº¿ç¨‹çš„è¿”å›å€¼åï¼Œæ‰ä¼šç»§ç»­åç»­çš„æ‰“å°ã€‚  </p>
<p>Futureçš„javadocè¯´æ˜å¦‚ä¸‹ï¼š  </p>
<blockquote>
<p>A Future represents the result of an asynchronous computation. Methods are provided to check if the computation is complete, to wait for its completion, and to retrieve the result of the computation. The result can only be retrieved using method get when the computation has completed, blocking if necessary until it is ready. Cancellation is performed by the cancel method. Additional methods are provided to determine if the task completed normally or was cancelled. Once a computation has completed, the computation cannot be cancelled. If you would like to use a Future for the sake of cancellability but not provide a usable result, you can declare types of the form Future&lt;?&gt; and return null as a result of the underlying task.</p>
</blockquote>
<p>Future.get()æ–¹æ³•çš„javadocè¯´æ˜å¦‚ä¸‹ï¼š  </p>
<blockquote>
<p>Waits if necessary for the computation to complete, and then retrieves its result.</p>
</blockquote>
<p>6.è°ƒåº¦å™¨å€¾å‘äºè®©ä¼˜å…ˆçº§æœ€é«˜çš„çº¿ç¨‹å…ˆæ‰§è¡Œã€‚å¦‚æœè¦è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œåº”è¯¥åœ¨runï¼ˆï¼‰æ–¹æ³•ä½“ä¸­ä½¿ç”¨<br><code>Thread.currentThread().setPriority(newPriority)</code>æ¥è®¾ç½®ï¼Œè€Œä¸è¦åœ¨æ„é€ å™¨ä¸­è®¾ç½®ã€‚<br>ä¸åŒæ“ä½œç³»ç»Ÿå¯¹ä¼˜å…ˆçº§çš„åˆ†çº§ä¸åŒï¼Œä¸ºäº†å¯ç§»æ¤æ€§ï¼Œåº”è¯¥åªä½¿ç”¨MAX_PRIORITYã€NORM_PRIORITYå’ŒMIN_PRIORITYä¸‰ç§çº§åˆ«ã€‚  </p>
<p>7.yieldï¼ˆï¼‰æ–¹æ³•ä¼šæš—ç¤ºçº¿ç¨‹è°ƒåº¦å™¨ï¼Œæˆ‘çš„å·¥ä½œåšå¾—å·®ä¸å¤šäº†ï¼Œå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹å¯ä»¥è¿è¡Œäº†ã€‚ä½†è¿™ä»…ä»…æ˜¯ä¸€ä¸ªæš—ç¤ºï¼Œæ²¡æœ‰ä»»ä½•æœºåˆ¶ä¿è¯å®ƒå°†è¢«é‡‡çº³ã€‚æ‰€ä»¥ï¼Œä¸èƒ½ä¾èµ–äºyieldï¼ˆï¼‰ã€‚å®é™…ä¸Šï¼Œyieldï¼ˆï¼‰ç»å¸¸è¢«è¯¯ç”¨ã€‚  </p>
<p>8.æ‰€è°“åå°ï¼ˆdaemonï¼‰çº¿ç¨‹ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ¨åå°æä¾›ä¸€ç§é€šç”¨æœåŠ¡çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è¿™ç§çº¿ç¨‹å¹¶ä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œ<strong>å½“æ‰€æœ‰çš„éåå°çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢äº†ï¼ŒåŒæ—¶ä¼šæ€æ­»è¿›ç¨‹ä¸­çš„æ‰€æœ‰åå°çº¿ç¨‹</strong>ã€‚åè¿‡æ¥è¯´ï¼Œåªè¦æœ‰ä»»ä½•éåå°çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œç¨‹åºå°±ä¸ä¼šç»ˆæ­¢ã€‚<br>å¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰è°ƒç”¨setDaemonï¼ˆï¼‰æ–¹æ³•æ‰èƒ½æŠŠå®ƒè®¾ç½®ä¸ºåå°çº¿ç¨‹ï¼Œå¦‚ä»¥ä¸‹ä»£ç ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread daemon = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SimpleDaemon());</span><br><span class="line">daemon.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">daemon.start();</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç”¨isDaemon()æ–¹æ³•æ¥ç¡®å®šçº¿ç¨‹æ˜¯å¦æ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ã€‚å¦‚æœæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒåˆ›å»ºçš„ä»»ä½•å­çº¿ç¨‹éƒ½å°†è¢«è‡ªåŠ¨è®¾ç½®æˆåå°çº¿ç¨‹ã€‚</p>
<p>9.æ˜¯çº¿ç¨‹ç¡çœ æ—¶å¯ä»¥è°ƒç”¨  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TimeUnit.MILLISECONDS.sleep(timeout);</span><br><span class="line">TimeUnit.HOURS.sleep(timeout);</span><br><span class="line">TimeUnit.MICROSECONDS.sleep(timeout);</span><br></pre></td></tr></table></figure>
<p>ç­‰æ–¹æ³•æ¥ä»£æ›¿ç›´æ¥è°ƒç”¨<code>Thread.sleep(timeout)</code>æ–¹æ³•ï¼Œè¿™æ ·æ—¶é—´çš„é•¿åº¦å°±æ›´ç›´è§‚ï¼Œè¿™äº›æ–¹æ³•å†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨Thread.sleep(timeout)æ–¹æ³•ã€‚  </p>
<p>10.join()æ–¹æ³•ï¼š  </p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¹‹ä¸Šè°ƒç”¨joinï¼ˆï¼‰æ–¹æ³•ï¼Œå…¶æ•ˆæœæ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´ç›´åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨å¦ä¸€ä¸ªçº¿ç¨‹tä¸Šè°ƒç”¨t.join()ï¼Œæ­¤çº¿ç¨‹å°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹tç»“æŸæ‰æ¢å¤ï¼ˆå³t.isAlive()è¿”å›ä¸ºå‡ï¼‰ã€‚  </li>
<li>å¯ä»¥åœ¨è°ƒç”¨join()æ—¶å¸¦ä¸Šä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼ˆå•ä½å¯ä»¥æ˜¯æ¯«ç§’ï¼Œæˆ–è€…æ¯«ç§’å’Œçº³ç§’ï¼‰ï¼Œè¿™æ ·å¦‚æœç›®æ ‡çº¿ç¨‹åœ¨è¿™æ®µæ—¶é—´åˆ°æœŸæ—¶è¿˜æ²¡æœ‰ç»“æŸçš„è¯ï¼Œjoin()æ–¹æ³•æ€»èƒ½è¿”å›ã€‚</li>
<li>å¯¹join()æ–¹æ³•çš„è°ƒç”¨å¯ä»¥è¢«ä¸­æ–­ï¼Œåšæ³•æ˜¯åœ¨è°ƒç”¨joinï¼ˆï¼‰çš„çº¿ç¨‹ä¸Šå†æ¬¡è°ƒç”¨interrupt()æ–¹æ³•ã€‚  </li>
</ul>
<p>11.ç”±äºçº¿ç¨‹çš„æœ¬è´¨ç‰¹æ€§ï¼Œä¸èƒ½æ•è·ä»çº¿ç¨‹ä¸­é€ƒé€¸çš„å¼‚å¸¸ï¼Œå³ä½¿åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œå­çº¿ç¨‹ä»»åŠ¡æ—¶æŠŠå®ƒåŒ…åœ¨try-catchå—ä¸­ï¼Œä»»ç„¶æ— æ³•æ•è·åˆ°é€ƒé€¸çš„å¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šç›´æ¥å‘å¤–ä¼ æ’­çš„æ§åˆ¶å°ã€‚ä¸ºäº†æ•è·å¼‚å¸¸ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæ–°åˆ›å»ºçš„Threadå¯¹è±¡ä¸Šé™„ç€ä¸€ä¸ªThread.UncaughtExceptionHandlerã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.run();</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"I throw this Exception on purpose!"</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadExceptionCaughtTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			MyThread t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">			t1.start();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(<span class="string">"Haha! Exception caught!!!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œçš„ç»“æœä¸ºï¼š  </p>
<blockquote>
<p>Exception in thread â€œThread-0â€ java.lang.RuntimeException: I throw this Exception on purpose!<br>    at MyThread.run(ThreadExceptionCaughtTest.java:5)</p>
</blockquote>
<p>å¯è§try-catchå¹¶ä¸èƒ½æ•è·åˆ°æˆ‘åœ¨MyThreadä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚  </p>
<p>é‚£ä¹ˆæˆ‘ä¸ºMyThreadé™„åŠ ä¸€ä¸ªæˆ‘è‡ªå·±å®ç°çš„UncaughtExceptionHandlerï¼Œä»£ç å¦‚ä¸‹ï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.run();</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"I throw this Exception on purpose!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUncaughtExceptionHandler</span> <span class="keyword">implements</span> <span class="title">Thread</span>.<span class="title">UncaughtExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Haha! I caught : "</span> + e);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadExceptionCaughtTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			MyThread t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">			t1.setUncaughtExceptionHandler(<span class="keyword">new</span> MyUncaughtExceptionHandler());</span><br><span class="line">			t1.start();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(<span class="string">"Haha! Exception caught!!!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p>æ‰§è¡Œçš„ç»“æœä¸ºï¼š</p>
<blockquote>
<p>Haha! I caught : java.lang.RuntimeException: I throw this Exception on purpose!</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°MyUncaughtExceptionHandleræˆåŠŸæ•è·åˆ°äº†MyThreadæŠ›å‡ºçš„å¼‚å¸¸ï¼Œtry-catchä»ç„¶æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸ã€‚  </p>
<p>12.å…³äº<strong>synchronizedæ–¹æ³•</strong><br>æ‰€æœ‰å¯¹è±¡éƒ½è‡ªåŠ¨å«æœ‰å•ä¸€çš„é”ï¼ˆä¹Ÿç§°ä¸ºç›‘è§†å™¨ï¼‰ã€‚å½“åœ¨å¯¹è±¡ä¸Šè°ƒç”¨å…¶ä»»æ„synchronizedæ–¹æ³•çš„æ—¶å€™ï¼Œæ­¤å¯¹è±¡éƒ½è¢«åŠ é”ï¼Œ<strong>è¿™æ—¶è¯¥å¯¹è±¡ä¸Šçš„å…¶ä»–synchronizedæ–¹æ³•åªæœ‰ç­‰åˆ°å‰ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å®Œæ¯•å¹¶é‡Šæ”¾äº†é”ä¹‹åæ‰èƒ½è¢«è°ƒç”¨</strong>ã€‚<br>ä¾‹å¦‚è¿™æ®µä»£ç ï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAccount</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> account;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserAccount</span><span class="params">(<span class="keyword">int</span> account)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.account = account;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.currentThread().sleep(<span class="number">2000</span>);</span><br><span class="line">			System.out.println(<span class="string">"incAccount result: "</span> + ++account);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"decAccount result: "</span> + --account);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		UserAccount ua = <span class="keyword">new</span> UserAccount(<span class="number">200</span>);</span><br><span class="line">		Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				ua.incAccount();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				ua.decAccount();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		System.out.println(<span class="string">"===start==="</span>);</span><br><span class="line">		t1.start();</span><br><span class="line">		t2.start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p>å…¶æ‰§è¡Œç»“æœå§‹ç»ˆä¸ºï¼š  </p>
<blockquote>
<p>===start===<br>incAccount result: 201<br>decAccount result: 200</p>
</blockquote>
<p>ä¸”æ§åˆ¶å°æ‰“å°å‡ºâ€œ===start===â€åï¼Œä¼šæš‚åœ2ç§’é’Ÿæ‰ç»§ç»­è¾“å‡ºåé¢çš„2è¡Œç»“æœã€‚</p>
<p>è€Œå¦‚æœæŠŠå‡½æ•°decAccountï¼ˆï¼‰å‰é¢çš„synchronizedä¿®é¥°ç¬¦å»æ‰ï¼Œåˆ™æ‰“å°ç»“æœä¸ºï¼š   </p>
<blockquote>
<p>===start===<br>decAccount result: 199<br>incAccount result: 200</p>
</blockquote>
<p>ä¸”å‰ä¸¤è¡Œç»“æœæ˜¯ç¬é—´æ‰“å°å‡ºæ¥çš„ï¼Œç„¶åæš‚åœäº†2ç§’ï¼Œæ‰è¾“å‡ºæœ€åä¸€è¡Œç»“æœã€‚  </p>
<p>13.åœ¨ä½¿ç”¨å¹¶å‘æ—¶ï¼Œå°†åŸŸè®¾ç½®ä¸ºprivateæ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™ï¼Œsynchronizedå…³é”®å­—å°±ä¸èƒ½é˜²æ­¢å…¶ä»–ä»»åŠ¡ç›´æ¥è®¿é—®åŸŸï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿå†²çªã€‚<br>å¦‚æœä½ çš„ç±»ä¸­æœ‰è¶…è¿‡ä¸€ä¸ªæ–¹æ³•åœ¨å¤„ç†ä¸´ç•Œæ•°æ®ï¼Œé‚£ä¹ˆä½ å¿…é¡»åŒæ­¥æ‰€æœ‰ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<p>14.ä¸€ä¸ªä»»åŠ¡å¯ä»¥å¤šæ¬¡è·å¾—å¯¹è±¡çš„é”ã€‚JVMè´Ÿè´£è·Ÿè¸ªå¯¹è±¡è¢«åŠ é”çš„æ¬¡æ•°ã€‚åªæœ‰é¦–å…ˆè·å¾—äº†é”çš„ä»»åŠ¡æ‰èƒ½å…è®¸ç»§ç»­è·å–å¤šä¸ªé”ã€‚  </p>
<p>15.é’ˆå¯¹æ¯ä¸ªç±»ï¼Œä¹Ÿæœ‰ä¸€ä¸ªé”ï¼Œä½œä¸ºç±»çš„Classå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥synchronized staticæ–¹æ³•å¯ä»¥åœ¨ç±»çš„èŒƒå›´å†…é˜²æ­¢å¯¹staticæ•°æ®çš„å¹¶å‘è®¿é—®ã€‚  </p>
<p>16.åœ¨java.util.concurrent.locksä¸­å®šä¹‰äº†æ˜¾ç¤ºçš„äº’æ–¥æœºåˆ¶Lockã€‚Lockå¯¹è±¡å¿…é¡»è¢«æ˜¾ç¤ºåœ°åˆ›å»ºã€é”å®šå’Œé‡Šæ”¾ã€‚<br>å¥½çš„ä½¿ç”¨ä¹ æƒ¯æ˜¯ï¼Œä½¿ç”¨try-finallyè¯­å¥å—ï¼Œå°†lockï¼ˆï¼‰æ”¾åœ¨tryä¸­ï¼Œå°†unlockï¼ˆï¼‰æ”¾åœ¨finallyä¸­ã€‚æ³¨æ„ï¼Œreturnè¯­å¥å¿…é¡»æ”¾åœ¨tryå­å¥ä¸­ï¼Œä»¥ç¡®ä¿unlockï¼ˆï¼‰ä¸ä¼šè¿‡æ—©å‘ç”Ÿï¼Œä»è€Œå°†æ•°æ®æš´éœ²ç»™ç¬¬äºŒä¸ªä»»åŠ¡ã€‚  </p>
<p>17.å¦‚æœå°†ä¸€ä¸ªåŸŸå£°æ˜ä¸ºvolatileçš„ï¼Œé‚£ä¹ˆåªè¦å¯¹è¿™ä¸ªåŸŸäº§ç”Ÿäº†å†™æ“ä½œï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯»æ“ä½œå°±éƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¿®æ”¹ã€‚å³ä¾¿ä½¿ç”¨äº†æœ¬åœ°ç¼“å­˜ï¼Œæƒ…å†µä¹Ÿç¡®å®å¦‚æ­¤ï¼ŒvolatileåŸŸä¼šç«‹å³è¢«å†™å…¥åˆ°ä¸»å­˜ä¸­ï¼Œè€Œè¯»å–æ“ä½œå°±å‘ç”Ÿåœ¨ä¸»å­˜ä¸­ã€‚<br>å¦‚æœå¤šä¸ªä»»åŠ¡åœ¨åŒæ—¶è®¿é—®æŸä¸ªåŸŸï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸå°±åº”è¯¥æ˜¯volatileçš„ï¼Œå¦åˆ™ï¼Œè¿™ä¸ªåŸŸå°±åº”è¯¥åªèƒ½ç»ç”±åŒæ­¥æ¥è®¿é—®ã€‚åŒæ­¥ä¹Ÿä¼šå¯¼è‡´å‘ä¸»å­˜ä¸­åˆ·æ–°ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªåŸŸå®Œå…¨ç”±synchronizedæ–¹æ³•æˆ–è¯­å¥å—æ¥é˜²æŠ¤ï¼Œé‚£å°±ä¸å¿…å°†å…¶è®¾ç½®ä¸ºæ˜¯volatileçš„ã€‚<br>ä½¿ç”¨volatileè€Œä¸æ˜¯synchronizedçš„å”¯ä¸€å®‰å…¨çš„æƒ…å†µæ˜¯ç±»ä¸­åªæœ‰ä¸€ä¸ªå¯å˜çš„åŸŸã€‚ä½ çš„ç¬¬ä¸€é€‰æ‹©åº”è¯¥æ˜¯ä½¿ç”¨synchronizedå…³é”®å­—ï¼Œè¿™æ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œè€Œå°è¯•å…¶ä»–ä»»ä½•æ–¹å¼éƒ½æ˜¯æœ‰é£é™©çš„ã€‚ï¼ˆæˆ‘ç†è§£è¿™å¥è¯æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯ï¼Œå°½é‡ä¸è¦ä½¿ç”¨volatileå…³é”®å­—ï¼Œè€Œæ˜¯ä½¿ç”¨synchronizedå…³é”®å­—æˆ–è€…Lockç±»ã€‚ï¼‰  </p>
<p>18.è°ƒç”¨sleep()å’Œyieldï¼ˆï¼‰çš„æ—¶å€™å¹¶æ²¡æœ‰é‡Šæ”¾é”ã€‚<br>è°ƒç”¨wait()çš„æ—¶å€™é”è¢«é‡Šæ”¾ã€‚<br>wait()ã€notifyï¼ˆï¼‰ä»¥åŠnotifyAll()æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ–¹é¢ï¼Œé‚£å°±æ˜¯è¿™äº›æ–¹æ³•æ˜¯åŸºç±»Objectçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å±äºThreadçš„ä¸€éƒ¨åˆ†ï¼Œåªèƒ½åœ¨synchronizedæ–¹æ³•æˆ–synchronizedå—ä¸­è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•ã€‚sleepï¼ˆï¼‰å¯ä»¥åœ¨ésynchronizedæ§åˆ¶æ–¹æ³•é‡Œè°ƒç”¨ï¼Œæ˜¯å› ä¸ºä¸ç”¨æ“ä½œé”ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>1.Executorå…è®¸ä½ ç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— é¡»æ˜¾ç¤ºåœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚Executoråœ¨Java SE5/6ä¸­æ˜¯å¯åŠ¨ä»»åŠ¡çš„ä¼˜é€‰æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨Executoræ¥ä»£æ›¿æ˜¾ç¤ºåœ°åˆ›å»ºThreadå¯¹è±¡ã€‚  </p>
<p>2.ExecutorServiceçŸ¥é“å¦‚ä½•æ„å»ºæ°å½“çš„ä¸Šä¸‹æ–‡æ¥æ‰§è¡ŒRunnableå¯¹è±¡ã€‚  </p>
<p>3.CachedThreadPoolåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é€šå¸¸ä¼šåˆ›å»ºä¸æ‰€éœ€æ•°é‡ç›¸åŒçš„çº¿ç¨‹ï¼Œç„¶åå†å®ƒå›æ”¶æ—§çº¿ç¨‹æ—¶åœæ­¢åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå› æ­¤å®ƒæ˜¯åˆç†çš„Executorçš„é¦–é€‰ã€‚åªæœ‰å½“è¿™ç§æ–¹å¼ä¼šå¼•å‘é—®é¢˜æ—¶ï¼Œæ‰éœ€è¦åˆ‡æ¢åˆ°FixedThreadPoolã€‚<br>]]>
    
    </summary>
    
      <category term="Java" scheme="http://www.carrotsight.com/tags/Java/"/>
    
      <category term="å¤šçº¿ç¨‹" scheme="http://www.carrotsight.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="å¹¶å‘" scheme="http://www.carrotsight.com/tags/%E5%B9%B6%E5%8F%91/"/>
    
      <category term="Java" scheme="http://www.carrotsight.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ã€FLEX bug:æ— æ³•å¯åŠ¨æœåŠ¡ï¼Œå› ä¸ºfmlæ–‡ä»¶æŸåã€‘çš„è§£å†³åŠæ³•]]></title>
    <link href="http://www.carrotsight.com/2013/12/02/2013-12-2-FLEX%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%9B%A0%E4%B8%BAfml%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F.html"/>
    <id>http://www.carrotsight.com/2013/12/02/2013-12-2-FLEXæ— æ³•å¯åŠ¨æœåŠ¡å› ä¸ºfmlæ–‡ä»¶æŸå.html</id>
    <published>2013-12-02T05:01:15.000Z</published>
    <updated>2015-12-03T08:06:26.000Z</updated>
    <content type="html"><![CDATA[<p>åœ¨Flash Builderä¸­ï¼Œæç¤º</p>
<blockquote>
<p>FLEX bug:æ— æ³•å¯åŠ¨æœåŠ¡ï¼Œå› ä¸ºfmlæ–‡ä»¶æŸåã€‚<br><a id="more"></a><br>å…·ä½“é”™è¯¯æç¤ºå¿˜äº†ï¼Œå·®ä¸å¤šå°±æ˜¯è¿™å¥è¯ã€‚</p>
</blockquote>
<p>å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼ŒæŠŠé¡¹ç›®ç›®å½•ä¸‹çš„.model/<em>*</em>.fmlæ–‡ä»¶ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œåˆ æ‰åæ‰çš„æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯<service>æ ‡ç­¾ä¹‹é—´çš„éƒ¨åˆ†ï¼Œç„¶ååœ¨å›å»çœ‹FLEXï¼Œå°±å¯ä»¥åˆ æ‰ä¹‹å‰çš„æ•°æ®æœåŠ¡äº†ã€‚</service></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åœ¨Flash Builderä¸­ï¼Œæç¤º</p>
<blockquote>
<p>FLEX bug:æ— æ³•å¯åŠ¨æœåŠ¡ï¼Œå› ä¸ºfmlæ–‡ä»¶æŸåã€‚<br>]]>
    
    </summary>
    
      <category term="Flex" scheme="http://www.carrotsight.com/categories/Flex/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Flexä¸­datagridä¸­checkboxçš„å…¨é€‰å®ç°]]></title>
    <link href="http://www.carrotsight.com/2013/04/03/2013-4-3-Flex%E4%B8%ADdatagrid%E4%B8%ADcheckbox%E7%9A%84%E5%85%A8%E9%80%89%E5%AE%9E%E7%8E%B0.html"/>
    <id>http://www.carrotsight.com/2013/04/03/2013-4-3-Flexä¸­datagridä¸­checkboxçš„å…¨é€‰å®ç°.html</id>
    <published>2013-04-03T03:44:21.000Z</published>
    <updated>2015-12-03T08:05:31.000Z</updated>
    <content type="html"><![CDATA[<p>å‡è®¾ä½ç¨‹åºçš„è¡¨æ ¼ä¸­æœ‰ä¸€åˆ—æ˜¯checkboxï¼Œç”¨æˆ·å‹¾é€‰åè¿›è¡Œå…¶ä»–æ“ä½œï¼Œå®šä¹‰ä¸ºï¼š</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">chkChooseAll_changeHandler</span><span class="params">(event:Event)</span><span class="type">:void</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> <span class="keyword">each</span>(<span class="keyword">var</span> item:XML <span class="keyword">in</span> adg.dataProvider)</span><br><span class="line">   &#123;</span><br><span class="line">       item.@selected = chkChooseAll.selected;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>å³å°†è¡¨æ ¼æ•°æ®æºå¯¹åº”é¡¹çš„selectdå±æ€§è®¾ç½®ä¸ºå…¨é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€ã€‚</p>
<p>ä¸‹é¢ä¸»è¦è¦å¤„ç†è¡¨æ ¼ä¸­chkColåˆ—å¯¹å±æ€§æ”¹å˜çš„å“åº”ï¼Œå³è‡ªåŠ¨æ›´æ–°å…¨é€‰çŠ¶æ€ã€‚æ–¹æ³•ä¸ºï¼š<br>åœ¨itemRenderä¸­ï¼Œé‡è½½dataå±æ€§çš„setæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span> <span class="title">data</span><span class="params">(value:Object)</span><span class="type">:void</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value.@selected == <span class="string">"true"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">         chkbox.selected = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         chkbox.selected = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´çš„itemRenderæºç å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://7xle8x.com1.z0.glb.clouddn.com/FlexItemRender.png" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>å‡è®¾ä½ç¨‹åºçš„è¡¨æ ¼ä¸­æœ‰ä¸€åˆ—æ˜¯checkboxï¼Œç”¨æˆ·å‹¾é€‰åè¿›è¡Œå…¶ä»–æ“ä½œï¼Œå®šä¹‰ä¸ºï¼š</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">chkChooseAll_changeHandler</span><span class="params">(event:Event)</span><span class="type">:void</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> <span class="keyword">each</span>(<span class="keyword">var</span> item:XML <span class="keyword">in</span> adg.dataProvider)</span><br><span class="line">   &#123;</span><br><span class="line">       item.@selected = chkChooseAll.selected;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="Flex" scheme="http://www.carrotsight.com/categories/Flex/"/>
    
  </entry>
  
</feed>
